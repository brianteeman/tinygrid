!function(n){"use strict";var e=function(){},t=function(n,e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return n(e.apply(null,t))}},r=function(n){return function(){return n}},o=function(n){return n};function i(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o=e.concat(t);return n.apply(null,o)}}var u,c,a,s,f,l,d=function(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!n.apply(null,e)}},m=function(n){return function(){throw new Error(n)}},g=function(n){return n()},v=r(!1),p=r(!0),h=function(n){return function(e){return function(n){if(null===n)return"null";var e=typeof n;return"object"===e&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"===e&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":e}(e)===n}},y=h("string"),b=h("object"),w=h("array"),x=h("boolean"),T=h("function"),S=h("number"),O=Object.prototype.hasOwnProperty,k=function(n){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];if(0===e.length)throw new Error("Can't merge zero objects");for(var r={},o=0;o<e.length;o++){var i=e[o];for(var u in i)O.call(i,u)&&(r[u]=n(r[u],i[u]))}return r}},C=k((function(n,e){return b(n)&&b(e)?C(n,e):e})),E=k((function(n,e){return e})),I=function(){return D},D=(u=function(n){return n.isNone()},s={fold:function(n,e){return n()},is:v,isSome:v,isNone:p,getOr:a=function(n){return n},getOrThunk:c=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:r(null),getOrUndefined:r(void 0),or:a,orThunk:c,map:I,each:e,bind:I,exists:v,forall:p,filter:I,equals:u,equals_:u,toArray:function(){return[]},toString:r("none()")},Object.freeze&&Object.freeze(s),s),M=function(n){var e=r(n),t=function(){return i},o=function(e){return e(n)},i={fold:function(e,t){return t(n)},is:function(e){return n===e},isSome:p,isNone:v,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:t,orThunk:t,map:function(e){return M(e(n))},each:function(e){e(n)},bind:o,exists:o,forall:o,filter:function(e){return e(n)?i:D},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(e){return e.is(n)},equals_:function(e,t){return e.fold(v,(function(e){return t(n,e)}))}};return i},A={some:M,none:I,from:function(n){return null==n?D:M(n)}},F=Object.keys,R=function(n,e){for(var t=F(n),r=0,o=t.length;r<o;r++){var i=t[r];e(n[i],i)}},B=function(n,e){return V(n,(function(n,t){return{k:t,v:e(n,t)}}))},V=function(n,e){var t={};return R(n,(function(n,r){var o=e(n,r);t[o.k]=o.v})),t},N=function(n,e){var t=[];return R(n,(function(n,r){t.push(e(n,r))})),t},_=r("touchstart"),j=r("touchmove"),H=r("touchend"),z=r("mousedown"),L=r("mousemove"),P=r("mouseup"),$=r("mouseover"),W=r("keydown"),U=r("input"),G=r("change"),q=r("click"),Y=r("transitionend"),K=r("selectstart"),X=function(n){var e,t=!1;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return t||(t=!0,e=n.apply(null,r)),e}},J=function(){return Q(0,0)},Q=function(n,e){return{major:n,minor:e}},Z=function(n,e){var t=String(e).toLowerCase();return 0===n.length?J():function(n,e){var t=function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.test(e))return r}}(n,e);if(!t)return{major:0,minor:0};var r=function(n){return Number(e.replace(t,"$"+n))};return Q(r(1),r(2))}(n,t)},nn=J,en="Firefox",tn=function(n,e){return function(){return e===n}},rn=function(n){var e=n.current;return{current:e,version:n.version,isEdge:tn("Edge",e),isChrome:tn("Chrome",e),isIE:tn("IE",e),isOpera:tn("Opera",e),isFirefox:tn(en,e),isSafari:tn("Safari",e)}},on=function(){return rn({current:void 0,version:nn()})},un=rn,cn=(r("Edge"),r("Chrome"),r("IE"),r("Opera"),r(en),r("Safari"),"Windows"),an="Android",sn="Solaris",fn="FreeBSD",ln=function(n,e){return function(){return e===n}},dn=function(n){var e=n.current;return{current:e,version:n.version,isWindows:ln(cn,e),isiOS:ln("iOS",e),isAndroid:ln(an,e),isOSX:ln("OSX",e),isLinux:ln("Linux",e),isSolaris:ln(sn,e),isFreeBSD:ln(fn,e)}},mn=function(){return dn({current:void 0,version:nn()})},gn=dn,vn=(r(cn),r("iOS"),r(an),r("Linux"),r("OSX"),r(sn),r(fn),Array.prototype.slice),pn=Array.prototype.indexOf,hn=Array.prototype.push,yn=function(n,e){return t=n,r=e,-1<pn.call(t,r);var t,r},bn=function(n,e){for(var t=n.length,r=new Array(t),o=0;o<t;o++){var i=n[o];r[o]=e(i,o)}return r},wn=function(n,e){for(var t=0,r=n.length;t<r;t++)e(n[t],t)},xn=function(n,e){for(var t=[],r=0,o=n.length;r<o;r++){var i=n[r];e(i,r)&&t.push(i)}return t},Tn=function(n,e,t){return function(n,e){for(var t=n.length-1;0<=t;t--)e(n[t])}(n,(function(n){t=e(t,n)})),t},Sn=function(n,e,t){return wn(n,(function(n){t=e(t,n)})),t},On=function(n,e){for(var t=0,r=n.length;t<r;t++){var o=n[t];if(e(o,t))return A.some(o)}return A.none()},kn=function(n,e){for(var t=0,r=n.length;t<r;t++)if(e(n[t],t))return A.some(t);return A.none()},Cn=function(n){for(var e=[],t=0,r=n.length;t<r;++t){if(!w(n[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+n);hn.apply(e,n[t])}return e},En=function(n,e){var t=bn(n,e);return Cn(t)},In=function(n,e){for(var t=0,r=n.length;t<r;++t)if(!0!==e(n[t],t))return!1;return!0},Dn=function(n){var e=vn.call(n,0);return e.reverse(),e},Mn=function(n){return[n]},An=(T(Array.from)&&Array.from,function(n,e){var t=String(e).toLowerCase();return On(n,(function(n){return n.search(t)}))}),Fn=function(n,e){return-1!==n.indexOf(e)},Rn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Bn=function(n){return function(e){return Fn(e,n)}},Vn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return Fn(n,"edge/")&&Fn(n,"chrome")&&Fn(n,"safari")&&Fn(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Rn],search:function(n){return Fn(n,"chrome")&&!Fn(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return Fn(n,"msie")||Fn(n,"trident")}},{name:"Opera",versionRegexes:[Rn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Bn("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Bn("firefox")},{name:"Safari",versionRegexes:[Rn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(Fn(n,"safari")||Fn(n,"mobile/"))&&Fn(n,"applewebkit")}}],Nn=[{name:"Windows",search:Bn("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return Fn(n,"iphone")||Fn(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Bn("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Bn("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Bn("linux"),versionRegexes:[]},{name:"Solaris",search:Bn("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Bn("freebsd"),versionRegexes:[]}],_n={browsers:r(Vn),oses:r(Nn)},jn={detect:X((function(){return function(n){var e,t,o,i,u,c,a,s,f,l,d,m=_n.browsers(),g=_n.oses(),v=function(n,e){return An(n,e).map((function(n){var t=Z(n.versionRegexes,e);return{current:n.name,version:t}}))}(m,n).fold(on,un),p=function(n,e){return An(n,e).map((function(n){var t=Z(n.versionRegexes,e);return{current:n.name,version:t}}))}(g,n).fold(mn,gn);return{browser:v,os:p,deviceType:(t=v,o=n,i=(e=p).isiOS()&&!0===/ipad/i.test(o),u=e.isiOS()&&!i,c=e.isAndroid()&&3===e.version.major,a=e.isAndroid()&&4===e.version.major,s=i||c||a&&!0===/mobile/i.test(o),f=e.isiOS()||e.isAndroid(),l=f&&!s,d=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(o),{isiPad:r(i),isiPhone:r(u),isTablet:r(s),isPhone:r(l),isTouch:r(f),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:r(d)})}}(n.navigator.userAgent)}))},Hn={tap:r("alloy.tap")},zn=r("alloy.focus"),Ln=r("alloy.blur.post"),Pn=r("alloy.receive"),$n=r("alloy.execute"),Wn=r("alloy.focus.item"),Un=Hn.tap,Gn=jn.detect().deviceType.isTouch()?Hn.tap:q,qn=r("alloy.longpress"),Yn=r("alloy.system.init"),Kn=r("alloy.system.scroll"),Xn=r("alloy.system.attached"),Jn=r("alloy.system.detached"),Qn=function(n,e){te(n,n.element(),e,{})},Zn=function(n,e,t){te(n,n.element(),e,t)},ne=function(n){Qn(n,$n())},ee=function(n,e,t){te(n,e,t,{})},te=function(n,e,t,o){var i=C({target:e},o);n.getSystem().triggerEvent(t,e,B(i,r))},re=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:r(n)}},oe=function(e,t){var r=(t||n.document).createElement(e);return re(r)},ie=re,ue=(n.Node.ATTRIBUTE_NODE,n.Node.CDATA_SECTION_NODE,n.Node.COMMENT_NODE,n.Node.DOCUMENT_NODE),ce=(n.Node.DOCUMENT_TYPE_NODE,n.Node.DOCUMENT_FRAGMENT_NODE,n.Node.ELEMENT_NODE),ae=n.Node.TEXT_NODE,se=(n.Node.PROCESSING_INSTRUCTION_NODE,n.Node.ENTITY_REFERENCE_NODE,n.Node.ENTITY_NODE,n.Node.NOTATION_NODE,void 0!==n.window?n.window:Function("return this;")()),fe=function(n){return n.dom().nodeName.toLowerCase()},le=function(n){return function(e){return e.dom().nodeType===n}},de=le(ce),me=le(ae),ge=function(n){var e=me(n)?n.dom().parentNode:n.dom();return null!=e&&e.ownerDocument.body.contains(e)},ve=X((function(){return pe(ie(n.document))})),pe=function(n){var e=n.dom().body;if(null==e)throw new Error("Body is not available yet");return ie(e)},he=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(n.length!==e.length)throw new Error('Wrong number of arguments to struct. Expected "['+n.length+']", got '+e.length+" arguments");var o={};return wn(n,(function(n,t){o[n]=r(e[t])})),o}},ye=function(n){return n.slice(0).sort()},be=function(n,e){throw new Error("All required keys ("+ye(n).join(", ")+") were not specified. Specified keys were: "+ye(e).join(", ")+".")},we=function(n){throw new Error("Unsupported keys for object: "+ye(n).join(", "))},xe=function(n,e){if(!w(e))throw new Error("The "+n+" fields must be an array. Was: "+e+".");wn(e,(function(e){if(!y(e))throw new Error("The value "+e+" in the "+n+" fields was not a string.")}))},Te=function(n){var e=ye(n);On(e,(function(n,t){return t<e.length-1&&n===e[t+1]})).each((function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+e.join(", ")+"].")}))},Se=function(n,e){var t=n.concat(e);if(0===t.length)throw new Error("You must specify at least one required or optional field.");return xe("required",n),xe("optional",e),Te(t),function(o){var i=F(o);In(n,(function(n){return yn(i,n)}))||be(n,i);var u=xn(i,(function(n){return!yn(t,n)}));0<u.length&&we(u);var c={};return wn(n,(function(n){c[n]=r(o[n])})),wn(e,(function(n){c[n]=r(Object.prototype.hasOwnProperty.call(o,n)?A.some(o[n]):A.none())})),c}},Oe=ce,ke=ue,Ce=function(n,e){var t=n.dom();if(t.nodeType!==Oe)return!1;var r=t;if(void 0!==r.matches)return r.matches(e);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(e);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(e);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")},Ee=function(n){return n.nodeType!==Oe&&n.nodeType!==ke||0===n.childElementCount},Ie=function(e,t){var r=void 0===t?n.document:t.dom();return Ee(r)?[]:bn(r.querySelectorAll(e),ie)},De=function(e,t){var r=void 0===t?n.document:t.dom();return Ee(r)?A.none():A.from(r.querySelector(e)).map(ie)},Me=function(n,e){return n.dom()===e.dom()},Ae=(jn.detect().browser.isIE(),function(n){return ie(n.dom().ownerDocument)}),Fe=function(n){return ie(n.dom().ownerDocument.defaultView)},Re=function(n){return A.from(n.dom().parentNode).map(ie)},Be=function(n){return bn(n.dom().childNodes,ie)},Ve=(he("element","offset"),function(n,e){(function(n){return e=n.dom().childNodes,A.from(e[0]).map(ie);var e})(n).fold((function(){Ne(n,e)}),(function(t){n.dom().insertBefore(e.dom(),t.dom())}))}),Ne=function(n,e){n.dom().appendChild(e.dom())},_e=function(n,e){wn(e,(function(e){Ne(n,e)}))},je=function(n){n.dom().textContent="",wn(Be(n),(function(n){He(n)}))},He=function(n){var e=n.dom();null!==e.parentNode&&e.parentNode.removeChild(e)},ze=function(n){Qn(n,Jn());var e=n.components();wn(e,ze)},Le=function(n){var e=n.components();wn(e,Le),Qn(n,Xn())},Pe=function(n,e){$e(n,e,Ne)},$e=function(n,e,t){n.getSystem().addToWorld(e),t(n.element(),e.element()),ge(n.element())&&Le(e),n.syncComponents()},We=function(n){ze(n),He(n.element()),n.getSystem().removeFromWorld(n)},Ue=function(n){var e=Re(n.element()).bind((function(e){return n.getSystem().getByDom(e).fold(A.none,A.some)}));We(n),e.each((function(n){n.syncComponents()}))},Ge=function(n){return{is:function(e){return n===e},isValue:p,isError:v,getOr:r(n),getOrThunk:r(n),getOrDie:r(n),or:function(e){return Ge(n)},orThunk:function(e){return Ge(n)},fold:function(e,t){return t(n)},map:function(e){return Ge(e(n))},mapError:function(e){return Ge(n)},each:function(e){e(n)},bind:function(e){return e(n)},exists:function(e){return e(n)},forall:function(e){return e(n)},toOption:function(){return A.some(n)}}},qe=function(n){return{is:v,isValue:v,isError:p,getOr:o,getOrThunk:function(n){return n()},getOrDie:function(){return m(String(n))()},or:function(n){return n},orThunk:function(n){return n()},fold:function(e,t){return e(n)},map:function(e){return qe(n)},mapError:function(e){return qe(e(n))},each:e,bind:function(e){return qe(n)},exists:v,forall:p,toOption:A.none}},Ye={value:Ge,error:qe,fromOption:function(n,e){return n.fold((function(){return qe(e)}),Ge)}},Ke=function(e){if(!w(e))throw new Error("cases must be an array");if(0===e.length)throw new Error("there must be at least one case");var t=[],r={};return wn(e,(function(o,i){var u=F(o);if(1!==u.length)throw new Error("one and only one name per case");var c=u[0],a=o[c];if(void 0!==r[c])throw new Error("duplicate key detected:"+c);if("cata"===c)throw new Error("cannot have a case named cata (sorry)");if(!w(a))throw new Error("case arguments must be an array");t.push(c),r[c]=function(){var r=arguments.length;if(r!==a.length)throw new Error("Wrong number of arguments to case "+c+". Expected "+a.length+" ("+a+"), got "+r);for(var o=new Array(r),u=0;u<o.length;u++)o[u]=arguments[u];return{fold:function(){if(arguments.length!==e.length)throw new Error("Wrong number of arguments to fold. Expected "+e.length+", got "+arguments.length);return arguments[i].apply(null,o)},match:function(n){var e=F(n);if(t.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+t.join(",")+"\nActual: "+e.join(","));if(!In(t,(function(n){return yn(e,n)})))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+t.join(", "));return n[c].apply(null,o)},log:function(e){n.console.log(e,{constructors:t,constructor:c,params:o})}}}})),r},Xe=Ke([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),Je=function(n){return Xe.defaultedThunk(r(n))},Qe=Xe.strict,Ze=Xe.asOption,nt=Xe.defaultedThunk,et=Xe.mergeWithThunk,tt=(Ke([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(n){var e=[],t=[];return wn(n,(function(n){n.fold((function(n){e.push(n)}),(function(n){t.push(n)}))})),{errors:e,values:t}}),rt=function(n){return t(Ye.error,Cn)(n)},ot=function(n,e){var t,r,o=tt(n);return 0<o.errors.length?rt(o.errors):(t=o.values,r=e,Ye.value(C.apply(void 0,[r].concat(t))))},it=function(n){return function(e){return e.hasOwnProperty(n)?A.from(e[n]):A.none()}},ut=function(n,e){return it(e)(n)},ct=function(n,e){var t={};return t[n]=e,t},at=function(n,e){return t=n,r={},wn(e,(function(n){void 0!==t[n]&&t.hasOwnProperty(n)&&(r[n]=t[n])})),r;var t,r},st=function(n){return it(n)},ft=function(n,e){return t=n,r=e,function(n){return it(t)(n).getOr(r)};var t,r},lt=function(n,e){return ut(n,e)},dt=function(n,e){return ct(n,e)},mt=function(n){return e={},wn(n,(function(n){e[n.key]=n.value})),e;var e},gt=function(n,e){return ot(n,e)},vt=function(n,e){return r=e,(t=n).hasOwnProperty(r)&&void 0!==t[r]&&null!==t[r];var t,r},pt=Ke([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),ht=Ke([{field:["name","presence","type"]},{state:["name"]}]),yt=function(n,e,t){return function(n,e){var t=function(n,e){return function(n,e){for(var t=null!=e?e:se,r=0;r<n.length&&null!=t;++r)t=t[n[r]];return t}(n.split("."),e)}(n,e);if(null==t)throw new Error(n+" not available on this browser");return t}("JSON").stringify(n,e,t)},bt=function(n){return b(n)&&100<F(n).length?" removed due to size":yt(n,null,2)},wt=function(n,e){return Ye.error([{path:n,getErrorInfo:e}])},xt=Ke([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),Tt=function(n,e,t){var r=ut(n,e).fold((function(){return t(n)}),o);return Ye.value(r)},St=function(n){return{extract:function(e,t,r){return n(r,t).fold((function(n){return t=n,wt(e,(function(){return t}));var t}),Ye.value)},toString:function(){return"val"},toDsl:function(){return pt.itemOf(n)}}},Ot=function(n){var e=kt(n),t=Tn(n,(function(n,e){return e.fold((function(e){return C(n,dt(e,!0))}),r(n))}),{});return{extract:function(n,r,o){var i,u,c,a=x(o)?[]:(u=F(i=o),xn(u,(function(n){return vt(i,n)}))),s=xn(a,(function(n){return!vt(t,n)}));return 0===s.length?e.extract(n,r,o):(c=s,wt(n,(function(){return"There are unsupported fields: ["+c.join(", ")+"] specified"})))},toString:e.toString,toDsl:e.toDsl}},kt=function(n){return{extract:function(e,t,o){return i=e,u=o,c=t,a=bn(n,(function(n){return function(n,e,t,o){return t.fold((function(t,i,u,c){var a=function(e){return c.extract(n.concat([t]),o,e).map((function(n){return ct(i,o(n))}))},s=function(e){return e.fold((function(){var n=ct(i,o(A.none()));return Ye.value(n)}),(function(e){return c.extract(n.concat([t]),o,e).map((function(n){return ct(i,o(A.some(n)))}))}))};return u.fold((function(){return function(n,e,t){return ut(e,t).fold((function(){return r=t,o=e,wt(n,(function(){return'Could not find valid *strict* value for "'+r+'" in '+bt(o)}));var r,o}),Ye.value)}(n,e,t).bind(a)}),(function(n){return Tt(e,t,n).bind(a)}),(function(){return(n=e,r=t,Ye.value(ut(n,r))).bind(s);var n,r}),(function(n){return(r=e,o=t,i=n,u=ut(r,o).map((function(n){return!0===n?i(r):n})),Ye.value(u)).bind(s);var r,o,i,u}),(function(n){var o=n(e);return Tt(e,t,r({})).map((function(n){return C(o,n)})).bind(a)}))}),(function(n,t){var r=t(e);return Ye.value(ct(n,o(r)))}))}(i,u,n,c)})),ot(a,{});var i,u,c,a},toString:function(){return"obj{\n"+bn(n,(function(n){return n.fold((function(n,e,t,r){return n+" -> "+r.toString()}),(function(n,e){return"state("+n+")"}))})).join("\n")+"}"},toDsl:function(){return pt.objOf(bn(n,(function(n){return n.fold((function(n,e,t,r){return ht.field(n,t,r)}),(function(n,e){return ht.state(n)}))})))}}},Ct=function(n,e){var t=function(e,t){return(r=St(n),{extract:function(n,e,t){return function(n){var e=tt(n);return 0<e.errors.length?rt(e.errors):Ye.value(e.values)}(bn(t,(function(t,o){return r.extract(n.concat(["["+o+"]"]),e,t)})))},toString:function(){return"array("+r.toString()+")"},toDsl:function(){return pt.arrOf(r)}}).extract(e,o,t);var r};return{extract:function(n,r,o){var i=F(o);return t(n,i).bind((function(t){var i=bn(t,(function(n){return xt.field(n,n,Qe(),e)}));return kt(i).extract(n,r,o)}))},toString:function(){return"setOf("+e.toString()+")"},toDsl:function(){return pt.setOf(n,e)}}},Et=r(St(Ye.value)),It=xt.state,Dt=xt.field,Mt=St(Ye.value),At=function(n,e,t,r){return e.extract([n],t,r).fold((function(n){return Ye.error({input:r,errors:n})}),Ye.value)},Ft=function(n,e,t){return At(n,e,r,t)},Rt=function(n){return n.fold((function(n){throw new Error(Nt(n))}),o)},Bt=function(n,e,t){return Rt(At(n,e,o,t))},Vt=function(n,e,t){return Rt(Ft(n,e,t))},Nt=function(n){return"Errors: \n"+(t=10<(e=n.errors).length?e.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):e,bn(t,(function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()}))+"\n\nInput object: ")+bt(n.input);var e,t},_t=function(n,e){return function(n,e){return{extract:function(t,r,o){return lt(o,n).fold((function(){return e=n,wt(t,(function(){return'Choice schema did not contain choice key: "'+e+'"'}));var e}),(function(n){return function(n,e,t,r,o){return lt(r,o).fold((function(){return e=r,t=o,wt(n,(function(){return'The chosen schema: "'+t+'" did not exist in branches: '+bt(e)}));var e,t}),(function(r){return kt(r).extract(n.concat(["branch: "+o]),e,t)}))}(t,r,o,e,n)}))},toString:function(){return"chooseOn("+n+"). Possible values: "+F(e)},toDsl:function(){return pt.choiceOf(n,e)}}}(n,e)},jt=r(Mt),Ht=(f=T,St((function(n){var e=typeof n;return f(n)?Ye.value(n):Ye.error("Expected type: function but got: "+e)}))),zt=function(n){return Dt(n,n,Qe(),Et())},Lt=function(n,e){return Dt(n,n,Qe(),e)},Pt=function(n){return Lt(n,Ht)},$t=function(n,e){return Dt(n,n,Qe(),kt(e))},Wt=function(n){return Dt(n,n,Ze(),Et())},Ut=function(n,e){return Dt(n,n,Ze(),kt(e))},Gt=function(n,e){return Dt(n,n,Ze(),Ot(e))},qt=function(n,e){return Dt(n,n,Je(e),Et())},Yt=function(n,e,t){return Dt(n,n,Je(e),t)},Kt=function(n,e){return It(n,e)},Xt=function(n){if(!vt(n,"can")&&!vt(n,"abort")&&!vt(n,"run"))throw new Error("EventHandler defined by: "+yt(n,null,2)+" does not have can, abort, or run!");return Bt("Extracting event.handler",Ot([qt("can",r(!0)),qt("abort",r(!1)),qt("run",e)]),n)},Jt=function(n){return mt(n)},Qt=function(n,e){return{key:n,value:Xt({abort:e})}},Zt=function(n,e){return{key:n,value:Xt({run:e})}},nr=function(n,e,t){return{key:n,value:Xt({run:function(n){e.apply(void 0,[n].concat(t))}})}},er=function(n){return function(e){return{key:n,value:Xt({run:function(n,t){var r;r=t,Me(n.element(),r.event().target())&&e(n,t)}})}}},tr=function(n,e,t){var r,o,i=e.partUids()[t];return o=i,Zt(r=n,(function(n,e){n.getSystem().getByUid(o).each((function(n){var t,o,i,u;o=(t=n).element(),i=r,u=e,t.getSystem().triggerEvent(i,o,u.event())}))}))},rr=function(n){return Zt(n,(function(n,e){e.cut()}))},or=er(Xn()),ir=er(Jn()),ur=er(Yn()),cr=(l=$n(),function(n){return Zt(l,n)}),ar=function(n){return bn(n,(function(n){return t="/*",r=(e=n).length-"/*".length,e.length<t.length||e.substr(r,r+t.length)!==t?n:n.substring(0,n.length-"/*".length);var e,t,r}))},sr=function(n,e){var t=n.toString(),r=t.indexOf(")")+1,o=t.indexOf("("),i=t.substring(o+1,r-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:e,parameters:ar(i)}},n},fr=Se(["tag"],["classes","attributes","styles","value","innerHtml","domChildren","defChildren"]),lr=Se([],["classes","attributes","styles","value","innerHtml","defChildren","domChildren"]),dr=function(n,e,t){return e.fold((function(){return t.fold((function(){return{}}),(function(e){return dt(n,e)}))}),(function(e){return t.fold((function(){return dt(n,e)}),(function(e){return dt(n,e)}))}))},mr=function(n,e,t){return ur((function(r,o){t(r,n,e)}))},gr=function(n){return{key:n,value:void 0}},vr=function(n,e,t,o,u,c,a){var s=function(n){return vt(n,t)?n[t]():A.none()},f=B(u,(function(n,e){return function(n,e,t){var o,i,u,c,a,s;return o=function(o){for(var i=[],u=1;u<arguments.length;u++)i[u-1]=arguments[u];var c=[o].concat(i);return o.config({name:r(n)}).fold((function(){throw new Error("We could not find any behaviour configuration for: "+n+". Using API: "+t)}),(function(n){var t=Array.prototype.slice.call(c,1);return e.apply(void 0,[o,n.config,n.state].concat(t))}))},i=t,c=(u=e.toString()).indexOf(")")+1,a=u.indexOf("("),s=u.substring(a+1,c-1).split(/,\s*/),o.toFunctionAnnotation=function(){return{name:i,parameters:ar(s.slice(0,1).concat(s.slice(3)))}},o}(t,n,e)})),l=B(c,(function(n,e){return sr(n,e)})),d=C(l,f,{revoke:i(gr,t),config:function(e){var r=Vt(t+"-config",n,e);return{key:t,value:{config:r,me:d,configAsRaw:X((function(){return Bt(t+"-config",n,e)})),initialConfig:e,state:a}}},schema:function(){return e},exhibit:function(n,e){return s(n).bind((function(n){return lt(o,"exhibit").map((function(t){return t(e,n.config,n.state)}))})).getOr(lr({}))},name:function(){return t},handlers:function(n){return s(n).bind((function(n){return lt(o,"events").map((function(e){return e(n.config,n.state)}))})).getOr({})}});return d},pr=function(n,e){return hr(n,e,{validate:T,label:"function"})},hr=function(n,e,t){if(0===e.length)throw new Error("You must specify at least one required field.");return xe("required",e),Te(e),function(r){var o=F(r);In(e,(function(n){return yn(o,n)}))||be(e,o),n(e,o);var i=xn(e,(function(n){return!t.validate(r[n],n)}));return 0<i.length&&function(n,e){throw new Error("All values need to be of type: "+e+". Keys ("+ye(n).join(", ")+") were not.")}(i,t.label),r}},yr=function(n,e){var t=xn(e,(function(e){return!yn(n,e)}));0<t.length&&we(t)},br=e,wr=function(n){return pr(yr,n)},xr={init:function(){return Tr({readState:function(){return"No State required"}})}},Tr=function(n){return pr(br,["readState"])(n),n},Sr=function(n){return mt(n)},Or=Ot([zt("fields"),zt("name"),qt("active",{}),qt("apis",{}),qt("state",xr),qt("extra",{})]),kr=function(n){var e,t,r,o,i,u,c,a,s=Bt("Creating behaviour: "+n.name,Or,n);return e=s.fields,t=s.name,r=s.active,o=s.apis,i=s.extra,u=s.state,c=Ot(e),a=Ut(t,[Gt("config",e)]),vr(c,a,t,r,o,i,u)},Cr=Ot([zt("branchKey"),zt("branches"),zt("name"),qt("active",{}),qt("apis",{}),qt("state",xr),qt("extra",{})]),Er=r(void 0),Ir=function(e,t,r){if(!(y(r)||x(r)||S(r)))throw n.console.error("Invalid call to Attr.set. Key ",t,":: Value ",r,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,r+"")},Dr=function(n,e,t){Ir(n.dom(),e,t)},Mr=function(n,e){var t=n.dom();R(e,(function(n,e){Ir(t,e,n)}))},Ar=function(n,e){var t=n.dom().getAttribute(e);return null===t?void 0:t},Fr=function(n,e){var t=n.dom();return!(!t||!t.hasAttribute)&&t.hasAttribute(e)},Rr=function(n,e){n.dom().removeAttribute(e)},Br=function(n,e){var t=Ar(n,e);return void 0===t||""===t?[]:t.split(" ")},Vr=function(n){return void 0!==n.dom().classList},Nr=function(n){return Br(n,"class")},_r=function(n,e){return r=e,o=Br(t=n,"class").concat([r]),Dr(t,"class",o.join(" ")),!0;var t,r,o},jr=function(n,e){return o=e,0<(i=xn(Br(t=n,r="class"),(function(n){return n!==o}))).length?Dr(t,r,i.join(" ")):Rr(t,r),!1;var t,r,o,i},Hr=function(n,e){Vr(n)?n.dom().classList.add(e):_r(n,e)},zr=function(n,e){var t;Vr(n)?n.dom().classList.remove(e):jr(n,e),0===(Vr(t=n)?t.dom().classList:Nr(t)).length&&Rr(t,"class")},Lr=function(n,e){return Vr(n)&&n.dom().classList.contains(e)},Pr=function(n,e,t){zr(n,t),Hr(n,e)},$r=Object.freeze({toAlpha:function(n,e,t){Pr(n.element(),e.alpha(),e.omega())},toOmega:function(n,e,t){Pr(n.element(),e.omega(),e.alpha())},isAlpha:function(n,e,t){return Lr(n.element(),e.alpha())},isOmega:function(n,e,t){return Lr(n.element(),e.omega())},clear:function(n,e,t){zr(n.element(),e.alpha()),zr(n.element(),e.omega())}}),Wr=[zt("alpha"),zt("omega")],Ur=kr({fields:Wr,name:"swapping",apis:$r}),Gr=function(n){var e=n,t=function(){return e};return{get:t,set:function(n){e=n},clone:function(){return Gr(t())}}};function qr(n,e,t,r,o){return n(t,r)?A.some(t):T(o)&&o(t)?A.none():e(t,r,o)}var Yr=function(n,e,t){for(var o=n.dom(),i=T(t)?t:r(!1);o.parentNode;){o=o.parentNode;var u=ie(o);if(e(u))return A.some(u);if(i(u))break}return A.none()},Kr=function(n,e,t){return qr((function(n,e){return e(n)}),Yr,n,e,t)},Xr=function(n){n.dom().focus()},Jr=function(n){n.dom().blur()},Qr=function(e){var t=void 0!==e?e.dom():n.document;return A.from(t.activeElement).map(ie)},Zr=function(n){return Qr(Ae(n)).filter((function(e){return n.dom().contains(e.dom())}))},no=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),eo=tinymce.util.Tools.resolve("tinymce.ThemeManager"),to=function(e){var t=n.document.createElement("a");t.target="_blank",t.href=e.href,t.rel="noreferrer noopener";var r=n.document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,n.window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.document.body.appendChild(t),t.dispatchEvent(r),n.document.body.removeChild(t)},ro={formatChanged:r("formatChanged"),orientationChanged:r("orientationChanged"),dropupDismissed:r("dropupDismissed")},oo=function(n){return n.dom().innerHTML},io=function(n){return function(n){var e,t,r;return e=function(n){return ie(n.dom().cloneNode(!1))}(n),t=oe("div"),r=ie(e.dom().cloneNode(!0)),Ne(t,r),oo(t)}(n)},uo=Object.freeze({events:function(n){return Jt([Zt(Pn(),(function(e,t){var r,o,i=n.channels(),u=(r=F(i),(o=t).universal()?r:xn(r,(function(n){return yn(o.channels(),n)})));wn(u,(function(n){var r=i[n](),o=r.schema(),u=Vt("channel["+n+"] data\nReceiver: "+io(e.element()),o,t.data());r.onReceive()(e,u)}))}))])}}),co=function(n){for(var e=[],t=function(n){e.push(n)},r=0;r<n.length;r++)n[r].each(t);return e},ao=[],so=["alloy/data/Fields","alloy/debugging/Debugging"],fo={logEventCut:e,logEventStopped:e,logNoParent:e,logEventNoHandlers:e,logEventResponse:e,write:e},lo=function(e,t,r){var o,i="*"===ao||yn(ao,e)?(o=[],{logEventCut:function(n,e,t){o.push({outcome:"cut",target:e,purpose:t})},logEventStopped:function(n,e,t){o.push({outcome:"stopped",target:e,purpose:t})},logNoParent:function(n,e,t){o.push({outcome:"no-parent",target:e,purpose:t})},logEventNoHandlers:function(n,e){o.push({outcome:"no-handlers-left",target:e})},logEventResponse:function(n,e,t){o.push({outcome:"response",purpose:t,target:e})},write:function(){yn(["mousemove","mouseover","mouseout",Yn()],e)||n.console.log(e,{event:e,target:t.dom(),sequence:bn(o,(function(n){return yn(["cut","stopped","response"],n.outcome)?"{"+n.purpose+"} "+n.outcome+" at ("+io(n.target)+")":n.outcome}))})}}):fo,u=r(i);return i.write(),u},mo=r([zt("menu"),zt("selectedMenu")]),go=r([zt("item"),zt("selectedItem")]),vo=(r(Ot(go().concat(mo()))),r(Ot(go()))),po=$t("initSize",[zt("numColumns"),zt("numRows")]),ho=function(n,e,t){var r;return function(){var n=new Error;if(void 0!==n.stack){var e=n.stack.split("\n");On(e,(function(n){return 0<n.indexOf("alloy")&&!function(n,e){for(var t=0,r=n.length;t<r;t++)if(e(n[t]))return!0;return!1}(so,(function(e){return-1<n.indexOf(e)}))})).getOr("unknown")}}(),Dt(e,e,t,(r=function(n){return Ye.value((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.apply(void 0,e)}))},St((function(n){return r(n)}))))},yo=function(n){return ho(0,n,Je(e))},bo=function(n){return ho(0,n,Je(A.none))},wo=function(n){return ho(0,n,Qe())},xo=function(n){return ho(0,n,Qe())},To=function(n,e){return Kt(n,r(e))},So=function(n){return Kt(n,o)},Oo=r(po),ko=[Lt("channels",Ct(Ye.value,Ot([wo("onReceive"),qt("schema",jt())])))],Co=kr({fields:ko,name:"receiving",active:uo}),Eo=function(n,e){var t=Ao(n,e),r=e.aria();r.update()(n,r,t)},Io=function(n,e,t){(function(n,e){return Vr(n)?n.dom().classList.toggle(e):(r=e,yn(Nr(t=n),r)?jr(t,r):_r(t,r));var t,r})(n.element(),e.toggleClass()),Eo(n,e)},Do=function(n,e,t){Hr(n.element(),e.toggleClass()),Eo(n,e)},Mo=function(n,e,t){zr(n.element(),e.toggleClass()),Eo(n,e)},Ao=function(n,e){return Lr(n.element(),e.toggleClass())},Fo=function(n,e,t){(e.selected()?Do:Mo)(n,e,t)},Ro=Object.freeze({onLoad:Fo,toggle:Io,isOn:Ao,on:Do,off:Mo}),Bo=Object.freeze({exhibit:function(n,e,t){return lr({})},events:function(n,e){var t,r,o,i=(t=n,r=e,o=Io,cr((function(n){o(n,t,r)}))),u=mr(n,e,Fo);return Jt(Cn([n.toggleOnExecute()?[i]:[],[u]]))}}),Vo=function(n,e,t){Dr(n.element(),"aria-expanded",t)},No=[qt("selected",!1),zt("toggleClass"),qt("toggleOnExecute",!0),Yt("aria",{mode:"none"},_t("mode",{pressed:[qt("syncWithExpanded",!1),To("update",(function(n,e,t){Dr(n.element(),"aria-pressed",t),e.syncWithExpanded()&&Vo(n,0,t)}))],checked:[To("update",(function(n,e,t){Dr(n.element(),"aria-checked",t)}))],expanded:[To("update",Vo)],selected:[To("update",(function(n,e,t){Dr(n.element(),"aria-selected",t)}))],none:[To("update",e)]}))],_o=kr({fields:No,name:"toggling",active:Bo,apis:Ro}),jo=function(n,e){return Co.config({channels:dt(ro.formatChanged(),{onReceive:function(t,r){r.command===n&&e(t,r.state)}})})},Ho=function(n){return Co.config({channels:dt(ro.orientationChanged(),{onReceive:n})})},zo=function(n,e){return{key:n,value:{onReceive:e}}},Lo="tinymce-mobile",Po={resolve:function(n){return Lo+"-"+n},prefix:r(Lo)},$o=function(n,e){e.ignore()||(Xr(n.element()),e.onFocus()(n))},Wo=Object.freeze({focus:$o,blur:function(n,e){e.ignore()||Jr(n.element())},isFocused:function(n){return e=n.element(),t=Ae(e).dom(),e.dom()===t.activeElement;var e,t}}),Uo=Object.freeze({exhibit:function(n,e){return e.ignore()?lr({}):lr({attributes:{tabindex:"-1"}})},events:function(n){return Jt([Zt(zn(),(function(e,t){$o(e,n),t.stop()}))])}}),Go=[yo("onFocus"),qt("ignore",!1)],qo=kr({fields:Go,name:"focusing",active:Uo,apis:Wo}),Yo=function(n){return void 0!==n.style&&T(n.style.getPropertyValue)},Ko=function(e,t,r){if(!y(r))throw n.console.error("Invalid call to CSS.set. Property ",t,":: Value ",r,":: Element ",e),new Error("CSS value must be a string: "+r);Yo(e)&&e.style.setProperty(t,r)},Xo=function(n,e,t){var r=n.dom();Ko(r,e,t)},Jo=function(n,e){var t=n.dom();R(e,(function(n,e){Ko(t,e,n)}))},Qo=function(e,t){var r=e.dom(),o=n.window.getComputedStyle(r).getPropertyValue(t),i=""!==o||ge(e)?o:Zo(r,t);return null===i?void 0:i},Zo=function(n,e){return Yo(n)?n.style.getPropertyValue(e):""},ni=function(n,e){var t=n.dom(),r=Zo(t,e);return A.from(r).filter((function(n){return 0<n.length}))},ei=function(n,e){var t,r,o=n.dom();r=e,Yo(t=o)&&t.style.removeProperty(r),Fr(n,"style")&&""===Ar(n,"style").replace(/^\s+|\s+$/g,"")&&Rr(n,"style")},ti=function(n){return n.dom().offsetWidth};function ri(n,e){var t=function(t){var r=e(t);if(r<=0||null===r){var o=Qo(t,n);return parseFloat(o)||0}return r},r=function(n,e){return Sn(e,(function(e,t){var r=Qo(n,t),o=void 0===r?0:parseInt(r,10);return isNaN(o)?e:e+o}),0)};return{set:function(e,t){if(!S(t)&&!t.match(/^[0-9]+$/))throw new Error(n+".set accepts only positive integer values. Value was "+t);var r=e.dom();Yo(r)&&(r.style[n]=t+"px")},get:t,getOuter:t,aggregate:r,max:function(n,e,t){var o=r(n,t);return o<e?e-o:0}}}var oi,ii,ui,ci,ai,si,fi,li=ri("height",(function(n){var e=n.dom();return ge(n)?e.getBoundingClientRect().height:e.offsetHeight})),di=function(n){return li.get(n)},mi=function(n,e){return Ie(e,n)},gi=function(n){return De(n)},vi=function(n,e,t){return Yr(n,(function(n){return Ce(n,e)}),t)},pi=function(n,e){return De(e,n)},hi=function(n,e,t){return qr(Ce,vi,n,e,t)},yi=function(n,e,t){var r=Dn(n.slice(0,e)),o=Dn(n.slice(e+1));return On(r.concat(o),t)},bi=function(n,e,t){var r=Dn(n.slice(0,e));return On(r,t)},wi=function(n,e,t){var r=n.slice(0,e),o=n.slice(e+1);return On(o.concat(r),t)},xi=function(n,e,t){var r=n.slice(e+1);return On(r,t)},Ti=function(n){return function(e){var t=e.raw();return yn(n,t.which)}},Si=function(n){return function(e){return In(n,(function(n){return n(e)}))}},Oi=function(n){return!0===n.raw().shiftKey},ki=function(n){return!0===n.raw().ctrlKey},Ci=d(Oi),Ei=function(n,e){return{matches:n,classification:e}},Ii=function(n,e,t,r){var o=n+e;return r<o?t:o<t?r:o},Di=function(n,e,t){return n<=e?e:t<=n?t:n},Mi=function(n,e,t){var r=mi(n.element(),"."+e.highlightClass());wn(r,(function(t){zr(t,e.highlightClass()),n.getSystem().getByDom(t).each((function(t){e.onDehighlight()(n,t)}))}))},Ai=function(n,e,t,r){var o=Fi(n,e,t,r);Mi(n,e),Hr(r.element(),e.highlightClass()),o||e.onHighlight()(n,r)},Fi=function(n,e,t,r){return Lr(r.element(),e.highlightClass())},Ri=function(n,e,t){return pi(n.element(),"."+e.itemClass()).bind((function(e){return n.getSystem().getByDom(e).toOption()}))},Bi=function(n,e,t){var r=mi(n.element(),"."+e.itemClass());return(0<r.length?A.some(r[r.length-1]):A.none()).bind((function(e){return n.getSystem().getByDom(e).toOption()}))},Vi=function(n,e,t,r){var o=mi(n.element(),"."+e.itemClass());return kn(o,(function(n){return Lr(n,e.highlightClass())})).bind((function(e){var t=Ii(e,r,0,o.length-1);return n.getSystem().getByDom(o[t]).toOption()}))},Ni=Object.freeze({dehighlightAll:Mi,dehighlight:function(n,e,t,r){var o=Fi(n,e,t,r);zr(r.element(),e.highlightClass()),o&&e.onDehighlight()(n,r)},highlight:Ai,highlightFirst:function(n,e,t){Ri(n,e).each((function(r){Ai(n,e,t,r)}))},highlightLast:function(n,e,t){Bi(n,e).each((function(r){Ai(n,e,t,r)}))},highlightAt:function(n,e,t,r){(function(n,e,t,r){var o=mi(n.element(),"."+e.itemClass());return A.from(o[r]).fold((function(){return Ye.error("No element found with index "+r)}),n.getSystem().getByDom)})(n,e,0,r).fold((function(n){throw new Error(n)}),(function(r){Ai(n,e,t,r)}))},highlightBy:function(n,e,t,r){var o=mi(n.element(),"."+e.itemClass()),i=co(bn(o,(function(e){return n.getSystem().getByDom(e).toOption()})));On(i,r).each((function(r){Ai(n,e,t,r)}))},isHighlighted:Fi,getHighlighted:function(n,e,t){return pi(n.element(),"."+e.highlightClass()).bind((function(e){return n.getSystem().getByDom(e).toOption()}))},getFirst:Ri,getLast:Bi,getPrevious:function(n,e,t){return Vi(n,e,0,-1)},getNext:function(n,e,t){return Vi(n,e,0,1)}}),_i=[zt("highlightClass"),zt("itemClass"),yo("onHighlight"),yo("onDehighlight")],ji=kr({fields:_i,name:"highlighting",apis:Ni}),Hi=function(){return{get:function(n){return Zr(n.element())},set:function(n,e){n.getSystem().triggerFocus(e,n.element())}}},zi=function(n,e,t,r,o,i){var u=function(n,e,r,o){var i,u;return(i=t(n,e,r,o),u=e.event(),On(i,(function(n){return n.matches(u)})).map((function(n){return n.classification}))).bind((function(t){return t(n,e,r,o)}))},c={schema:function(){return n.concat([qt("focusManager",Hi()),To("handler",c),To("state",e)])},processKey:u,toEvents:function(n,e){var t=r(n,e),o=Jt(i.map((function(t){return Zt(zn(),(function(r,o){t(r,n,e,o),o.stop()}))})).toArray().concat([Zt(W(),(function(t,r){u(t,r,n,e).each((function(n){r.stop()}))}))]));return C(t,o)},toApis:o};return c},Li=function(n){var e=[Wt("onEscape"),Wt("onEnter"),qt("selector",'[data-alloy-tabstop="true"]'),qt("firstTabstop",0),qt("useTabstopAt",r(!0)),Wt("visibilitySelector")].concat([n]),t=function(n,e){var t=n.visibilitySelector().bind((function(n){return hi(e,n)})).getOr(e);return 0<di(t)},o=function(n,e,r,o,i){return i(e,r,(function(n){return t(e=o,r=n)&&e.useTabstopAt()(r);var e,r})).fold((function(){return o.cyclic()?A.some(!0):A.none()}),(function(e){return o.focusManager().set(n,e),A.some(!0)}))},u=function(n,e,t,r){var u,c,a=mi(n.element(),t.selector());return(u=n,c=t,c.focusManager().get(u).bind((function(n){return hi(n,c.selector())}))).bind((function(e){return kn(a,i(Me,e)).bind((function(e){return o(n,a,e,t,r)}))}))},c=r([Ei(Si([Oi,Ti([9])]),(function(n,e,t,r){var o=t.cyclic()?yi:bi;return u(n,0,t,o)})),Ei(Ti([9]),(function(n,e,t,r){var o=t.cyclic()?wi:xi;return u(n,0,t,o)})),Ei(Ti([27]),(function(n,e,t,r){return t.onEscape().bind((function(t){return t(n,e)}))})),Ei(Si([Ci,Ti([13])]),(function(n,e,t,r){return t.onEnter().bind((function(t){return t(n,e)}))}))]),a=r({}),s=r({});return zi(e,xr.init,c,a,s,A.some((function(n,e){var r,o,i,u;(r=n,o=e,i=mi(r.element(),o.selector()),u=xn(i,(function(n){return t(o,n)})),A.from(u[o.firstTabstop()])).each((function(t){e.focusManager().set(n,t)}))})))},Pi=Li(Kt("cyclic",r(!1))),$i=Li(Kt("cyclic",r(!0))),Wi=function(n){return"input"===fe(n)&&"radio"!==Ar(n,"type")||"textarea"===fe(n)},Ui=function(n,e,t){return Wi(t)&&Ti([32])(e.event())?A.none():(ee(n,t,$n()),A.some(!0))},Gi=[qt("execute",Ui),qt("useSpace",!1),qt("useEnter",!0),qt("useControlEnter",!1),qt("useDown",!1)],qi=function(n,e,t){return t.execute()(n,e,n.element())},Yi=r({}),Ki=r({}),Xi=zi(Gi,xr.init,(function(n,e,t,r){var o=t.useSpace()&&!Wi(n.element())?[32]:[],i=t.useEnter()?[13]:[],u=t.useDown()?[40]:[],c=o.concat(i).concat(u);return[Ei(Ti(c),qi)].concat(t.useControlEnter()?[Ei(Si([ki,Ti([13])]),qi)]:[])}),Yi,Ki,A.none()),Ji=function(n){var e=Gr(A.none());return Tr({readState:r({}),setGridSize:function(n,t){e.set(A.some({numRows:r(n),numColumns:r(t)}))},getNumRows:function(){return e.get().map((function(n){return n.numRows()}))},getNumColumns:function(){return e.get().map((function(n){return n.numColumns()}))}})},Qi=Object.freeze({flatgrid:Ji,init:function(n){return n.state()(n)}}),Zi=function(n,e){return function(t){return"rtl"===nu(t)?e:n}},nu=function(n){return"rtl"===Qo(n,"direction")?"rtl":"ltr"},eu=function(n){return function(e,t,r,o){var i=n(e.element());return iu(i,e,t,r,o)}},tu=function(n,e){var t=Zi(n,e);return eu(t)},ru=function(n,e){var t=Zi(e,n);return eu(t)},ou=function(n){return function(e,t,r,o){return iu(n,e,t,r,o)}},iu=function(n,e,t,r,o){return r.focusManager().get(e).bind((function(t){return n(e.element(),t,r,o)})).map((function(n){return r.focusManager().set(e,n),!0}))},uu=ou,cu=ou,au=ou,su=function(n){var e;return!((e=n.dom()).offsetWidth<=0&&e.offsetHeight<=0)},fu=Se(["index","candidates"],[]),lu=function(n,e,t){return du(n,e,t)},du=function(n,e,t,r){var o,u=i(Me,e),c=mi(n,t),a=xn(c,su);return kn(o=a,u).map((function(n){return fu({index:n,candidates:o})}))},mu=function(n,e){return kn(n,(function(n){return Me(e,n)}))},gu=function(n,e,t,r){return r(Math.floor(e/t),e%t).bind((function(e){var r=e.row()*t+e.column();return 0<=r&&r<n.length?A.some(n[r]):A.none()}))},vu=function(n,e,t,o,i){return gu(n,e,o,(function(e,u){var c=e===t-1?n.length-e*o:o,a=Ii(u,i,0,c-1);return A.some({row:r(e),column:r(a)})}))},pu=function(n,e,t,o,i){return gu(n,e,o,(function(e,u){var c=Ii(e,i,0,t-1),a=c===t-1?n.length-c*o:o,s=Di(u,0,a-1);return A.some({row:r(c),column:r(s)})}))},hu=[zt("selector"),qt("execute",Ui),bo("onEscape"),qt("captureTab",!1),Oo()],yu=function(n){return function(e,t,r,o){return lu(e,t,r.selector()).bind((function(e){return n(e.candidates(),e.index(),o.getNumRows().getOr(r.initSize().numRows()),o.getNumColumns().getOr(r.initSize().numColumns()))}))}},bu=function(n,e,t,r){return t.captureTab()?A.some(!0):A.none()},wu=yu((function(n,e,t,r){return vu(n,e,t,r,-1)})),xu=yu((function(n,e,t,r){return vu(n,e,t,r,1)})),Tu=yu((function(n,e,t,r){return pu(n,e,t,r,-1)})),Su=yu((function(n,e,t,r){return pu(n,e,t,r,1)})),Ou=r([Ei(Ti([37]),tu(wu,xu)),Ei(Ti([39]),ru(wu,xu)),Ei(Ti([38]),uu(Tu)),Ei(Ti([40]),cu(Su)),Ei(Si([Oi,Ti([9])]),bu),Ei(Si([Ci,Ti([9])]),bu),Ei(Ti([27]),(function(n,e,t,r){return t.onEscape()(n,e)})),Ei(Ti([32].concat([13])),(function(n,e,t,r){return(o=n,i=t,i.focusManager().get(o).bind((function(n){return hi(n,i.selector())}))).bind((function(r){return t.execute()(n,e,r)}));var o,i}))]),ku=r({}),Cu=zi(hu,Ji,Ou,ku,{},A.some((function(n,e,t){pi(n.element(),e.selector()).each((function(t){e.focusManager().set(n,t)}))}))),Eu=function(n,e,t,r){return lu(n,t,e).bind((function(n){var e=n.index(),t=n.candidates(),o=Ii(e,r,0,t.length-1);return A.from(t[o])}))},Iu=[zt("selector"),qt("getInitial",A.none),qt("execute",Ui),qt("executeOnMove",!1),qt("allowVertical",!0)],Du=function(n,e,t){return(r=n,o=t,o.focusManager().get(r).bind((function(n){return hi(n,o.selector())}))).bind((function(r){return t.execute()(n,e,r)}));var r,o},Mu=function(n,e,t){return Eu(n,t.selector(),e,-1)},Au=function(n,e,t){return Eu(n,t.selector(),e,1)},Fu=function(n){return function(e,t,r){return n(e,t,r).bind((function(){return r.executeOnMove()?Du(e,t,r):A.some(!0)}))}},Ru=r({}),Bu=r({}),Vu=zi(Iu,xr.init,(function(n,e,t,r){var o=[37].concat(t.allowVertical()?[38]:[]),i=[39].concat(t.allowVertical()?[40]:[]);return[Ei(Ti(o),Fu(tu(Mu,Au))),Ei(Ti(i),Fu(ru(Mu,Au))),Ei(Ti([13]),Du),Ei(Ti([32]),Du)]}),Ru,Bu,A.some((function(n,e){e.getInitial()(n).or(pi(n.element(),e.selector())).each((function(t){e.focusManager().set(n,t)}))}))),Nu=Se(["rowIndex","columnIndex","cell"],[]),_u=function(n,e,t){return A.from(n[e]).bind((function(n){return A.from(n[t]).map((function(n){return Nu({rowIndex:e,columnIndex:t,cell:n})}))}))},ju=function(n,e,t,r){var o=n[e].length,i=Ii(t,r,0,o-1);return _u(n,e,i)},Hu=function(n,e,t,r){var o=Ii(t,r,0,n.length-1),i=n[o].length,u=Di(e,0,i-1);return _u(n,o,u)},zu=function(n,e,t,r){var o=n[e].length,i=Di(t+r,0,o-1);return _u(n,e,i)},Lu=function(n,e,t,r){var o=Di(t+r,0,n.length-1),i=n[o].length,u=Di(e,0,i-1);return _u(n,o,u)},Pu=[$t("selectors",[zt("row"),zt("cell")]),qt("cycles",!0),qt("previousSelector",A.none),qt("execute",Ui)],$u=function(n,e){return function(t,r,o){var i=o.cycles()?n:e;return hi(r,o.selectors().row()).bind((function(n){var e=mi(n,o.selectors().cell());return mu(e,r).bind((function(e){var r=mi(t,o.selectors().row());return mu(r,n).bind((function(n){var t,u=(t=o,bn(r,(function(n){return mi(n,t.selectors().cell())})));return i(u,n,e).map((function(n){return n.cell()}))}))}))}))}},Wu=$u((function(n,e,t){return ju(n,e,t,-1)}),(function(n,e,t){return zu(n,e,t,-1)})),Uu=$u((function(n,e,t){return ju(n,e,t,1)}),(function(n,e,t){return zu(n,e,t,1)})),Gu=$u((function(n,e,t){return Hu(n,t,e,-1)}),(function(n,e,t){return Lu(n,t,e,-1)})),qu=$u((function(n,e,t){return Hu(n,t,e,1)}),(function(n,e,t){return Lu(n,t,e,1)})),Yu=r([Ei(Ti([37]),tu(Wu,Uu)),Ei(Ti([39]),ru(Wu,Uu)),Ei(Ti([38]),uu(Gu)),Ei(Ti([40]),cu(qu)),Ei(Ti([32].concat([13])),(function(n,e,t){return Zr(n.element()).bind((function(r){return t.execute()(n,e,r)}))}))]),Ku=r({}),Xu=r({}),Ju=zi(Pu,xr.init,Yu,Ku,Xu,A.some((function(n,e){e.previousSelector()(n).orThunk((function(){var t=e.selectors();return pi(n.element(),t.cell())})).each((function(t){e.focusManager().set(n,t)}))}))),Qu=[zt("selector"),qt("execute",Ui),qt("moveOnTab",!1)],Zu=function(n,e,t){return t.focusManager().get(n).bind((function(r){return t.execute()(n,e,r)}))},nc=function(n,e,t){return Eu(n,t.selector(),e,-1)},ec=function(n,e,t){return Eu(n,t.selector(),e,1)},tc=r([Ei(Ti([38]),au(nc)),Ei(Ti([40]),au(ec)),Ei(Si([Oi,Ti([9])]),(function(n,e,t){return t.moveOnTab()?au(nc)(n,e,t):A.none()})),Ei(Si([Ci,Ti([9])]),(function(n,e,t){return t.moveOnTab()?au(ec)(n,e,t):A.none()})),Ei(Ti([13]),Zu),Ei(Ti([32]),Zu)]),rc=r({}),oc=r({}),ic=zi(Qu,xr.init,tc,rc,oc,A.some((function(n,e){pi(n.element(),e.selector()).each((function(t){e.focusManager().set(n,t)}))}))),uc=[bo("onSpace"),bo("onEnter"),bo("onShiftEnter"),bo("onLeft"),bo("onRight"),bo("onTab"),bo("onShiftTab"),bo("onUp"),bo("onDown"),bo("onEscape"),Wt("focusIn")],cc=zi(uc,xr.init,(function(n,e,t){return[Ei(Ti([32]),t.onSpace()),Ei(Si([Ci,Ti([13])]),t.onEnter()),Ei(Si([Oi,Ti([13])]),t.onShiftEnter()),Ei(Si([Oi,Ti([9])]),t.onShiftTab()),Ei(Si([Ci,Ti([9])]),t.onTab()),Ei(Ti([38]),t.onUp()),Ei(Ti([40]),t.onDown()),Ei(Ti([37]),t.onLeft()),Ei(Ti([39]),t.onRight()),Ei(Ti([32]),t.onSpace()),Ei(Ti([27]),t.onEscape())]}),(function(){return{}}),(function(){return{}}),A.some((function(n,e){return e.focusIn().bind((function(t){return t(n,e)}))}))),ac=Pi.schema(),sc=$i.schema(),fc=Vu.schema(),lc=Cu.schema(),dc=Ju.schema(),mc=Xi.schema(),gc=ic.schema(),vc=cc.schema(),pc=function(n,e,t,r,o,i){var u,c,a=n,s=Ut(e,[(u="config",c=n,Dt(u,u,Ze(),c))]);return vr(a,s,e,t,r,o,i)}(_t((ii=Bt("Creating behaviour: "+(oi={branchKey:"mode",branches:Object.freeze({acyclic:ac,cyclic:sc,flow:fc,flatgrid:lc,matrix:dc,execution:mc,menu:gc,special:vc}),name:"keying",active:{events:function(n,e){return n.handler().toEvents(n,e)}},apis:{focusIn:function(n){n.getSystem().triggerFocus(n.element(),n.element())},setGridSize:function(e,t,r,o,i){vt(r,"setGridSize")?r.setGridSize(o,i):n.console.error("Layout does not support setGridSize")}},state:Qi}).name,Cr,oi)).branchKey,ii.branches),ii.name,ii.active,ii.apis,ii.extra,ii.state),hc=function(n,e){return t=n,r={},i=bn(e,(function(e){return t=e.name(),r="Cannot configure "+e.name()+" for "+n,Dt(t,t,Ze(),St((function(n){return Ye.error("The field: "+t+" is forbidden. "+r)})));var t,r})).concat([Kt("dump",o)]),Dt(t,t,Je(r),kt(i));var t,r,i},yc=function(n){return n.dump()},bc="placeholder",wc=Ke([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),xc=function(n,e,t,o){return function(n,e,t,o){return t.uiType===bc?(u=t,c=o,(i=n).exists((function(n){return n!==u.owner}))?wc.single(!0,r(u)):lt(c,u.name).fold((function(){throw new Error("Unknown placeholder component: "+u.name+"\nKnown: ["+F(c)+"]\nNamespace: "+i.getOr("none")+"\nSpec: "+yt(u,null,2))}),(function(n){return n.replace()}))):wc.single(!1,r(t));var i,u,c}(n,0,t,o).fold((function(r,i){var u=i(e,t.config,t.validated),c=lt(u,"components").getOr([]),a=En(c,(function(t){return xc(n,e,t,o)}));return[C(u,{components:a})]}),(function(n,r){return r(e,t.config,t.validated)}))},Tc=wc.single,Sc=wc.multiple,Oc=r(bc),kc=0,Cc=function(n){var e=(new Date).getTime();return n+"_"+Math.floor(1e9*Math.random())+ ++kc+String(e)},Ec=Ke([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),Ic=qt("factory",{sketch:o}),Dc=qt("schema",[]),Mc=zt("name"),Ac=Dt("pname","pname",nt((function(n){return"<alloy."+Cc(n.name)+">"})),jt()),Fc=qt("defaults",r({})),Rc=qt("overrides",r({})),Bc=kt([Ic,Dc,Mc,Ac,Fc,Rc]),Vc=kt([Ic,Dc,Mc,Ac,Fc,Rc]),Nc=kt([Ic,Dc,Mc,zt("unit"),Ac,Fc,Rc]),_c=function(n){var e=function(n){return n.name()};return n.fold(e,e,e,e)},jc=function(n,e){return function(t){var r=Vt("Converting part type",e,t);return n(r)}},Hc=jc(Ec.required,Bc),zc=jc(Ec.optional,Vc),Lc=jc(Ec.group,Nc),Pc=r("entirety"),$c=function(n,e,t,r){var o=t;return C(e.defaults()(n,t,r),t,{uid:n.partUids()[e.name()]},e.overrides()(n,t,r),{"debug.sketcher":dt("part-"+e.name(),o)})},Wc=function(n,e,t){return o=e,i={},u={},wn(t,(function(n){n.fold((function(n){i[n.pname()]=Tc(!0,(function(e,t,r){return n.factory().sketch($c(e,n,t,r))}))}),(function(n){var e=o.parts()[n.name()]();u[n.name()]=r($c(o,n,e[Pc()]()))}),(function(n){i[n.pname()]=Tc(!1,(function(e,t,r){return n.factory().sketch($c(e,n,t,r))}))}),(function(n){i[n.pname()]=Sc(!0,(function(e,t,r){var o=e[n.name()]();return bn(o,(function(t){return n.factory().sketch(C(n.defaults()(e,t),t,n.overrides()(e,t)))}))}))}))})),{internals:r(i),externals:r(u)};var o,i,u},Uc=function(n,e,t){return function(n,e,t,o){var i,u,c,a=B(o,(function(n,e){return o=n,i=!1,{name:r(t=e),required:function(){return o.fold((function(n,e){return n}),(function(n,e){return n}))},used:function(){return i},replace:function(){if(!0===i)throw new Error("Trying to use the same placeholder more than once: "+t);return i=!0,o}};var t,o,i})),s=(i=n,u=e,c=a,En(t,(function(n){return xc(i,u,n,c)})));return R(a,(function(t){if(!1===t.used()&&t.required())throw new Error("Placeholder: "+t.name()+" was not found in components list\nNamespace: "+n.getOr("none")+"\nComponents: "+yt(e.components(),null,2))})),s}(A.some(n),e,e.components(),t)},Gc=function(n,e,t){var r=e.partUids()[t];return n.getSystem().getByUid(r).toOption()},qc=function(n,e,t){return Gc(n,e,t).getOrDie("Could not find part: "+t)},Yc=function(n){return Dt("partUids","partUids",et((function(e){return function(n,e){var t=bn(e,_c);return mt(bn(t,(function(e){return{key:e,value:n+"-"+e}})))}(e.uid,n)})),jt())},Kc=Cc("alloy-premade"),Xc=Cc("api"),Jc=function(n){return dt(Kc,n)},Qc=function(n){return e=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=e.config(Xc);return n.apply(void 0,[o].concat([e].concat(t)))},r=(t=n.toString()).indexOf(")")+1,o=t.indexOf("("),i=t.substring(o+1,r-1).split(/,\s*/),e.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:ar(i.slice(1))}},e;var e,t,r,o,i},Zc=r(Xc),na=r("alloy-id-"),ea=r("data-alloy-id"),ta=na(),ra=ea(),oa=function(n){var e=de(n)?Ar(n,ra):null;return A.from(e)},ia=function(n){return Cc(n)},ua=function(n,e,t,r,o){var i,u,c=(u=o,(0<(i=r).length?[$t("parts",i)]:[]).concat([zt("uid"),qt("dom",{}),qt("components",[]),So("originalSpec"),qt("debug.sketcher",{})]).concat(u));return Vt(n+" [SpecSchema]",Ot(c.concat(e)),t)},ca=function(n,e,t,r,o){var i=aa(o),u=En(t,(function(n){return n.fold(A.none,A.some,A.none,A.none).map((function(n){return $t(n.name(),n.schema().concat([So(Pc())]))})).toArray()})),c=Yc(t),a=ua(n,e,i,u,[c]),s=Wc(0,a,t),f=Uc(n,a,s.internals());return C(r(a,f,i,s.externals()),{"debug.sketcher":dt(n,o)})},aa=function(n){return C({uid:ia("uid")},n)},sa=Ot([zt("name"),zt("factory"),zt("configFields"),qt("apis",{}),qt("extraApis",{})]),fa=Ot([zt("name"),zt("factory"),zt("configFields"),zt("partFields"),qt("apis",{}),qt("extraApis",{})]),la=function(n){var e=Bt("Sketcher for "+n.name,sa,n),t=B(e.apis,Qc),o=B(e.extraApis,(function(n,e){return sr(n,e)}));return C({name:r(e.name),partFields:r([]),configFields:r(e.configFields),sketch:function(n){return t=e.name,r=e.configFields,o=e.factory,u=aa(i=n),c=ua(t,r,u,[],[]),C(o(c,u),{"debug.sketcher":dt(t,i)});var t,r,o,i,u,c}},t,o)},da=function(n){var e=Bt("Sketcher for "+n.name,fa,n),t=function(n,e){var t={};return wn(e,(function(e){var r;(r=e,r.fold(A.some,A.none,A.some,A.some)).each((function(e){var r=function(n,e){return{uiType:Oc(),owner:n,name:e}}(n,e.pname());t[e.name()]=function(t){var o=Bt("Part: "+e.name()+" in "+n,kt(e.schema()),t);return C(r,{config:t,validated:o})}}))})),t}(e.name,e.partFields),o=B(e.apis,Qc),i=B(e.extraApis,(function(n,e){return sr(n,e)}));return C({name:r(e.name),partFields:r(e.partFields),configFields:r(e.configFields),sketch:function(n){return ca(e.name,e.configFields,e.partFields,e.factory,n)},parts:r(t)},o,i)},ma=la({name:"Button",factory:function(n){var e,t,r,o=(e=n.action(),t=function(n,e){e.stop(),ne(n)},r=jn.detect().deviceType.isTouch()?[Zt(Un(),t)]:[Zt(q(),t),Zt(z(),(function(n,e){e.cut()}))],Jt(Cn([e.map((function(n){return Zt($n(),(function(e,t){n(e),t.stop()}))})).toArray(),r]))),i=lt(n.dom(),"attributes").bind(st("type")),u=lt(n.dom(),"tag");return{uid:n.uid(),dom:n.dom(),components:n.components(),events:o,behaviours:C(Sr([qo.config({}),pc.config({mode:"execution",useSpace:!0,useEnter:!0})]),yc(n.buttonBehaviours())),domModification:{attributes:C(i.fold((function(){return u.is("button")?{type:"button"}:{}}),(function(n){return{}})),{role:n.role().getOr("button")})},eventOrder:n.eventOrder()}},configFields:[qt("uid",void 0),zt("dom"),qt("components",[]),hc("buttonBehaviours",[qo,pc]),Wt("action"),Wt("role"),qt("eventOrder",{})]}),ga=kr({fields:[],name:"unselecting",active:Object.freeze({events:function(n){return Jt([Qt(K(),r(!0))])},exhibit:function(n,e){return lr({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})}})}),va=function(e){var t,r;return function(e){var t,r,o,i=function(e,t){var r=(t||n.document).createElement("div");if(r.innerHTML=e,!r.hasChildNodes()||1<r.childNodes.length)throw n.console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return re(r.childNodes[0])}(e),u=Be(i),c=(r=void 0!==(t=i).dom().attributes?t.dom().attributes:[],Sn(r,(function(n,e){return"class"===e.name?n:C(n,dt(e.name,e.value))}),{})),a=(o=i,Array.prototype.slice.call(o.dom().classList,0)),s=0===u.length?{}:{innerHtml:oo(i)};return C({tag:fe(i),classes:a,attributes:c},s)}((t=e,r={prefix:Po.prefix()},t.replace(/\$\{([^{}]*)\}/g,(function(n,e){var t,o=r[e];return"string"==(t=typeof o)||"number"===t?o.toString():n}))))},pa=function(n){return{dom:va(n)}},ha=function(n){return Sr([_o.config({toggleClass:Po.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),jo(n,(function(n,e){(e?_o.on:_o.off)(n)}))])},ya=function(n,e,t){return ma.sketch({dom:va('<span class="${prefix}-toolbar-button ${prefix}-icon-'+n+' ${prefix}-icon"></span>'),action:e,buttonBehaviours:C(Sr([ga.config({})]),t)})},ba=ya,wa=function(n,e,t,r){var o=ha(t);return ya(e,r,o)},xa=function(n,e){return{left:r(n),top:r(e),translate:function(t,r){return xa(n+t,e+r)}}},Ta=xa,Sa=function(n,e,t){return Math.max(e,Math.min(t,n))},Oa="slider.change.value",ka=jn.detect().deviceType.isTouch(),Ca=function(n,e){Zn(n,Oa,{value:e})},Ea=jn.detect().deviceType.isTouch(),Ia=function(n,e){return zc({name:n+"-edge",overrides:function(n){var t=Jt([nr(_(),e,[n])]),r=Jt([nr(z(),e,[n]),nr(L(),(function(n,t){t.mouseIsDown().get()&&e(n,t)}),[n])]);return{events:Ea?t:r}}})},Da=[Ia("left",(function(n,e){Ca(n,e.min()-1)})),Ia("right",(function(n,e){Ca(n,e.max()+1)})),Hc({name:"thumb",defaults:r({dom:{styles:{position:"absolute"}}}),overrides:function(n){return{events:Jt([tr(_(),n,"spectrum"),tr(j(),n,"spectrum"),tr(H(),n,"spectrum")])}}}),Hc({schema:[Kt("mouseIsDown",(function(){return Gr(!1)}))],name:"spectrum",overrides:function(n){var e=function(e,t){var r=e.element().dom().getBoundingClientRect();!function(n,e,t,r){(function(n){return function(n){var e=n.event().raw();if(ka){var t=e;return void 0!==t.touches&&1===t.touches.length?A.some(t.touches[0]).map((function(n){return Ta(n.clientX,n.clientY)})):A.none()}var r=e;return void 0!==r.clientX?A.some(r).map((function(n){return Ta(n.clientX,n.clientY)})):A.none()}(n).map((function(n){return n.left()}))})(r).map((function(r){var o,i,u,c;return o=n,u=r,c=function(n,e,t,r,o,i,u){var c=t-e;if(r<n.left)return e-1;if(r>n.right)return t+1;var a,s,f,l,d=Math.min(n.right,Math.max(r,n.left))-n.left,m=Sa(d/n.width*c+e,e-1,t+1),g=Math.round(m);return i&&e<=m&&m<=t?(a=m,s=e,f=t,l=o,u.fold((function(){var n=a-s,e=Math.round(n/l)*l;return Sa(s+e,s-1,f+1)}),(function(n){var e=(a-n)%l,t=Math.round(e/l),r=Math.floor((a-n)/l),o=Math.floor((f-n)/l),i=n+Math.min(o,r+t)*l;return Math.max(n,i)}))):g}(t,(i=e).min(),i.max(),u,i.stepSize(),i.snapToGrid(),i.snapStart()),Ca(o,c),r}))}(e,n,r,t)},t=Jt([Zt(_(),e),Zt(j(),e)]),r=Jt([Zt(z(),e),Zt(L(),(function(t,r){n.mouseIsDown().get()&&e(t,r)}))]);return{behaviours:Sr(Ea?[]:[pc.config({mode:"special",onLeft:function(e){return function(n,e){var t,r,o,i,u=(t=e.value().get(),r=e.min(),o=e.max(),i=e.stepSize(),t<r?t:o<t?o:t===r?r-1:Math.max(r,t-i));Ca(n,u)}(e,n),A.some(!0)},onRight:function(e){return function(n,e){var t,r,o,i,u=(t=e.value().get(),r=e.min(),o=e.max(),i=e.stepSize(),o<t?t:t<r?r:t===o?o+1:Math.min(o,t+i));Ca(n,u)}(e,n),A.some(!0)}}),qo.config({})]),events:Ea?t:r}}})],Ma=function(n,e,t){e.store().manager().onLoad(n,e,t)},Aa=function(n,e,t){e.store().manager().onUnload(n,e,t)},Fa=Object.freeze({onLoad:Ma,onUnload:Aa,setValue:function(n,e,t,r){e.store().manager().setValue(n,e,t,r)},getValue:function(n,e,t){return e.store().manager().getValue(n,e,t)}}),Ra=Object.freeze({events:function(n,e){var t=n.resetOnDom()?[or((function(t,r){Ma(t,n,e)})),ir((function(t,r){Aa(t,n,e)}))]:[mr(n,e,Ma)];return Jt(t)}}),Ba=function(){var n=Gr(null);return Tr({set:n.set,get:n.get,isNotSet:function(){return null===n.get()},clear:function(){n.set(null)},readState:function(){return{mode:"memory",value:n.get()}}})},Va=function(){var n=Gr({});return Tr({readState:function(){return{mode:"dataset",dataset:n.get()}},set:n.set,get:n.get})},Na=Object.freeze({memory:Ba,dataset:Va,manual:function(){return Tr({readState:function(){}})},init:function(n){return n.store().manager().state(n)}}),_a=function(n,e,t,r){e.store().getDataKey(),t.set({}),e.store().setData()(n,r),e.onSetValue()(n,r)},ja=[Wt("initialValue"),zt("getFallbackEntry"),zt("getDataKey"),zt("setData"),To("manager",{setValue:_a,getValue:function(n,e,t){var r=e.store().getDataKey()(n),o=t.get();return lt(o,r).fold((function(){return e.store().getFallbackEntry()(r)}),(function(n){return n}))},onLoad:function(n,e,t){e.store().initialValue().each((function(r){_a(n,e,t,r)}))},onUnload:function(n,e,t){t.set({})},state:Va})],Ha=[zt("getValue"),qt("setValue",e),Wt("initialValue"),To("manager",{setValue:function(n,e,t,r){e.store().setValue()(n,r),e.onSetValue()(n,r)},getValue:function(n,e,t){return e.store().getValue()(n)},onLoad:function(n,e,t){e.store().initialValue().each((function(t){e.store().setValue()(n,t)}))},onUnload:e,state:xr.init})],za=[Yt("store",{mode:"memory"},_t("mode",{memory:[Wt("initialValue"),To("manager",{setValue:function(n,e,t,r){t.set(r),e.onSetValue()(n,r)},getValue:function(n,e,t){return t.get()},onLoad:function(n,e,t){e.store().initialValue().each((function(n){t.isNotSet()&&t.set(n)}))},onUnload:function(n,e,t){t.clear()},state:Ba})],manual:Ha,dataset:ja})),yo("onSetValue"),qt("resetOnDom",!1)],La=kr({fields:za,name:"representing",active:Ra,apis:Fa,extra:{setValueFrom:function(n,e){var t=La.getValue(e);La.setValue(n,t)}},state:Na}),Pa=jn.detect().deviceType.isTouch(),$a=[zt("min"),zt("max"),qt("stepSize",1),qt("onChange",e),qt("onInit",e),qt("onDragStart",e),qt("onDragEnd",e),qt("snapToGrid",!1),Wt("snapStart"),zt("getInitialValue"),hc("sliderBehaviours",[pc,La]),Kt("value",(function(n){return Gr(n.min)}))].concat(Pa?[]:[Kt("mouseIsDown",(function(){return Gr(!1)}))]),Wa=ri("width",(function(n){return n.dom().offsetWidth})),Ua=function(n,e){Wa.set(n,e)},Ga=function(n){return Wa.get(n)},qa=jn.detect().deviceType.isTouch(),Ya=da({name:"Slider",configFields:$a,partFields:Da,factory:function(n,e,t,o){var i=n.max()-n.min(),u=function(n){var e=n.element().dom().getBoundingClientRect();return(e.left+e.right)/2},c=function(e){return qc(e,n,"thumb")},a=function(e){var t=function(e){var t,r,o,c,a=qc(e,n,"spectrum").element().dom().getBoundingClientRect(),s=e.element().dom().getBoundingClientRect(),f=(t=e,r=a,(c=(o=n).value().get())<o.min()?Gc(t,o,"left-edge").fold((function(){return 0}),(function(n){return u(n)-r.left})):c>o.max()?Gc(t,o,"right-edge").fold((function(){return r.width}),(function(n){return u(n)-r.left})):(o.value().get()-o.min())/i*r.width);return a.left-s.left+f}(e),r=c(e),o=Ga(r.element())/2;Xo(r.element(),"left",t-o+"px")},s=function(e,t){var r=n.value().get(),o=c(e);return r!==t||ni(o.element(),"left").isNone()?(n.value().set(t),a(e),n.onChange()(e,o,t),A.some(!0)):A.none()},f=qa?[Zt(_(),(function(e,t){n.onDragStart()(e,c(e))})),Zt(H(),(function(e,t){n.onDragEnd()(e,c(e))}))]:[Zt(z(),(function(e,t){t.stop(),n.onDragStart()(e,c(e)),n.mouseIsDown().set(!0)})),Zt(P(),(function(e,t){n.onDragEnd()(e,c(e)),n.mouseIsDown().set(!1)}))];return{uid:n.uid(),dom:n.dom(),components:e,behaviours:C(Sr(Cn([qa?[]:[pc.config({mode:"special",focusIn:function(e){return Gc(e,n,"spectrum").map(pc.focusIn).map(r(!0))}})],[La.config({store:{mode:"manual",getValue:function(e){return n.value().get()}}})]])),yc(n.sliderBehaviours())),events:Jt([Zt(Oa,(function(n,e){s(n,e.event().value())})),or((function(e,t){n.value().set(n.getInitialValue()());var r=c(e);a(e),n.onInit()(e,r,n.value().get())}))].concat(f)),apis:{resetToMin:function(e){s(e,n.min())},resetToMax:function(e){s(e,n.max())},refresh:a},domModification:{styles:{position:"relative"}}}},apis:{resetToMin:function(n,e){n.resetToMin(e)},resetToMax:function(n,e){n.resetToMax(e)},refresh:function(n,e){n.refresh(e)}}}),Ka=function(n,e,t){return ba(e,(function(){var r=t();n.setContextToolbar([{label:e+" group",items:r}])}),{})},Xa=Ot([zt("getInitialValue"),zt("onChange"),zt("category"),zt("sizes")]),Ja=function(n){var e=Bt("SizeSlider",Xa,n);return Ya.sketch({dom:{tag:"div",classes:[Po.resolve("slider-"+e.category+"-size-container"),Po.resolve("slider"),Po.resolve("slider-size-container")]},onChange:function(n,t,r){var o;0<=(o=r)&&o<e.sizes.length&&e.onChange(r)},onDragStart:function(n,e){_o.on(e)},onDragEnd:function(n,e){_o.off(e)},min:0,max:e.sizes.length-1,stepSize:1,getInitialValue:e.getInitialValue,snapToGrid:!0,sliderBehaviours:Sr([Ho(Ya.refresh)]),components:[Ya.parts().spectrum({dom:va('<div class="${prefix}-slider-size-container"></div>'),components:[pa('<div class="${prefix}-slider-size-line"></div>')]}),Ya.parts().thumb({dom:va('<div class="${prefix}-slider-thumb"></div>'),behaviours:Sr([_o.config({toggleClass:Po.resolve("thumb-active")})])})]})},Qa=["9px","10px","11px","12px","14px","16px","18px","20px","24px","32px","36px"],Za=function(n){var e,t,r=n.selection.getStart(),o=ie(r),i=ie(n.getBody()),u=(e=function(n){return Me(i,n)},(de(t=o)?A.some(t):Re(t).filter(de)).map((function(n){return Kr(n,(function(n){return ni(n,"font-size").isSome()}),e).bind((function(n){return ni(n,"font-size")})).getOrThunk((function(){return Qo(n,"font-size")}))})).getOr(""));return On(Qa,(function(n){return u===n})).getOr("medium")},ns={candidates:r(Qa),get:function(n){var e,t=Za(n);return(e=t,kn(Qa,(function(n){return n===e}))).getOr(2)},apply:function(n,e){var t;(t=e,A.from(Qa[t])).each((function(e){var t,r;r=e,Za(t=n)!==r&&t.execCommand("fontSize",!1,r)}))}},es=ns.candidates(),ts=function(n){var e=void 0!==n.uid&&vt(n,"uid")?n.uid:ia("memento");return{get:function(n){return n.getSystem().getByUid(e).getOrDie()},getOpt:function(n){return n.getSystem().getByUid(e).fold(A.none,A.some)},asSpec:function(){return C(n,{uid:e})}}},rs=window.Promise?window.Promise:function(){var e=function(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],f(n,r(u,this),r(c,this))},t=e.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(e){n.setTimeout(e,1)};function r(n,e){return function(){return n.apply(e,arguments)}}var o=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)};function i(n){var e=this;null!==this._state?t((function(){var t=e._state?n.onFulfilled:n.onRejected;if(null!==t){var r;try{r=t(e._value)}catch(e){return void n.reject(e)}n.resolve(r)}else(e._state?n.resolve:n.reject)(e._value)})):this._deferreds.push(n)}function u(n){try{if(n===this)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var e=n.then;if("function"==typeof e)return void f(r(e,n),r(u,this),r(c,this))}this._state=!0,this._value=n,a.call(this)}catch(n){c.call(this,n)}}function c(n){this._state=!1,this._value=n,a.call(this)}function a(){for(var n=0,e=this._deferreds;n<e.length;n++){var t=e[n];i.call(this,t)}this._deferreds=[]}function s(n,e,t,r){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.resolve=t,this.reject=r}function f(n,e,t){var r=!1;try{n((function(n){r||(r=!0,e(n))}),(function(n){r||(r=!0,t(n))}))}catch(n){if(r)return;r=!0,t(n)}}return e.prototype.catch=function(n){return this.then(null,n)},e.prototype.then=function(n,t){var r=this;return new e((function(e,o){i.call(r,new s(n,t,e,o))}))},e.all=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var r=Array.prototype.slice.call(1===n.length&&o(n[0])?n[0]:n);return new e((function(n,e){if(0===r.length)return n([]);var t=r.length;function o(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var c=u.then;if("function"==typeof c)return void c.call(u,(function(n){o(i,n)}),e)}r[i]=u,0==--t&&n(r)}catch(n){e(n)}}for(var i=0;i<r.length;i++)o(i,r[i])}))},e.resolve=function(n){return n&&"object"==typeof n&&n.constructor===e?n:new e((function(e){e(n)}))},e.reject=function(n){return new e((function(e,t){t(n)}))},e.race=function(n){return new e((function(e,t){for(var r=0,o=n;r<o.length;r++)o[r].then(e,t)}))},e}(),os=function(e,t){var r;(r=t,function(e){return(t=e,new rs((function(e){var r=new n.FileReader;r.onloadend=function(){e(r.result)},r.readAsDataURL(t)}))).then((function(n){return n.split(",")[1]}));var t}(r)).then((function(n){e.undoManager.transact((function(){var r=e.editorUpload.blobCache,o=r.create(Cc("mceu"),t,n);r.add(o);var i=e.dom.createHTML("img",{src:o.blobUri()});e.insertContent(i)}))}))},is=function(n){return n.dom().textContent},us=function(n){return 0<n.length},cs=function(n){return null==n?"":n},as=function(n){var e=ie(n.selection.getStart());return hi(e,"a")},ss=as,fs=jn.detect(),ls=function(n,e){var t=e.selection.getRng();n(),e.selection.setRng(t)},ds=function(n,e){(fs.os.isAndroid()?ls:g)(e,n)},ms=function(n,e){var t,o;return{key:n,value:{config:{},me:(t=n,o=Jt(e),kr({fields:[zt("enabled")],name:t,active:{events:r(o)}})),configAsRaw:r({}),initialConfig:{},state:xr}}},gs=Object.freeze({getCurrent:function(n,e,t){return e.find()(n)}}),vs=[zt("find")],ps=kr({fields:vs,name:"composing",apis:gs}),hs=la({name:"Container",factory:function(n){return{uid:n.uid(),dom:C({tag:"div",attributes:{role:"presentation"}},n.dom()),components:n.components(),behaviours:yc(n.containerBehaviours()),events:n.events(),domModification:n.domModification(),eventOrder:n.eventOrder()}},configFields:[qt("components",[]),hc("containerBehaviours",[]),qt("events",{}),qt("domModification",{}),qt("eventOrder",{})]}),ys=la({name:"DataField",factory:function(n){return{uid:n.uid(),dom:n.dom(),behaviours:C(Sr([La.config({store:{mode:"memory",initialValue:n.getInitialValue()()}}),ps.config({find:A.some})]),yc(n.dataBehaviours())),events:Jt([or((function(e,t){La.setValue(e,n.getInitialValue()())}))])}},configFields:[zt("uid"),zt("dom"),zt("getInitialValue"),hc("dataBehaviours",[La,ps])]}),bs=function(n){return n.dom().value},ws=function(n,e){if(void 0===e)throw new Error("Value.set was undefined");n.dom().value=e},xs=r([Wt("data"),qt("inputAttributes",{}),qt("inputStyles",{}),qt("type","input"),qt("tag","input"),qt("inputClasses",[]),yo("onSetValue"),qt("styles",{}),Wt("placeholder"),qt("eventOrder",{}),hc("inputBehaviours",[La,qo]),qt("selectOnFocus",!0)]),Ts=function(n){return C(Sr([La.config({store:{mode:"manual",initialValue:n.data().getOr(void 0),getValue:function(n){return bs(n.element())},setValue:function(n,e){bs(n.element())!==e&&ws(n.element(),e)}},onSetValue:n.onSetValue()})]),(t=n,Sr([qo.config({onFocus:!1===t.selectOnFocus()?e:function(n){var e=n.element(),t=bs(e);e.dom().setSelectionRange(0,t.length)}})])),yc(n.inputBehaviours()));var t},Ss=la({name:"Input",configFields:xs(),factory:function(n,e){return{uid:n.uid(),dom:(t=n,{tag:t.tag(),attributes:C(mt([{key:"type",value:t.type()}].concat(t.placeholder().map((function(n){return{key:"placeholder",value:n}})).toArray())),t.inputAttributes()),styles:t.inputStyles(),classes:t.inputClasses()}),components:[],behaviours:Ts(n),eventOrder:n.eventOrder()};var t}}),Os=Object.freeze({exhibit:function(n,e){return lr({attributes:mt([{key:e.tabAttr(),value:"true"}])})}}),ks=[qt("tabAttr","data-alloy-tabstop")],Cs=kr({fields:ks,name:"tabstopping",active:Os}),Es=function(n,e){var t=ts(Ss.sketch({placeholder:e,onSetValue:function(n,e){Qn(n,U())},inputBehaviours:Sr([ps.config({find:A.some}),Cs.config({}),pc.config({mode:"execution"})]),selectOnFocus:!1})),r=ts(ma.sketch({dom:va('<button class="${prefix}-input-container-x ${prefix}-icon-cancel-circle ${prefix}-icon"></button>'),action:function(n){var e=t.get(n);La.setValue(e,"")}}));return{name:n,spec:hs.sketch({dom:va('<div class="${prefix}-input-container"></div>'),components:[t.asSpec(),r.asSpec()],containerBehaviours:Sr([_o.config({toggleClass:Po.resolve("input-container-empty")}),ps.config({find:function(n){return A.some(t.get(n))}}),ms("input-clearing",[Zt(U(),(function(n){var e=t.get(n);(0<La.getValue(e).length?_o.off:_o.on)(n)}))])])})}},Is=["input","button","textarea"],Ds=function(n,e,t){e.disabled()&&Vs(n,e)},Ms=function(n){return yn(Is,fe(n.element()))},As=function(n){Dr(n.element(),"disabled","disabled")},Fs=function(n){Rr(n.element(),"disabled")},Rs=function(n){Dr(n.element(),"aria-disabled","true")},Bs=function(n){Dr(n.element(),"aria-disabled","false")},Vs=function(n,e,t){e.disableClass().each((function(e){Hr(n.element(),e)})),(Ms(n)?As:Rs)(n)},Ns=function(n){return Ms(n)?Fr(n.element(),"disabled"):"true"===Ar(n.element(),"aria-disabled")},_s=Object.freeze({enable:function(n,e,t){e.disableClass().each((function(e){zr(n.element(),e)})),(Ms(n)?Fs:Bs)(n)},disable:Vs,isDisabled:Ns,onLoad:Ds}),js=Object.freeze({exhibit:function(n,e,t){return lr({classes:e.disabled()?e.disableClass().map(Mn).getOr([]):[]})},events:function(n,e){return Jt([Qt($n(),(function(n,e){return Ns(n)})),mr(n,e,Ds)])}}),Hs=[qt("disabled",!1),Wt("disableClass")],zs=kr({fields:Hs,name:"disabling",active:js,apis:_s}),Ls=[hc("formBehaviours",[La])],Ps=function(n){return"<alloy.field."+n+">"},$s=function(n,e,t){return C({"debug.sketcher":{Form:t},uid:n.uid(),dom:n.dom(),components:e,behaviours:C(Sr([La.config({store:{mode:"manual",getValue:function(e){var t,o,i=(t=n,o=e.getSystem(),B(t.partUids(),(function(n,e){return r(o.getByUid(n))})));return B(i,(function(n,e){return n().bind(ps.getCurrent).map(La.getValue)}))},setValue:function(e,t){R(t,(function(t,r){Gc(e,n,r).each((function(n){ps.getCurrent(n).each((function(n){La.setValue(n,t)}))}))}))}}})]),yc(n.formBehaviours())),apis:{getField:function(e,t){return Gc(e,n,t).bind(ps.getCurrent)}}})},Ws=(Qc((function(n,e,t){return n.getField(e,t)})),function(n){var e,t=(e=[],{field:function(n,t){return e.push(n),r=Ps(n),o=t,{uiType:Oc(),owner:"form",name:r,config:o,validated:{}};var r,o},record:function(){return e}}),r=n(t),o=t.record(),i=bn(o,(function(n){return Hc({name:n,pname:Ps(n)})}));return ca("form",Ls,i,$s,r)}),Us=function(){var n=Gr(A.none()),e=function(){n.get().each((function(n){n.destroy()}))};return{clear:function(){e(),n.set(A.none())},isSet:function(){return n.get().isSome()},set:function(t){e(),n.set(A.some(t))},run:function(e){n.get().each(e)}}},Gs=function(){var n=Gr(A.none());return{clear:function(){n.set(A.none())},set:function(e){n.set(A.some(e))},isSet:function(){return n.get().isSome()},on:function(e){n.get().each(e)}}},qs=function(n){var e="navigateEvent",t=kt([zt("fields"),qt("maxFieldIndex",n.fields.length-1),zt("onExecute"),zt("getInitialValue"),Kt("state",(function(){return{dialogSwipeState:Gs(),currentScreen:Gr(0)}}))]),r=Bt("SerialisedDialog",t,n),o=function(n,t,r){return ma.sketch({dom:va('<span class="${prefix}-icon-'+t+' ${prefix}-icon"></span>'),action:function(t){Zn(t,e,{direction:n})},buttonBehaviours:Sr([zs.config({disableClass:Po.resolve("toolbar-navigation-disabled"),disabled:!r})])})},i=function(n,e){var t=mi(n.element(),"."+Po.resolve("serialised-dialog-screen"));pi(n.element(),"."+Po.resolve("serialised-dialog-chain")).each((function(n){0<=r.state.currentScreen.get()+e&&r.state.currentScreen.get()+e<t.length&&(ni(n,"left").each((function(r){var o=parseInt(r,10),i=Ga(t[0]);Xo(n,"left",o-e*i+"px")})),r.state.currentScreen.set(r.state.currentScreen.get()+e))}))},u=function(n){var e=mi(n.element(),"input");A.from(e[r.state.currentScreen.get()]).each((function(e){n.getSystem().getByDom(e).each((function(e){var t,r;t=n,r=e.element(),t.getSystem().triggerFocus(r,t.element())}))}));var t=a.get(n);ji.highlightAt(t,r.state.currentScreen.get())},c=ts(Ws((function(n){return{dom:va('<div class="${prefix}-serialised-dialog"></div>'),components:[hs.sketch({dom:va('<div class="${prefix}-serialised-dialog-chain" style="left: 0px; position: absolute;"></div>'),components:bn(r.fields,(function(e,t){return t<=r.maxFieldIndex?hs.sketch({dom:va('<div class="${prefix}-serialised-dialog-screen"></div>'),components:Cn([[o(-1,"previous",0<t)],[n.field(e.name,e.spec)],[o(1,"next",t<r.maxFieldIndex)]])}):n.field(e.name,e.spec)}))})],formBehaviours:Sr([Ho((function(n,e){var t;t=e,pi(n.element(),"."+Po.resolve("serialised-dialog-chain")).each((function(n){Xo(n,"left",-r.state.currentScreen.get()*t.width+"px")}))})),pc.config({mode:"special",focusIn:function(n){u(n)},onTab:function(n){return i(n,1),A.some(!0)},onShiftTab:function(n){return i(n,-1),A.some(!0)}}),ms("form-events",[or((function(n,e){r.state.currentScreen.set(0),r.state.dialogSwipeState.clear();var t=a.get(n);ji.highlightFirst(t),r.getInitialValue(n).each((function(e){La.setValue(n,e)}))})),cr(r.onExecute),Zt(Y(),(function(n,e){"left"===e.event().raw().propertyName&&u(n)})),Zt(e,(function(n,e){var t=e.event().direction();i(n,t)}))])])}}))),a=ts({dom:va('<div class="${prefix}-dot-container"></div>'),behaviours:Sr([ji.config({highlightClass:Po.resolve("dot-active"),itemClass:Po.resolve("dot-item")})]),components:En(r.fields,(function(n,e){return e<=r.maxFieldIndex?[pa('<div class="${prefix}-dot-item ${prefix}-icon-full-dot ${prefix}-icon"></div>')]:[]}))});return{dom:va('<div class="${prefix}-serializer-wrapper"></div>'),components:[c.asSpec(),a.asSpec()],behaviours:Sr([pc.config({mode:"special",focusIn:function(n){var e=c.get(n);pc.focusIn(e)}}),ms("serializer-wrapper-events",[Zt(_(),(function(n,e){var t=e.event();r.state.dialogSwipeState.set(function(n){return{xValue:n,points:[]}}(t.touches[0].clientX))})),Zt(j(),(function(n,e){var t=e.event();r.state.dialogSwipeState.on((function(n){e.event().prevent(),r.state.dialogSwipeState.set(function(n,e){if(e===n.xValue)return n;var t=0<e-n.xValue?1:-1,r={direction:t,xValue:e};return{xValue:e,points:(0===n.points.length?[]:n.points[n.points.length-1].direction===t?n.points.slice(0,n.points.length-1):n.points).concat([r])}}(n,t.raw().touches[0].clientX))}))})),Zt(H(),(function(n){r.state.dialogSwipeState.on((function(e){var t=c.get(n),r=-1*function(n){if(0===n.points.length)return 0;var e=n.points[0].direction,t=n.points[n.points.length-1].direction;return-1===e&&-1===t?-1:1===e&&1===t?1:0}(e);i(t,r)}))}))])])}},Ys=X((function(n,e){return[{label:"the link group",items:[qs({fields:[Es("url","Type or paste URL"),Es("text","Link text"),Es("title","Link title"),Es("target","Link target"),{name:"link",spec:ys.sketch({dom:{tag:"span",styles:{display:"none"}},getInitialValue:function(){return A.none()}})}],maxFieldIndex:["url","text","title","target"].length-1,getInitialValue:function(){return A.some(function(n){return as(n).fold((function(){return{url:"",text:n.selection.getContent({format:"text"}),title:"",target:"",link:A.none()}}),(function(n){return t=is(e=n),r=Ar(e,"href"),o=Ar(e,"title"),i=Ar(e,"target"),{url:cs(r),text:t!==r?cs(t):"",title:cs(o),target:cs(i),link:A.some(e)};var e,t,r,o,i}))}(e))},onExecute:function(t){var r=La.getValue(t);(function(n,e){e.url.filter(us).fold((function(){var t;t=n,e.link.bind(o).each((function(n){t.execCommand("unlink")}))}),(function(t){var r,i,u=(r=e,(i={}).href=t,r.title.filter(us).each((function(n){i.title=n})),r.target.filter(us).each((function(n){i.target=n})),i);e.link.bind(o).fold((function(){var r=e.text.filter(us).getOr(t);n.insertContent(n.dom.createHTML("a",u,n.dom.encode(r)))}),(function(n){var r=function(n,e,t){return t.text.filter(us).fold((function(){return Ar(t=n,"href")===is(t)?A.some(e):A.none();var t}),A.some)}(n,t,e);Mr(n,u),r.each((function(e){var t;t=e,n.dom().textContent=t}))}))}))})(e,r),n.restoreToolbar(),e.focus()}})]}]})),Ks=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}],Xs=Jt([(ui=zn(),ci=function(e,t){var r,o,i=t.event().originator(),u=t.event().target();return o=u,!(Me(r=i,e.element())&&!Me(r,o)&&(n.console.warn(zn()+" did not get interpreted by the desired target. \nOriginator: "+io(i)+"\nTarget: "+io(u)+"\nCheck the "+zn()+" event handlers"),1))},{key:ui,value:Xt({can:ci})})]),Js=Object.freeze({events:Xs}),Qs=o,Zs=wr(["debugInfo","triggerFocus","triggerEvent","triggerEscape","addToWorld","removeFromWorld","addToGui","removeFromGui","build","getByUid","getByDom","broadcast","broadcastOn","isConnected"]),nf=function(n){var e=function(e){return function(){throw new Error("The component must be in a context to send: "+e+"\n"+io(n().element())+" is not in context.")}};return Zs({debugInfo:r("fake"),triggerEvent:e("triggerEvent"),triggerFocus:e("triggerFocus"),triggerEscape:e("triggerEscape"),build:e("build"),addToWorld:e("addToWorld"),removeFromWorld:e("removeFromWorld"),addToGui:e("addToGui"),removeFromGui:e("removeFromGui"),getByUid:e("getByUid"),getByDom:e("getByDom"),broadcast:e("broadcast"),broadcastOn:e("broadcastOn"),isConnected:r(!1)})},ef=function(n,e){var t={};return R(n,(function(n,r){R(n,(function(n,o){var i=ft(o,[])(t);t[o]=i.concat([e(r,n)])}))})),t},tf=function(n,e){return 1<n.length?Ye.error('Multiple behaviours have tried to change DOM "'+e+'". The guilty behaviours are: '+yt(bn(n,(function(n){return n.name()})))+". At this stage, this is not supported. Future releases might provide strategies for resolving this."):0===n.length?Ye.value({}):Ye.value(n[0].modification().fold((function(){return{}}),(function(n){return dt(e,n)})))},rf=function(n,e){return Sn(n,(function(t,r){var o=r.modification().getOr({});return t.bind((function(t){var r=N(o,(function(r,o){return void 0!==t[o]?(i=e,u=o,c=n,Ye.error("Mulitple behaviours have tried to change the _"+u+'_ "'+i+'". The guilty behaviours are: '+yt(En(c,(function(n){return void 0!==n.modification().getOr({})[u]?[n.name()]:[]})),null,2)+". This is not currently supported.")):Ye.value(dt(o,r));var i,u,c}));return gt(r,t)}))}),Ye.value({})).map((function(n){return dt(e,n)}))},of={classes:function(n,e){var t=En(n,(function(n){return n.modification().getOr([])}));return Ye.value(dt(e,t))},attributes:rf,styles:rf,domChildren:tf,defChildren:tf,innerHtml:tf,value:tf},uf=function(n){return n.cHandler},cf=function(n,e){return{name:r(n),handler:r(e)}},af=function(n,e){var t=N(n,(function(n,t){return(1===n.length?Ye.value(n[0].handler()):function(n,e,t){var r,o,i=e[t];return i?function(n,e,t,r){var o=t.slice(0);try{var i=o.sort((function(t,o){var i=t[e](),u=o[e](),c=r.indexOf(i),a=r.indexOf(u);if(-1===c)throw new Error("The ordering for "+n+" does not have an entry for "+i+".\nOrder specified: "+yt(r,null,2));if(-1===a)throw new Error("The ordering for "+n+" does not have an entry for "+u+".\nOrder specified: "+yt(r,null,2));return c<a?-1:a<c?1:0}));return Ye.value(i)}catch(n){return Ye.error([n])}}("Event: "+t,"name",n,i).map((function(n){return function(n){var e,t,r,o,i=(e=n,t=function(n){return n.can},function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return Sn(e,(function(e,r){return e&&t(r).apply(void 0,n)}),!0)}),u=(r=n,o=function(n){return n.abort},function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Sn(r,(function(e,t){return e||o(t).apply(void 0,n)}),!1)});return Xt({can:i,abort:u,run:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];wn(n,(function(n){n.run.apply(void 0,e)}))}})}(bn(n,(function(n){return n.handler()})))})):(r=t,o=n,Ye.error(["The event ("+r+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+yt(bn(o,(function(n){return n.name()})),null,2)]))}(n,e,t)).map((function(o){var i=function(n){var e,t=T(e=n)?{can:r(!0),abort:r(!1),run:e}:e;return function(n,e){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var i=[n,e].concat(r);t.abort.apply(void 0,i)?e.stop():t.can.apply(void 0,i)&&t.run.apply(void 0,i)}}(o),u=1<n.length?xn(e,(function(e){return yn(n,(function(n){return n.name()===e}))})).join(" > "):n[0].name();return dt(t,{handler:i,purpose:r(u)})}))}));return gt(t,{})},sf=function(n,e){wn(e,(function(e){Hr(n,e)}))},ff=function(n,e){wn(e,(function(e){zr(n,e)}))},lf=function(e){var t=oe(e.tag());Mr(t,e.attributes().getOr({})),sf(t,e.classes().getOr([])),Jo(t,e.styles().getOr({})),function(e,t){var r,o,i=Ae(e).dom(),u=ie(i.createDocumentFragment()),c=(r=t,(o=(i||n.document).createElement("div")).innerHTML=r,Be(ie(o)));_e(u,c),je(e),Ne(e,u)}(t,e.innerHtml().getOr(""));var r=function(n){if(n.domChildren().isSome()&&n.defChildren().isSome())throw new Error("Cannot specify children and child specs! Must be one or the other.\nDef: "+(e=function(n){return{tag:n.tag(),classes:n.classes().getOr([]),attributes:n.attributes().getOr({}),styles:n.styles().getOr({}),value:n.value().getOr("<none>"),innerHtml:n.innerHtml().getOr("<none>"),defChildren:n.defChildren().fold((function(){return"<none>"}),(function(n){return yt(n,null,2)})),domChildren:n.domChildren().fold((function(){return"<none>"}),(function(n){return 0===n.length?"0 children, but still specified":String(n.length)}))}}(n),yt(e,null,2)));return n.domChildren().fold((function(){var e=n.defChildren().getOr([]);return bn(e,df)}),(function(n){return n}));var e}(e);return _e(t,r),e.value().each((function(n){ws(t,n)})),t},df=function(n){var e=fr(n);return lf(e)},mf=wr(["getSystem","config","hasConfigured","spec","connect","disconnect","element","syncComponents","readState","components","events"]),gf=function(n){var e,t,o,i,u,c,a,s,f,l,d,m,g,v,p=Qs(n),h=(e=p,t=ft("components",[])(e),bn(t,hf)),b=C(Js,p,dt("components",h));return Ye.value((o=b,u=Gr(nf(i=function(){return v})),c=Rt(function(n){return Ft("custom.definition",Ot([Dt("dom","dom",Qe(),Ot([zt("tag"),qt("styles",{}),qt("classes",[]),qt("attributes",{}),Wt("value"),Wt("innerHtml")])),zt("components"),zt("uid"),qt("events",{}),qt("apis",r({})),Dt("eventOrder","eventOrder",(e={"alloy.execute":["disabling","alloy.base.behaviour","toggling"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing"]},Xe.mergeWithThunk(r(e))),jt()),Wt("domModification"),So("originalSpec"),qt("debug.sketcher","unknown")]),n);var e}(C(o,{behaviours:void 0}))),s=(a=function(n){var e,t;return function(n,e){return t=n,o=bn(r=e,(function(n){return Ut(n.name(),[zt("config"),qt("state",xr)])})),i=Ft("component.behaviours",kt(o),t.behaviours).fold((function(n){throw new Error(Nt(n)+"\nComplete spec:\n"+yt(t,null,2))}),(function(n){return n})),{list:r,data:B(i,(function(n){var e=n().map((function(n){return{config:n.config(),state:n.state().init(n.config())}}));return function(){return e}}))};var t,r,o,i}(n,(e=lt(n,"behaviours").getOr({}),t=xn(F(e),(function(n){return void 0!==e[n]})),bn(t,(function(n){return e[n].me}))))}(o)).list,f=a.data,l=function(n,e,t){var r,o,i,u,c=function(n){var e,t={tag:n.dom().tag(),classes:n.dom().classes(),attributes:C((e=n,dt(ea(),e.uid())),n.dom().attributes()),styles:n.dom().styles(),domChildren:bn(n.components(),(function(n){return n.element()}))};return fr(C(t,n.dom().innerHtml().map((function(n){return dt("innerHtml",n)})).getOr({}),n.dom().value().map((function(n){return dt("value",n)})).getOr({})))}(n);return i=function(n,e,t,r){var o=C({},e);wn(t,(function(e){o[e.name()]=e.exhibit(n,r)}));var i=ef(o,(function(n,e){return{name:function(){return n},modification:e}})),u=B(i,(function(n,e){return En(n,(function(n){return n.modification().fold((function(){return[]}),(function(e){return[n]}))}))})),c=N(u,(function(n,e){return lt(of,e).fold((function(){return Ye.error("Unknown field type: "+e)}),(function(t){return t(n,e)}))}));return gt(c,{}).map(lr)}(t,{"alloy.base.modification":(r=n,r.domModification().fold((function(){return lr({})}),lr))},e,c).getOrDie(),u=C({tag:(o=c).tag(),classes:i.classes().getOr([]).concat(o.classes().getOr([])),attributes:E(o.attributes().getOr({}),i.attributes().getOr({})),styles:E(o.styles().getOr({}),i.styles().getOr({}))},i.innerHtml().or(o.innerHtml()).map((function(n){return dt("innerHtml",n)})).getOr({}),dr("domChildren",i.domChildren(),o.domChildren()),dr("defChildren",i.defChildren(),o.defChildren()),i.value().or(o.value()).map((function(n){return dt("value",n)})).getOr({})),fr(u)}(c,s,f),d=lf(l),m=function(n,e,t){var r,o,i,u,c,a,s={"alloy.base.behaviour":(r=n,r.events())};return(o=t,i=n.eventOrder(),u=e,c=s,a=function(n,e,t){var r,o,i=C(t,(r=n,o={},wn(e,(function(n){o[n.name()]=n.handlers(r)})),o));return ef(i,cf)}(o,u,c),af(a,i)).getOrDie()}(c,s,f),g=Gr(c.components()),v=mf({getSystem:u.get,config:function(n){if(n===Zc())return c.apis();if(y(n))throw new Error("Invalid input: only API constant is allowed");var e=f;return(T(e[n.name()])?e[n.name()]:function(){throw new Error("Could not find "+n.name()+" in "+yt(o,null,2))})()},hasConfigured:function(n){return T(f[n.name()])},spec:r(o),readState:function(n){return f[n]().map((function(n){return n.state.readState()})).getOr("not enabled")},connect:function(n){u.set(n)},disconnect:function(){u.set(nf(i))},element:r(d),syncComponents:function(){var n=Be(d),e=En(n,(function(n){return u.get().getByDom(n).fold((function(){return[]}),(function(n){return[n]}))}));g.set(e)},components:g.get,events:r(m)})))},vf=function(e){var t=function(e,t){var r=(t||n.document).createTextNode(e);return re(r)}(e);return pf({element:t})},pf=function(n){var t=Vt("external.component",Ot([zt("element"),Wt("uid")]),n),o=Gr(nf());t.uid().each((function(n){var e;e=t.element(),Dr(e,ra,n)}));var i=mf({getSystem:o.get,config:A.none,hasConfigured:r(!1),connect:function(n){o.set(n)},disconnect:function(){o.set(nf((function(){return i})))},element:r(t.element()),spec:r(n),readState:r("No state"),syncComponents:e,components:r([]),events:r({})});return Jc(i)},hf=function(n){return(e=n,lt(e,Kc)).fold((function(){var e=C({uid:ia("")},n);return gf(e).getOrDie()}),(function(n){return n}));var e},yf=Jc,bf="alloy.item-hover",wf="alloy.item-focus",xf=function(n){(Zr(n.element()).isNone()||qo.isFocused(n))&&(qo.isFocused(n)||qo.focus(n),Zn(n,bf,{item:n}))},Tf=function(n){Zn(n,wf,{item:n})},Sf=r(bf),Of=r(wf),kf=[zt("data"),zt("components"),zt("dom"),Wt("toggling"),qt("itemBehaviours",{}),qt("ignoreFocus",!1),qt("domModification",{}),To("builder",(function(n){return{dom:C(n.dom(),{attributes:{role:n.toggling().isSome()?"menuitemcheckbox":"menuitem"}}),behaviours:C(Sr([n.toggling().fold(_o.revoke,(function(n){return _o.config(C({aria:{mode:"checked"}},n))})),qo.config({ignore:n.ignoreFocus(),onFocus:function(n){Tf(n)}}),pc.config({mode:"execution"}),La.config({store:{mode:"memory",initialValue:n.data()}})]),n.itemBehaviours()),events:Jt([(e=Gn(),t=ne,Zt(e,(function(n,e){var r=e.event();n.getSystem().getByDom(r.target()).each((function(r){t(n,r,e)}))}))),rr(z()),Zt($(),xf),Zt(Wn(),qo.focus)]),components:n.components(),domModification:n.domModification(),eventOrder:n.eventOrder()};var e,t})),qt("eventOrder",{})],Cf=[zt("dom"),zt("components"),To("builder",(function(n){return{dom:n.dom(),components:n.components(),events:Jt([(e=Wn(),Zt(e,(function(n,e){e.stop()})))])};var e}))],Ef=r([Hc({name:"widget",overrides:function(n){return{behaviours:Sr([La.config({store:{mode:"manual",getValue:function(e){return n.data()},setValue:function(){}}})])}}})]),If=_t("type",{widget:[zt("uid"),zt("data"),zt("components"),zt("dom"),qt("autofocus",!1),qt("domModification",{}),Yc(Ef()),To("builder",(function(n){var e=Wc(0,n,Ef()),t=Uc("item-widget",n,e.internals()),r=function(e){return Gc(e,n,"widget").map((function(n){return pc.focusIn(n),n}))},o=function(e,t){return Wi(t.event().target())||n.autofocus()&&t.setSource(e.element()),A.none()};return C({dom:n.dom(),components:t,domModification:n.domModification(),events:Jt([cr((function(n,e){r(n).each((function(n){e.stop()}))})),Zt($(),xf),Zt(Wn(),(function(e,t){n.autofocus()?r(e):qo.focus(e)}))]),behaviours:Sr([La.config({store:{mode:"memory",initialValue:n.data()}}),qo.config({onFocus:function(n){Tf(n)}}),pc.config({mode:"special",focusIn:n.autofocus()?function(n){r(n)}:Er(),onLeft:o,onRight:o,onEscape:function(e,t){return qo.isFocused(e)||n.autofocus()?(n.autofocus()&&t.setSource(e.element()),A.none()):(qo.focus(e),A.some(!0))}})])})}))],item:kf,separator:Cf}),Df=r([Lc({factory:{sketch:function(n){var e=Vt("menu.spec item",If,n);return e.builder()(e)}},name:"items",unit:"item",defaults:function(n,e){var t=ia("");return C({uid:t},e)},overrides:function(n,e){return{type:e.type,ignoreFocus:n.fakeFocus(),domModification:{classes:[n.markers().item()]}}}})]),Mf=r([zt("value"),zt("items"),zt("dom"),zt("components"),qt("eventOrder",{}),hc("menuBehaviours",[ji,La,ps,pc]),Yt("movement",{mode:"menu",moveOnTab:!0},_t("mode",{grid:[Oo(),To("config",(function(n,e){return{mode:"flatgrid",selector:"."+n.markers().item(),initSize:{numColumns:e.initSize().numColumns(),numRows:e.initSize().numRows()},focusManager:n.focusManager()}}))],menu:[qt("moveOnTab",!0),To("config",(function(n,e){return{mode:"menu",selector:"."+n.markers().item(),moveOnTab:e.moveOnTab(),focusManager:n.focusManager()}}))]})),Lt("markers",vo()),qt("fakeFocus",!1),qt("focusManager",Hi()),yo("onHighlight")]),Af=r("alloy.menu-focus"),Ff=da({name:"Menu",configFields:Mf(),partFields:Df(),factory:function(n,e,t,r){return C({dom:C(n.dom(),{attributes:{role:"menu"}}),uid:n.uid(),behaviours:C(Sr([ji.config({highlightClass:n.markers().selectedItem(),itemClass:n.markers().item(),onHighlight:n.onHighlight()}),La.config({store:{mode:"memory",initialValue:n.value()}}),ps.config({find:A.some}),pc.config(n.movement().config()(n,n.movement()))]),yc(n.menuBehaviours())),events:Jt([Zt(Of(),(function(n,e){var t=e.event();n.getSystem().getByDom(t.target()).each((function(t){ji.highlight(n,t),e.stop(),Zn(n,Af(),{menu:n,item:t})}))})),Zt(Sf(),(function(n,e){var t=e.event().item();ji.highlight(n,t)}))]),components:e,eventOrder:n.eventOrder()})}}),Rf=function(n,e,t,r){var o=n.getSystem().build(r);$e(n,o,t)},Bf=function(n,e){return n.components()},Vf=kr({fields:[],name:"replacing",apis:Object.freeze({append:function(n,e,t,r){Rf(n,0,Ne,r)},prepend:function(n,e,t,r){Rf(n,0,Ve,r)},remove:function(n,e,t,r){var o=Bf(n);On(o,(function(n){return Me(r.element(),n.element())})).each(Ue)},set:function(n,t,r,o){var i,u;u=(i=n).components(),wn(u,We),je(i.element()),i.syncComponents(),function(n,t){var r=Ae(t),o=Qr(r).bind((function(n){var e,r,o=function(e){return Me(n,e)};return o(t)?A.some(t):(e=o,(r=function(n){for(var t=0;t<n.childNodes.length;t++){var o=ie(n.childNodes[t]);if(e(o))return A.some(o);var i=r(n.childNodes[t]);if(i.isSome())return i}return A.none()})(t.dom()))}));n();o.each((function(n){Qr(r).filter((function(e){return Me(e,n)})).fold((function(){Xr(n)}),e)}))}((function(){var e=bn(o,n.getSystem().build);wn(e,(function(e){Pe(n,e)}))}),n.element())},contents:Bf})}),Nf=function(n,e,t,r){return lt(t,r).bind((function(r){return lt(n,r).bind((function(r){var o=Nf(n,e,t,r);return A.some([r].concat(o))}))})).getOr([])},_f=r("collapse-item"),jf=la({name:"TieredMenu",configFields:[xo("onExecute"),xo("onEscape"),wo("onOpenMenu"),wo("onOpenSubmenu"),yo("onCollapseMenu"),qt("openImmediately",!0),$t("data",[zt("primary"),zt("menus"),zt("expansions")]),qt("fakeFocus",!1),yo("onHighlight"),yo("onHover"),$t("markers",[zt("backgroundMenu")].concat(mo()).concat(go())),zt("dom"),qt("navigateOnHover",!0),qt("stayInDom",!1),hc("tmenuBehaviours",[pc,ji,ps,Vf]),qt("eventOrder",{})],apis:{collapseMenu:function(n,e){n.collapseMenu(e)}},factory:function(n,t){var r=function(r,o){return B(o,(function(o,i){var u=Ff.sketch(C(o,{value:i,items:o.items,markers:at(t.markers,["item","selectedItem"]),fakeFocus:n.fakeFocus(),onHighlight:n.onHighlight(),focusManager:n.fakeFocus()?{get:function(n){return ji.getHighlighted(n).map((function(n){return n.element()}))},set:function(n,t){n.getSystem().getByDom(t).fold(e,(function(e){ji.highlight(n,e)}))}}:Hi()}));return r.getSystem().build(u)}))},o=function(){var n=Gr({}),e=Gr({}),t=Gr({}),r=Gr(A.none()),o=Gr({}),i=function(n){return lt(e.get(),n)};return{setContents:function(i,u,c,a){r.set(A.some(i)),n.set(c),e.set(u),o.set(a);var s=function(n,e){var t={};R(n,(function(n,e){wn(n,(function(n){t[n]=e}))}));var r=e,o=V(e,(function(n,e){return{k:n,v:e}})),i=B(o,(function(n,e){return[e].concat(Nf(t,r,o,e))}));return B(t,(function(n){return lt(i,n).getOr([n])}))}(a,c);t.set(s)},expand:function(e){return lt(n.get(),e).map((function(n){var r=lt(t.get(),e).getOr([]);return[n].concat(r)}))},refresh:function(n){return lt(t.get(),n)},collapse:function(n){return lt(t.get(),n).bind((function(n){return 1<n.length?A.some(n.slice(1)):A.none()}))},lookupMenu:i,otherMenus:function(n){var e,t,r=o.get();return e=F(r),t=n,xn(e,(function(n){return!yn(t,n)}))},getPrimary:function(){return r.get().bind(i)},getMenus:function(){return e.get()},clear:function(){n.set({}),e.set({}),t.set({}),r.set(A.none())},isClear:function(){return r.get().isNone()}}}(),i=function(n){return La.getValue(n).value},u=function(n,e){ji.highlight(n,e),ji.getHighlighted(e).orThunk((function(){return ji.getFirst(e)})).each((function(e){ee(n,e.element(),Wn())}))},c=function(n,e){return co(bn(e,n.lookupMenu))},a=function(e,t,r){return A.from(r[0]).bind(t.lookupMenu).map((function(o){var i=c(t,r.slice(1));wn(i,(function(e){Hr(e.element(),n.markers().backgroundMenu())})),ge(o.element())||Vf.append(e,yf(o)),ff(o.element(),[n.markers().backgroundMenu()]),u(e,o);var a=c(t,t.otherMenus(r));return wn(a,(function(t){ff(t.element(),[n.markers().backgroundMenu()]),n.stayInDom()||Vf.remove(e,t)})),o}))},s=function(e,t){var r=i(t);return o.expand(r).bind((function(r){return A.from(r[0]).bind(o.lookupMenu).each((function(r){ge(r.element())||Vf.append(e,yf(r)),n.onOpenSubmenu()(e,t,r),ji.highlightFirst(r)})),a(e,o,r)}))},f=function(e,t){var r=i(t);return o.collapse(r).bind((function(r){return a(e,o,r).map((function(r){return n.onCollapseMenu()(e,t,r),r}))}))},l=function(e){return function(t,r){return hi(r.getSource(),"."+n.markers().item()).bind((function(n){return t.getSystem().getByDom(n).toOption().bind((function(n){return e(t,n).map((function(){return!0}))}))}))}},d=Jt([Zt(Af(),(function(n,e){var t=e.event().menu();ji.highlight(n,t)})),cr((function(e,t){var r=t.event().target();e.getSystem().getByDom(r).each((function(t){0===i(t).indexOf("collapse-item")&&f(e,t),s(e,t).fold((function(){n.onExecute()(e,t)}),(function(){}))}))})),or((function(e,t){var i,c,a;(i=e,c=r(i,n.data().menus()),a=B(n.data().menus(),(function(n,e){return En(n.items,(function(n){return"separator"===n.type?[]:[n.data.value]}))})),o.setContents(n.data().primary(),c,n.data().expansions(),a),o.getPrimary()).each((function(t){Vf.append(e,yf(t)),n.openImmediately()&&(u(e,t),n.onOpenMenu()(e,t))}))}))].concat(n.navigateOnHover()?[Zt(Sf(),(function(e,t){var r,u,c=t.event().item();r=e,u=i(c),o.refresh(u).bind((function(n){return a(r,o,n)})),s(e,c),n.onHover()(e,c)}))]:[]));return{uid:n.uid(),dom:n.dom(),behaviours:C(Sr([pc.config({mode:"special",onRight:l((function(n,e){return Wi(e.element())?A.none():s(n,e)})),onLeft:l((function(n,e){return Wi(e.element())?A.none():f(n,e)})),onEscape:l((function(e,t){return f(e,t).orThunk((function(){return n.onEscape()(e,t).map((function(){return e}))}))})),focusIn:function(n,e){o.getPrimary().each((function(e){ee(n,e.element(),Wn())}))}}),ji.config({highlightClass:n.markers().selectedMenu(),itemClass:n.markers().menu()}),ps.config({find:function(n){return ji.getHighlighted(n)}}),Vf.config({})]),yc(n.tmenuBehaviours())),eventOrder:n.eventOrder(),apis:{collapseMenu:function(n){ji.getHighlighted(n).each((function(e){ji.getHighlighted(e).each((function(e){f(n,e)}))}))}},events:d}},extraApis:{tieredData:function(n,e,t){return{primary:n,menus:e,expansions:t}},singleData:function(n,e){return{primary:n,menus:dt(n,e),expansions:{}}},collapseItem:function(n){return{value:Cc(_f()),text:n}}}}),Hf=function(n,e,t,r){return lt(e.routes(),r.start()).map(g).bind((function(n){return lt(n,r.destination()).map(g)}))},zf=function(n,e,t,o){return Hf(0,e,0,o).bind((function(n){return n.transition().map((function(e){return{transition:r(e),route:r(n)}}))}))},Lf=function(n,e,t){var r,o;(r=n,o=e,Pf(r,o).bind((function(n){return zf(0,o,0,n)}))).each((function(t){var r=t.transition();zr(n.element(),r.transitionClass()),Rr(n.element(),e.destinationAttr())}))},Pf=function(n,e,t){var o=n.element();return Fr(o,e.destinationAttr())?A.some({start:r(Ar(n.element(),e.stateAttr())),destination:r(Ar(n.element(),e.destinationAttr()))}):A.none()},$f=function(n,e,t,r){Lf(n,e),Fr(n.element(),e.stateAttr())&&Ar(n.element(),e.stateAttr())!==r&&e.onFinish()(n,r),Dr(n.element(),e.stateAttr(),r)},Wf=Object.freeze({findRoute:Hf,disableTransition:Lf,getCurrentRoute:Pf,jumpTo:$f,progressTo:function(n,e,t,o){var i,u;u=e,Fr((i=n).element(),u.destinationAttr())&&(Dr(i.element(),u.stateAttr(),Ar(i.element(),u.destinationAttr())),Rr(i.element(),u.destinationAttr()));var c,a,s=(c=e,a=o,{start:r(Ar(n.element(),c.stateAttr())),destination:r(a)});zf(0,e,0,s).fold((function(){$f(n,e,0,o)}),(function(t){Lf(n,e);var r=t.transition();Hr(n.element(),r.transitionClass()),Dr(n.element(),e.destinationAttr(),o)}))},getState:function(n,e,t){var r=n.element();return Fr(r,e.stateAttr())?A.some(Ar(r,e.stateAttr())):A.none()}}),Uf=Object.freeze({events:function(n,e){return Jt([Zt(Y(),(function(e,t){var r=t.event().raw();Pf(e,n).each((function(t){Hf(0,n,0,t).each((function(o){o.transition().each((function(o){r.propertyName===o.property()&&($f(e,n,0,t.destination()),n.onTransition()(e,t))}))}))}))})),or((function(e,t){$f(e,n,0,n.initialState())}))])}}),Gf=[qt("destinationAttr","data-transitioning-destination"),qt("stateAttr","data-transitioning-state"),zt("initialState"),yo("onTransition"),yo("onFinish"),Lt("routes",Ct(Ye.value,Ct(Ye.value,Ot([Gt("transition",[zt("property"),zt("transitionClass")])]))))],qf=kr({fields:Gf,name:"transitioning",active:Uf,apis:Wf,extra:{createRoutes:function(n){var e={};return R(n,(function(n,t){var r=t.split("<->");e[r[0]]=dt(r[1],n),e[r[1]]=dt(r[0],n)})),e},createBistate:function(n,e,t){return mt([{key:n,value:dt(e,t)},{key:e,value:dt(n,t)}])},createTristate:function(n,e,t,r){return mt([{key:n,value:mt([{key:e,value:r},{key:t,value:r}])},{key:e,value:mt([{key:n,value:r},{key:t,value:r}])},{key:t,value:mt([{key:n,value:r},{key:e,value:r}])}])}}}),Yf=Po.resolve("scrollable"),Kf={register:function(n){Hr(n,Yf)},deregister:function(n){zr(n,Yf)},scrollable:r(Yf)},Xf=function(n){return lt(n,"format").getOr(n.title)},Jf=function(n,e,t,r,o){return{data:{value:n,text:e},type:"item",dom:{tag:"div",classes:o?[Po.resolve("styles-item-is-menu")]:[]},toggling:{toggleOnExecute:!1,toggleClass:Po.resolve("format-matches"),selected:t},itemBehaviours:Sr(o?[]:[jo(n,(function(n,e){(e?_o.on:_o.off)(n)}))]),components:[{dom:{tag:"div",attributes:{style:r},innerHtml:e}}]}},Qf=function(n,e,t,r){return{value:n,dom:{tag:"div"},components:[ma.sketch({dom:{tag:"div",classes:[Po.resolve("styles-collapser")]},components:r?[{dom:{tag:"span",classes:[Po.resolve("styles-collapse-icon")]}},vf(n)]:[vf(n)],action:function(n){if(r){var e=t().get(n);jf.collapseMenu(e)}}}),{dom:{tag:"div",classes:[Po.resolve("styles-menu-items-container")]},components:[Ff.parts().items({})],behaviours:Sr([ms("adhoc-scrollable-menu",[or((function(n,e){Xo(n.element(),"overflow-y","auto"),Xo(n.element(),"-webkit-overflow-scrolling","touch"),Kf.register(n.element())})),ir((function(n){ei(n.element(),"overflow-y"),ei(n.element(),"-webkit-overflow-scrolling"),Kf.deregister(n.element())}))])])}],items:e,menuBehaviours:Sr([qf.config({initialState:"after",routes:qf.createTristate("before","current","after",{transition:{property:"transform",transitionClass:"transitioning"}})})])}},Zf=function(n){return Tn(n,(function(n,e){var t=function(n){return vt(n,"items")?(t=C(function(n,e){return t=["items"],r={},R(n,(function(n,e){yn(t,e)||(r[e]=n)})),r;var t,r}(e=n),{menu:!0}),r=Zf(e.items),{item:t,menus:C(r.menus,dt(e.title,r.items)),expansions:C(r.expansions,dt(e.title,e.title))}):{item:n,menus:{},expansions:{}};var e,t,r}(e);return{menus:C(n.menus,t.menus),items:[t.item].concat(n.items),expansions:C(n.expansions,t.expansions)}}),{menus:{},expansions:{},items:[]})},nl={expand:Zf},el=["undo","bold","italic","link","image","bullist","styleselect"],tl=function(n){var e=n.replace(/\|/g," ").trim();return 0<e.length?e.split(/\s+/):[]},rl=function(n){return En(n,(function(n){return w(n)?rl(n):tl(n)}))},ol=function(n,e){var t=function(n){return function(){return function(n,e){return ya(e,(function(){n.execCommand(e)}),{})}(e,n)}},o=function(n){return function(){return function(n,e){var t=ha(e);return ya(e,(function(){n.execCommand(e)}),t)}(e,n)}},i=function(n,e,t){return function(){return wa(0,n,e,t)}},u=t("undo"),c=t("redo"),a=o("bold"),s=o("italic"),f=o("underline"),l=t("removeformat"),d=i("unlink","link",(function(){e.execCommand("unlink",null,!1)})),m=i("unordered-list","ul",(function(){e.execCommand("InsertUnorderedList",null,!1)})),g=i("ordered-list","ol",(function(){e.execCommand("InsertOrderedList",null,!1)})),v=function(n,e){var t=function(e){return function(){return n.formatter.match(e)}},o=function(e){return function(){return n.formatter.getCssText(e)}},i=lt(e,"style_formats").getOr(Ks),u=function(e){return bn(e,(function(e){if(vt(e,"items")){var i=u(e.items);return C(C(e,{isSelected:r(!1),getPreview:r("")}),{items:i})}return vt(e,"format")?C(f=e,{isSelected:t(f.format),getPreview:o(f.format)}):(a=Cc((c=e).title),s=C(c,{format:a,isSelected:t(a),getPreview:o(a)}),n.formatter.register(a,s),s);var c,a,s,f}))};return u(i)}(e,e.settings),p=function(){return function(n,e,t){var r,o,i;return function(n){var e,t,r,o,i,u=(t=function(){return c},r=Qf("Styles",[].concat(bn((e=n.formats).items,(function(n){return Jf(Xf(n),n.title,n.isSelected(),n.getPreview(),vt(e.expansions,Xf(n)))}))),t,!1),o=B(e.menus,(function(n,r){var o=bn(n,(function(n){return Jf(Xf(n),n.title,void 0!==n.isSelected&&n.isSelected(),void 0!==n.getPreview?n.getPreview():"",vt(e.expansions,Xf(n)))}));return Qf(r,o,t,!0)})),i=C(o,dt("styles",r)),{tmenu:jf.tieredData("styles",i,e.expansions)}),c=ts(jf.sketch({dom:{tag:"div",classes:[Po.resolve("styles-menu")]},components:[],fakeFocus:!0,stayInDom:!0,onExecute:function(e,t){var r=La.getValue(t);return n.handle(t,r.value),A.none()},onEscape:function(){return A.none()},onOpenMenu:function(n,e){var t=Ga(n.element());Ua(e.element(),t),qf.jumpTo(e,"current")},onOpenSubmenu:function(n,e,t){var r=Ga(n.element()),o=vi(e.element(),'[role="menu"]').getOrDie("hacky"),i=n.getSystem().getByDom(o).getOrDie();Ua(t.element(),r),qf.progressTo(i,"before"),qf.jumpTo(t,"after"),qf.progressTo(t,"current")},onCollapseMenu:function(n,e,t){var r=vi(e.element(),'[role="menu"]').getOrDie("hacky"),o=n.getSystem().getByDom(r).getOrDie();qf.progressTo(o,"after"),qf.progressTo(t,"current")},navigateOnHover:!1,openImmediately:!0,data:u.tmenu,markers:{backgroundMenu:Po.resolve("styles-background-menu"),menu:Po.resolve("styles-menu"),selectedMenu:Po.resolve("styles-selected-menu"),item:Po.resolve("styles-item"),selectedItem:Po.resolve("styles-selected-item")}}));return c.asSpec()}({formats:(r=n,i=(o=function(n){return En(n,(function(n){return void 0!==n.items?0<o(n.items).length?[n]:[]:!vt(n,"format")||r.formatter.canApply(n.format)?[n]:[]}))})(e),nl.expand(i)),handle:function(e,r){n.undoManager.transact((function(){_o.isOn(e)?n.formatter.remove(r):n.formatter.apply(r)})),t()}})}(e,v,(function(){e.fire("scrollIntoView")}))},h=function(n,t){return{isSupported:function(){return n.forall((function(n){return vt(e.buttons,n)}))},sketch:t}};return{undo:h(A.none(),u),redo:h(A.none(),c),bold:h(A.none(),a),italic:h(A.none(),s),underline:h(A.none(),f),removeformat:h(A.none(),l),link:h(A.none(),(function(){return t=n,wa(r=e,"link","link",(function(){var n=Ys(t,r);t.setContextToolbar(n),ds(r,(function(){t.focusToolbar()})),ss(r).each((function(n){r.selection.select(n.dom())}))}));var t,r})),unlink:h(A.none(),d),image:h(A.none(),(function(){return function(n){var e=ts({dom:{tag:"input",attributes:{accept:"image/*",type:"file",title:""},styles:{visibility:"hidden",position:"absolute"}},events:Jt([rr(q()),Zt(G(),(function(e,t){var r,o,i;(r=t,o=r.event(),i=o.raw().target.files||o.raw().dataTransfer.files,A.from(i[0])).each((function(e){os(n,e)}))}))])});return ma.sketch({dom:va('<span class="${prefix}-toolbar-button ${prefix}-icon-image ${prefix}-icon"></span>'),components:[e.asSpec()],action:function(n){e.get(n).element().dom().click()}})}(e)})),bullist:h(A.some("bullist"),m),numlist:h(A.some("numlist"),g),fontsizeselect:h(A.none(),(function(){return t=e,r={onChange:function(n){ns.apply(t,n)},getInitialValue:function(){return ns.get(t)}},Ka(n,"font-size",(function(){return function(n){return[pa('<span class="${prefix}-toolbar-button ${prefix}-icon-small-font ${prefix}-icon"></span>'),(e=n,Ja({onChange:e.onChange,sizes:es,category:"font",getInitialValue:e.getInitialValue})),pa('<span class="${prefix}-toolbar-button ${prefix}-icon-large-font ${prefix}-icon"></span>')];var e}(r)}));var t,r})),forecolor:h(A.none(),(function(){return function(n,e){var t={onChange:function(n,t,r){e.undoManager.transact((function(){e.formatter.apply("forecolor",{value:r}),e.nodeChanged()}))},getInitialValue:function(){return-1}};return Ka(n,"color",(function(){return function(n){return[(e=n,t=function(n){return n<0?"black":360<n?"white":"hsl("+n+", 100%, 50%)"},Ya.sketch({dom:va('<div class="${prefix}-slider ${prefix}-hue-slider-container"></div>'),components:[Ya.parts()["left-edge"](pa('<div class="${prefix}-hue-slider-black"></div>')),Ya.parts().spectrum({dom:va('<div class="${prefix}-slider-gradient-container"></div>'),components:[pa('<div class="${prefix}-slider-gradient"></div>')],behaviours:Sr([_o.config({toggleClass:Po.resolve("thumb-active")})])}),Ya.parts()["right-edge"](pa('<div class="${prefix}-hue-slider-white"></div>')),Ya.parts().thumb({dom:va('<div class="${prefix}-slider-thumb"></div>'),behaviours:Sr([_o.config({toggleClass:Po.resolve("thumb-active")})])})],onChange:function(n,r,o){var i=t(o);Xo(r.element(),"background-color",i),e.onChange(n,r,i)},onDragStart:function(n,e){_o.on(e)},onDragEnd:function(n,e){_o.off(e)},onInit:function(n,e,r){var o=t(r);Xo(e.element(),"background-color",o)},stepSize:10,min:0,max:360,getInitialValue:e.getInitialValue,sliderBehaviours:Sr([Ho(Ya.refresh)])}))];var e,t}(t)}))}(n,e)})),styleselect:h(A.none(),(function(){return ba("style-formats",(function(t){e.fire("toReading"),n.dropup().appear(p,_o.on,t)}),Sr([_o.config({toggleClass:Po.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),Co.config({channels:mt([zo(ro.orientationChanged(),_o.off),zo(ro.dropupDismissed(),_o.off)])})]))}))}},il=function(n,e){var t=function(n){var e=void 0!==n.toolbar?n.toolbar:el;return w(e)?rl(e):tl(e)}(n),r={};return En(t,(function(n){var t=!vt(r,n)&&vt(e,n)&&e[n].isSupported()?[e[n].sketch()]:[];return r[n]=!0,t}))},ul=function(n,e,o,u,c){var a=function(n,e){return function(o){if(n(o)){var i,u,c,a,s,f,l,d=ie(o.target),m=function(){o.stopPropagation()},g=function(){o.preventDefault()},v=t(g,m),p=(i=d,u=o.clientX,c=o.clientY,a=m,s=g,f=v,l=o,{target:r(i),x:r(u),y:r(c),stop:a,prevent:s,kill:f,raw:r(l)});e(p)}}}(o,u);return n.dom().addEventListener(e,a,c),{unbind:i(cl,n,e,a,c)}},cl=function(n,e,t,r){n.dom().removeEventListener(e,t,r)},al=r(!0),sl=function(n,e,t){return ul(n,e,al,t,!1)},fl=function(n,e,t){return ul(n,e,al,t,!0)},ll=function(n){var e=n.matchMedia("(orientation: portrait)").matches;return{isPortrait:r(e)}},dl=ll,ml=function(n,e){var t=ie(n),r=null,o=sl(t,"orientationchange",(function(){clearInterval(r);var t=ll(n);e.onChange(t),i((function(){e.onReady(t)}))})),i=function(e){clearInterval(r);var t=n.innerHeight,o=0;r=setInterval((function(){t!==n.innerHeight?(clearInterval(r),e(A.some(n.innerHeight))):20<o&&(clearInterval(r),e(A.none())),o++}),50)};return{onAdjustment:i,destroy:function(){o.unbind()}}},gl=function(n){var e=jn.detect().os.isiOS(),t=ll(n).isPortrait();return e&&!t?n.screen.height:n.screen.width},vl=function(n){var e=n.raw();return void 0===e.touches||1!==e.touches.length?A.none():A.some(e.touches[0])},pl=function(e){var t,o,i=Gr(A.none()),u=(t=function(n){i.set(A.none()),e.triggerEvent(qn(),n)},o=null,{cancel:function(){null!==o&&(n.clearTimeout(o),o=null)},schedule:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];o=n.setTimeout((function(){t.apply(null,e),o=null}),400)}}),c=mt([{key:_(),value:function(n){return vl(n).each((function(e){u.cancel();var t={x:r(e.clientX),y:r(e.clientY),target:n.target};u.schedule(n),i.set(A.some(t))})),A.none()}},{key:j(),value:function(n){return u.cancel(),vl(n).each((function(n){i.get().each((function(e){var t,r,o,u;t=n,r=e,o=Math.abs(t.clientX-r.x()),u=Math.abs(t.clientY-r.y()),(5<o||5<u)&&i.set(A.none())}))})),A.none()}},{key:H(),value:function(n){return u.cancel(),i.get().filter((function(e){return Me(e.target(),n.target())})).map((function(t){return e.triggerEvent(Un(),n)}))}}]);return{fireIfReady:function(n,e){return lt(c,e).bind((function(e){return e(n)}))}}},hl=function(n){var e=pl({triggerEvent:function(e,t){n.onTapContent(t)}});return{fireTouchstart:function(n){e.fireIfReady(n,"touchstart")},onTouchend:function(){return sl(n.body(),"touchend",(function(n){e.fireIfReady(n,"touchend")}))},onTouchmove:function(){return sl(n.body(),"touchmove",(function(n){e.fireIfReady(n,"touchmove")}))}}},yl=6<=jn.detect().os.version.major,bl=function(n,e){var t=parseInt(Ar(n,e),10);return isNaN(t)?0:t},wl=(ai=me,{get:function(n){if(!ai(n))throw new Error("Can only get text value of a text node");return si(n).getOr("")},getOption:si=function(n){return ai(n)?A.from(n.dom().nodeValue):A.none()},set:function(n,e){if(!ai(n))throw new Error("Can only set raw text value of a text node");n.dom().nodeValue=e}}),xl={create:he("start","soffset","finish","foffset")},Tl=Ke([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Sl={before:Tl.before,on:Tl.on,after:Tl.after,cata:function(n,e,t,r){return n.fold(e,t,r)},getStart:function(n){return n.fold(o,o,o)}},Ol=Ke([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),kl={domRange:Ol.domRange,relative:Ol.relative,exact:Ol.exact,exactFromRange:function(n){return Ol.exact(n.start(),n.soffset(),n.finish(),n.foffset())},getWin:function(n){var e=n.match({domRange:function(n){return ie(n.startContainer)},relative:function(n,e){return Sl.getStart(n)},exact:function(n,e,t,r){return n}});return Fe(e)},range:xl.create},Cl=function(n,e,t){var r,o,i=n.document.createRange();return r=i,e.fold((function(n){r.setStartBefore(n.dom())}),(function(n,e){r.setStart(n.dom(),e)}),(function(n){r.setStartAfter(n.dom())})),o=i,t.fold((function(n){o.setEndBefore(n.dom())}),(function(n,e){o.setEnd(n.dom(),e)}),(function(n){o.setEndAfter(n.dom())})),i},El=function(n,e,t,r,o){var i=n.document.createRange();return i.setStart(e.dom(),t),i.setEnd(r.dom(),o),i},Il=function(n){return{left:r(n.left),top:r(n.top),right:r(n.right),bottom:r(n.bottom),width:r(n.width),height:r(n.height)}},Dl=Ke([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),Ml=function(n,e,t){return e(ie(t.startContainer),t.startOffset,ie(t.endContainer),t.endOffset)},Al=function(n,e){var t,o,i,u=(t=n,e.match({domRange:function(n){return{ltr:r(n),rtl:A.none}},relative:function(n,e){return{ltr:X((function(){return Cl(t,n,e)})),rtl:X((function(){return A.some(Cl(t,e,n))}))}},exact:function(n,e,r,o){return{ltr:X((function(){return El(t,n,e,r,o)})),rtl:X((function(){return A.some(El(t,r,o,n,e))}))}}}));return(i=(o=u).ltr()).collapsed?o.rtl().filter((function(n){return!1===n.collapsed})).map((function(n){return Dl.rtl(ie(n.endContainer),n.endOffset,ie(n.startContainer),n.startOffset)})).getOrThunk((function(){return Ml(0,Dl.ltr,i)})):Ml(0,Dl.ltr,i)},Fl=function(n,e){var t=fe(n);return"input"===t?Sl.after(n):yn(["br","img"],t)?0===e?Sl.before(n):Sl.after(n):Sl.on(n,e)},Rl=function(n,e,t,r,o){var i,u,c=El(n,e,t,r,o);i=n,u=c,A.from(i.getSelection()).each((function(n){n.removeAllRanges(),n.addRange(u)}))},Bl=function(n){var e=ie(n.anchorNode),t=ie(n.focusNode);return function(n,e,t,r){var o,i,u,c,a,s=(i=e,u=t,c=r,(a=Ae(o=n).dom().createRange()).setStart(o.dom(),i),a.setEnd(u.dom(),c),a),f=Me(n,t)&&e===r;return s.collapsed&&!f}(e,n.anchorOffset,t,n.focusOffset)?A.some(xl.create(e,n.anchorOffset,t,n.focusOffset)):function(n){if(0<n.rangeCount){var e=n.getRangeAt(0),t=n.getRangeAt(n.rangeCount-1);return A.some(xl.create(ie(e.startContainer),e.startOffset,ie(t.endContainer),t.endOffset))}return A.none()}(n)},Vl=function(n){return A.from(n.getSelection()).filter((function(n){return 0<n.rangeCount})).bind(Bl)},Nl=function(n,e){var t,r,o,i,u=Al(t=n,e).match({ltr:function(n,e,r,o){var i=t.document.createRange();return i.setStart(n.dom(),e),i.setEnd(r.dom(),o),i},rtl:function(n,e,r,o){var i=t.document.createRange();return i.setStart(r.dom(),o),i.setEnd(n.dom(),e),i}});return 0<(i=0<(o=(r=u).getClientRects()).length?o[0]:r.getBoundingClientRect()).width||0<i.height?A.some(i).map(Il):A.none()},_l=function(n){return{left:n.left,top:n.top,right:n.right,bottom:n.bottom,width:r(2),height:n.height}},jl=function(n){return{left:r(n.left),top:r(n.top),right:r(n.right),bottom:r(n.bottom),width:r(n.width),height:r(n.height)}},Hl=function(n){var e=n.getSelection();return void 0!==e&&0<e.rangeCount?function(n){if(n.collapsed){var e=ie(n.startContainer);return Re(e).bind((function(t){var r=kl.exact(e,n.startOffset,t,function(n){return"img"===fe(n)?1:(e=n,wl.getOption(e)).fold((function(){return Be(n).length}),(function(n){return n.length}));var e}(t));return Nl(n.startContainer.ownerDocument.defaultView,r).map(_l).map(Mn)})).getOr([])}return bn(n.getClientRects(),jl)}(e.getRangeAt(0)):[]},zl="data-"+Po.resolve("last-outer-height"),Ll=function(n,e){Dr(n,zl,e)},Pl=function(n){return{top:r(n.top()),bottom:r(n.top()+n.height())}},$l=function(n){return A.some(ie(n.dom().contentWindow.document.body))},Wl=function(n){return A.some(ie(n.dom().contentWindow.document))},Ul=function(n){return A.from(n.dom().contentWindow)},Gl=function(n){return Ul(n).bind(Vl)},ql=function(n){return n.getFrame()},Yl=function(n,e){return function(t){return t[n].getOrThunk((function(){var n=ql(t);return function(){return e(n)}}))()}},Kl=function(n,e,t,r){return n[t].getOrThunk((function(){return function(n){return sl(e,r,n)}}))},Xl=function(n){return{left:r(n.left),top:r(n.top),right:r(n.right),bottom:r(n.bottom),width:r(n.width),height:r(n.height)}},Jl={getBody:Yl("getBody",$l),getDoc:Yl("getDoc",Wl),getWin:Yl("getWin",Ul),getSelection:Yl("getSelection",Gl),getFrame:ql,getActiveApi:function(n){var e=ql(n);return $l(e).bind((function(t){return Wl(e).bind((function(o){return Ul(e).map((function(u){var c=ie(o.dom().documentElement),a=n.getCursorBox.getOrThunk((function(){return function(){return(n=u,Vl(n).map((function(n){return kl.exact(n.start(),n.soffset(),n.finish(),n.foffset())}))).bind((function(n){return Nl(u,n).orThunk((function(){return Vl(u).filter((function(n){return Me(n.start(),n.finish())&&n.soffset()===n.foffset()})).bind((function(n){var e=n.start().dom().getBoundingClientRect();return 0<e.width||0<e.height?A.some(e).map(Xl):A.none()}))}))}));var n}})),s=n.setSelection.getOrThunk((function(){return function(n,e,t,r){!function(n,e,t,r,o){var i,u,c,a,s,f=(i=r,u=o,c=Fl(e,t),a=Fl(i,u),kl.relative(c,a));Al(s=n,f).match({ltr:function(n,e,t,r){Rl(s,n,e,t,r)},rtl:function(n,e,t,r){var o,i,u,c,a,f=s.getSelection();if(f.setBaseAndExtent)f.setBaseAndExtent(n.dom(),e,t.dom(),r);else if(f.extend)try{i=n,u=e,c=t,a=r,(o=f).collapse(i.dom(),u),o.extend(c.dom(),a)}catch(o){Rl(s,t,r,n,e)}else Rl(s,t,r,n,e)}})}(u,n,e,t,r)}})),f=n.clearSelection.getOrThunk((function(){return function(){u.getSelection().removeAllRanges()}}));return{body:r(t),doc:r(o),win:r(u),html:r(c),getSelection:i(Gl,e),setSelection:s,clearSelection:f,frame:r(e),onKeyup:Kl(n,o,"onKeyup","keyup"),onNodeChanged:Kl(n,o,"onNodeChanged","selectionchange"),onDomChanged:n.onDomChanged,onScrollToCursor:n.onScrollToCursor,onScrollToElement:n.onScrollToElement,onToReading:n.onToReading,onToEditing:n.onToEditing,onToolbarScrollStart:n.onToolbarScrollStart,onTouchContent:n.onTouchContent,onTapContent:n.onTapContent,onTouchToolstrip:n.onTouchToolstrip,getCursorBox:a}}))}))}))}},Ql="data-ephox-mobile-fullscreen-style",Zl="position:absolute!important;",nd="top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;height:100%!important;overflow:visible!important;",ed=jn.detect().os.isAndroid(),td=function(n,e){var t,r=function(n){return function(e){var t=Ar(e,"style"),r=void 0===t?"no-styles":t.trim();r!==n&&(Dr(e,Ql,r),Dr(e,"style",n))}},o=function(n,e,t){return xn(function(n,e){for(var t=T(e)?e:v,r=n.dom(),o=[];null!==r.parentNode&&void 0!==r.parentNode;){var i=r.parentNode,u=ie(i);if(o.push(u),!0===t(u))break;r=i}return o}(n,void 0),(function(n){return Ce(n,"*")}))}(n),i=En(o,(function(n){return function(n,e){return xn(Re(t=n).map(Be).map((function(n){return xn(n,(function(n){return!Me(t,n)}))})).getOr([]),(function(n){return Ce(n,"*")}));var t}(n)})),u=void 0!==(t=Qo(e,"background-color"))&&""!==t?"background-color:"+t+"!important":"background-color:rgb(255,255,255)!important;";wn(i,r("display:none!important;")),wn(o,r(Zl+nd+u)),r((!0===ed?"":Zl)+nd+u)(n)},rd=function(){var n=Ie("["+Ql+"]");wn(n,(function(n){var e=Ar(n,Ql);"no-styles"!==e?Dr(n,"style",e):Rr(n,"style"),Rr(n,Ql)}))},od=function(){var n=gi("head").getOrDie(),e=gi('meta[name="viewport"]').getOrThunk((function(){var e=oe("meta");return Dr(e,"name","viewport"),Ne(n,e),e})),t=Ar(e,"content");return{maximize:function(){Dr(e,"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){null!=t&&0<t.length?Dr(e,"content",t):Dr(e,"content","user-scalable=yes")}}},id=function(n,t){var r=od(),o=Us(),i=Us();return{enter:function(){t.hide(),Hr(n.container,Po.resolve("fullscreen-maximized")),Hr(n.container,Po.resolve("android-maximized")),r.maximize(),Hr(n.body,Po.resolve("android-scroll-reload")),o.set(function(n,e){var t=ie(e.document.body),r=sl(ie(n),"resize",(function(){(function(n,e){var t=bl(e,zl),r=n.innerHeight;return r<t?A.some(t-r):A.none()})(n,t).each((function(n){var t,r;(t=e,r=Hl(t),0<r.length?A.some(r[0]).map(Pl):A.none()).each((function(t){var r,o,i,u=(r=e,i=n,(o=t).top()>r.innerHeight||o.bottom()>r.innerHeight?Math.min(i,o.bottom()-r.innerHeight+50):0);0!==u&&e.scrollTo(e.pageXOffset,e.pageYOffset+u)}))})),Ll(t,n.innerHeight)}));return Ll(t,n.innerHeight),{toEditing:function(){!function(n){n.focus();var e=ie(n.document.body);(Qr().exists((function(n){return yn(["input","textarea"],fe(n))}))?function(n){setTimeout((function(){n()}),0)}:g)((function(){Qr().each(Jr),Xr(e)}))}(e)},destroy:function(){r.unbind()}}}(n.win,Jl.getWin(n.editor).getOrDie("no"))),Jl.getActiveApi(n.editor).each((function(t){td(n.container,t.body()),i.set(function(n,t,r){var o=hl(n),i=Ae(t),u=function(n){return!Me(n.start(),n.finish())||n.soffset()!==n.foffset()},c=function(){var e=n.doc().dom().hasFocus()&&n.getSelection().exists(u);r.getByDom(t).each(!0===(e||Qr(i).filter((function(n){return"input"===fe(n)})).exists((function(n){return n.dom().selectionStart!==n.dom().selectionEnd})))?_o.on:_o.off)},a=[sl(n.body(),"touchstart",(function(e){n.onTouchContent(),o.fireTouchstart(e)})),o.onTouchmove(),o.onTouchend(),sl(t,"touchstart",(function(e){n.onTouchToolstrip()})),n.onToReading((function(){Jr(n.body())})),n.onToEditing(e),n.onScrollToCursor((function(e){e.preventDefault(),n.getCursorBox().each((function(e){var t=n.win(),r=e.top()>t.innerHeight||e.bottom()>t.innerHeight?e.bottom()-t.innerHeight+50:0;0!==r&&t.scrollTo(t.pageXOffset,t.pageYOffset+r)}))}))].concat(!0===yl?[]:[sl(ie(n.win()),"blur",(function(){r.getByDom(t).each(_o.off)})),sl(i,"select",c),sl(n.doc(),"selectionchange",c)]);return{destroy:function(){wn(a,(function(n){n.unbind()}))}}}(t,n.toolstrip,n.alloy))}))},exit:function(){r.restore(),t.show(),zr(n.container,Po.resolve("fullscreen-maximized")),zr(n.container,Po.resolve("android-maximized")),rd(),zr(n.body,Po.resolve("android-scroll-reload")),i.clear(),o.clear()}}},ud=function(e,t){var r=null;return{cancel:function(){null!==r&&(n.clearTimeout(r),r=null)},throttle:function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];null!==r&&n.clearTimeout(r),r=n.setTimeout((function(){e.apply(null,o),r=null}),t)}}},cd=function(e,t){var r,o,i=ts(hs.sketch({dom:va('<div aria-hidden="true" class="${prefix}-mask-tap-icon"></div>'),containerBehaviours:Sr([_o.config({toggleClass:Po.resolve("mask-tap-icon-selected"),toggleOnExecute:!1})])})),u=(r=e,o=null,{cancel:function(){null!==o&&(n.clearTimeout(o),o=null)},throttle:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];null===o&&(o=n.setTimeout((function(){r.apply(null,e),o=null}),200))}});return hs.sketch({dom:va('<div class="${prefix}-disabled-mask"></div>'),components:[hs.sketch({dom:va('<div class="${prefix}-content-container"></div>'),components:[ma.sketch({dom:va('<div class="${prefix}-content-tap-section"></div>'),components:[i.asSpec()],action:function(n){u.throttle()},buttonBehaviours:Sr([_o.config({toggleClass:Po.resolve("mask-tap-icon-selected")})])})]})]})},ad=kt([$t("editor",[zt("getFrame"),Wt("getBody"),Wt("getDoc"),Wt("getWin"),Wt("getSelection"),Wt("setSelection"),Wt("clearSelection"),Wt("cursorSaver"),Wt("onKeyup"),Wt("onNodeChanged"),Wt("getCursorBox"),zt("onDomChanged"),qt("onTouchContent",e),qt("onTapContent",e),qt("onTouchToolstrip",e),qt("onScrollToCursor",r({unbind:e})),qt("onScrollToElement",r({unbind:e})),qt("onToEditing",r({unbind:e})),qt("onToReading",r({unbind:e})),qt("onToolbarScrollStart",o)]),zt("socket"),zt("toolstrip"),zt("dropup"),zt("toolbar"),zt("container"),zt("alloy"),Kt("win",(function(n){return Ae(n.socket).dom().defaultView})),Kt("body",(function(n){return ie(n.socket.dom().ownerDocument.body)})),qt("translate",o),qt("setReadOnly",e),qt("readOnlyOnInit",r(!0))]),sd=r([qt("shell",!0),hc("toolbarBehaviours",[Vf])]),fd=r([zc({name:"groups",overrides:function(n){return{behaviours:Sr([Vf.config({})])}}})]),ld=da({name:"Toolbar",configFields:sd(),partFields:fd(),factory:function(e,t,r,o){var i=function(n){return e.shell()?A.some(n):Gc(n,e,"groups")},u=e.shell()?{behaviours:[Vf.config({})],components:[]}:{behaviours:[],components:t};return{uid:e.uid(),dom:e.dom(),components:u.components,behaviours:C(Sr(u.behaviours),yc(e.toolbarBehaviours())),apis:{setGroups:function(e,t){i(e).fold((function(){throw n.console.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")}),(function(n){Vf.set(n,t)}))}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(n,e,t){n.setGroups(e,t)}}}),dd=r([zt("items"),(fi=["itemClass"],$t("markers",bn(fi,zt))),hc("tgroupBehaviours",[pc])]),md=r([Lc({name:"items",unit:"item",overrides:function(n){return{domModification:{classes:[n.markers().itemClass()]}}}})]),gd=da({name:"ToolbarGroup",configFields:dd(),partFields:md(),factory:function(n,e,t,r){return C({dom:{attributes:{role:"toolbar"}}},{uid:n.uid(),dom:n.dom(),components:e,behaviours:C(Sr([pc.config({mode:"flow",selector:"."+n.markers().itemClass()})]),yc(n.tgroupBehaviours())),"debug.sketcher":t["debug.sketcher"]})}}),vd="data-"+Po.resolve("horizontal-scroll"),pd=function(n){return"true"===Ar(n,vd)?0<(t=n).dom().scrollLeft||function(n){n.dom().scrollLeft=1;var e=0!==n.dom().scrollLeft;return n.dom().scrollLeft=0,e}(t):0<(e=n).dom().scrollTop||function(n){n.dom().scrollTop=1;var e=0!==n.dom().scrollTop;return n.dom().scrollTop=0,e}(e);var e,t},hd=function(n,t){return sl(n,"touchmove",(function(n){hi(n.target(),t).filter(pd).fold((function(){n.raw().preventDefault()}),e)}))};function yd(){var n=function(n){var e=!0===n.scrollable?"${prefix}-toolbar-scrollable-group":"";return{dom:va('<div aria-label="'+n.label+'" class="${prefix}-toolbar-group '+e+'"></div>'),tgroupBehaviours:Sr([ms("adhoc-scrollable-toolbar",!0===n.scrollable?[ur((function(n,e){Xo(n.element(),"overflow-x","auto"),function(n){Dr(n,vd,"true")}(n.element()),Kf.register(n.element())}))]:[])]),components:[hs.sketch({components:[gd.parts().items({})]})],markers:{itemClass:Po.resolve("toolbar-group-item")},items:n.items}},e=hf(ld.sketch({dom:va('<div class="${prefix}-toolbar"></div>'),components:[ld.parts().groups({})],toolbarBehaviours:Sr([_o.config({toggleClass:Po.resolve("context-toolbar"),toggleOnExecute:!1,aria:{mode:"none"}}),pc.config({mode:"cyclic"})]),shell:!0})),o=hf(hs.sketch({dom:{classes:[Po.resolve("toolstrip")]},components:[yf(e)],containerBehaviours:Sr([_o.config({toggleClass:Po.resolve("android-selection-context-toolbar"),toggleOnExecute:!1})])})),i=function(){ld.setGroups(e,u.get()),_o.off(e)},u=Gr([]);return{wrapper:r(o),toolbar:r(e),createGroups:function(e){return bn(e,t(gd.sketch,n))},setGroups:function(n){u.set(n),i()},setContextToolbar:function(n){_o.on(e),ld.setGroups(e,n)},restoreToolbar:function(){_o.isOn(e)&&i()},refresh:function(){},focus:function(){pc.focusIn(e)}}}var bd=function(n,e){Vf.append(n,yf(e))},wd=function(n,e){Vf.remove(n,e)},xd=function(n){return hf(ma.sketch({dom:va('<div class="${prefix}-mask-edit-icon ${prefix}-icon"></div>'),action:function(){n.run((function(n){n.setReadOnly(!1)}))}}))},Td=function(){return hf(hs.sketch({dom:va('<div class="${prefix}-editor-socket"></div>'),components:[],containerBehaviours:Sr([Vf.config({})])}))},Sd=function(n,e,t,r){(!0===t?Ur.toAlpha:Ur.toOmega)(r),(t?bd:wd)(n,e)},Od=function(n,e){return e.getAnimationRoot().fold((function(){return n.element()}),(function(e){return e(n)}))},kd=function(n){return n.dimension().property()},Cd=function(n,e){return n.dimension().getDimension()(e)},Ed=function(n,e){var t=Od(n,e);ff(t,[e.shrinkingClass(),e.growingClass()])},Id=function(n,e){zr(n.element(),e.openClass()),Hr(n.element(),e.closedClass()),Xo(n.element(),kd(e),"0px"),ti(n.element())},Dd=function(n,e){zr(n.element(),e.closedClass()),Hr(n.element(),e.openClass()),ei(n.element(),kd(e))},Md=function(n,e,t){t.setCollapsed(),Xo(n.element(),kd(e),Cd(e,n.element())),ti(n.element());var r=Od(n,e);Hr(r,e.shrinkingClass()),Id(n,e),e.onStartShrink()(n)},Ad=function(n,e,t){var r=function(n,e){Dd(n,e);var t=Cd(e,n.element());return Id(n,e),t}(n,e),o=Od(n,e);Hr(o,e.growingClass()),Dd(n,e),Xo(n.element(),kd(e),r),t.setExpanded(),e.onStartGrow()(n)},Fd=function(n,e,t){var r=Od(n,e);return!0===Lr(r,e.growingClass())},Rd=function(n,e,t){var r=Od(n,e);return!0===Lr(r,e.shrinkingClass())},Bd=Object.freeze({grow:function(n,e,t){t.isExpanded()||Ad(n,e,t)},shrink:function(n,e,t){t.isExpanded()&&Md(n,e,t)},immediateShrink:function(n,e,t){var r,o;t.isExpanded()&&(r=n,o=e,t.setCollapsed(),Xo(r.element(),kd(o),Cd(o,r.element())),ti(r.element()),Ed(r,o),Id(r,o),o.onStartShrink()(r),o.onShrunk()(r))},hasGrown:function(n,e,t){return t.isExpanded()},hasShrunk:function(n,e,t){return t.isCollapsed()},isGrowing:Fd,isShrinking:Rd,isTransitioning:function(n,e,t){return!0===Fd(n,e)||!0===Rd(n,e)},toggleGrow:function(n,e,t){(t.isExpanded()?Md:Ad)(n,e,t)},disableTransitions:Ed}),Vd=Object.freeze({exhibit:function(n,e){var t=e.expanded();return lr(t?{classes:[e.openClass()],styles:{}}:{classes:[e.closedClass()],styles:dt(e.dimension().property(),"0px")})},events:function(n,e){return Jt([Zt(Y(),(function(t,r){r.event().raw().propertyName===n.dimension().property()&&(Ed(t,n),e.isExpanded()&&ei(t.element(),n.dimension().property()),(e.isExpanded()?n.onGrown():n.onShrunk())(t))}))])}}),Nd=[zt("closedClass"),zt("openClass"),zt("shrinkingClass"),zt("growingClass"),Wt("getAnimationRoot"),yo("onShrunk"),yo("onStartShrink"),yo("onGrown"),yo("onStartGrow"),qt("expanded",!1),Lt("dimension",_t("property",{width:[To("property","width"),To("getDimension",(function(n){return Ga(n)+"px"}))],height:[To("property","height"),To("getDimension",(function(n){return di(n)+"px"}))]}))],_d=kr({fields:Nd,name:"sliding",active:Vd,apis:Bd,state:Object.freeze({init:function(n){var e=Gr(n.expanded());return Tr({isExpanded:function(){return!0===e.get()},isCollapsed:function(){return!1===e.get()},setCollapsed:i(e.set,!1),setExpanded:i(e.set,!0),readState:function(){return"expanded: "+e.get()}})}})}),jd=function(t,o){var i=hf(hs.sketch({dom:{tag:"div",classes:[Po.resolve("dropup")]},components:[],containerBehaviours:Sr([Vf.config({}),_d.config({closedClass:Po.resolve("dropup-closed"),openClass:Po.resolve("dropup-open"),shrinkingClass:Po.resolve("dropup-shrinking"),growingClass:Po.resolve("dropup-growing"),dimension:{property:"height"},onShrunk:function(n){t(),o(),Vf.set(n,[])},onGrown:function(n){t(),o()}}),Ho((function(n,t){u(e)}))])})),u=function(e){n.window.requestAnimationFrame((function(){e(),_d.shrink(i)}))};return{appear:function(e,t,r){!0===_d.hasShrunk(i)&&!1===_d.isTransitioning(i)&&n.window.requestAnimationFrame((function(){t(r),Vf.set(i,[e()]),_d.grow(i)}))},disappear:u,component:r(i),element:i.element}},Hd=jn.detect().browser.isFirefox(),zd=Ot([Pt("triggerEvent"),Pt("broadcastEvent"),qt("stopBackspace",!0)]),Ld=function(n,e){var t=lt(n,"target").map((function(n){return n()})).getOr(e);return Gr(t)},Pd=Ke([{stopped:[]},{resume:["element"]},{complete:[]}]),$d=function(n,e,t,o,i,u){var c,a,s,f,l=n(e,o),d=(c=t,a=i,s=Gr(!1),f=Gr(!1),{stop:function(){s.set(!0)},cut:function(){f.set(!0)},isStopped:s.get,isCut:f.get,event:r(c),setSource:a.set,getSource:a.get});return l.fold((function(){return u.logEventNoHandlers(e,o),Pd.complete()}),(function(n){var t=n.descHandler();return uf(t)(d),d.isStopped()?(u.logEventStopped(e,n.element(),t.purpose()),Pd.stopped()):d.isCut()?(u.logEventCut(e,n.element(),t.purpose()),Pd.complete()):Re(n.element()).fold((function(){return u.logNoParent(e,n.element(),t.purpose()),Pd.complete()}),(function(r){return u.logEventResponse(e,n.element(),t.purpose()),Pd.resume(r)}))}))},Wd=function(n,e,t,r,o,i){return $d(n,e,t,r,o,i).fold((function(){return!0}),(function(r){return Wd(n,e,t,r,o,i)}),(function(){return!1}))},Ud=function(n,t,o){var i,u,c=(i=t,u=Gr(!1),{stop:function(){u.set(!0)},cut:e,isStopped:u.get,isCut:r(!1),event:r(i),setSource:m("Cannot set source of a broadcasted event"),getSource:m("Cannot get source of a broadcasted event")});return wn(n,(function(n){var e=n.descHandler();uf(e)(c)})),c.isStopped()},Gd=function(n,e,t,r,o){var i=Ld(t,r);return Wd(n,e,t,r,i,o)},qd=he("element","descHandler");function Yd(){var n,e=(n={},{registerId:function(e,t,o){R(o,(function(o,u){var c=void 0!==n[u]?n[u]:{};c[t]=function(n,e){return t=i.apply(void 0,[n.handler].concat(e)),o=n.purpose(),{cHandler:t,purpose:r(o)};var t,o}(o,e),n[u]=c}))},unregisterId:function(e){R(n,(function(n,t){n.hasOwnProperty(e)&&delete n[e]}))},filterByType:function(e){return lt(n,e).map((function(n){return N(n,(function(n,e){return function(n,e){return{id:r(n),descHandler:r(e)}}(e,n)}))})).getOr([])},find:function(e,t,r){var o=st(t)(n);return function(n,e,t){return Kr(n,(function(n){return e(n).isSome()}),t).bind(e)}(r,(function(n){return e=o,oa(t=n).fold((function(){return A.none()}),(function(n){var r=st(n);return e.bind(r).map((function(n){return qd(t,n)}))}));var e,t}),e)}}),t={},o=function(n){oa(n.element()).each((function(n){t[n]=void 0,e.unregisterId(n)}))};return{find:function(n,t,r){return e.find(n,t,r)},filter:function(n){return e.filterByType(n)},register:function(n){var r=function(n){var e=n.element();return oa(e).fold((function(){return e=n.element(),t=Cc(ta+"uid-"),Dr(e,ra,t),t;var e,t}),(function(n){return n}))}(n);vt(t,r)&&function(n,e){var r=t[e];if(r!==n)throw new Error('The tagId "'+e+'" is already used by: '+io(r.element())+"\nCannot use it for: "+io(n.element())+"\nThe conflicting element is"+(ge(r.element())?" ":" not ")+"already in the DOM");o(n)}(n,r);var i=[n];e.registerId(i,r,n.events()),t[r]=n},unregister:o,getById:function(n){return st(n)(t)}}}var Kd=r(Po.resolve("readonly-mode")),Xd=r(Po.resolve("edit-mode"));function Jd(t){return function(t){var o=function(n){return Re(t.element()).fold((function(){return!0}),(function(e){return Me(n,e)}))},i=Yd(),u=function(n,e){return i.find(o,n,e)},c=function(e,t){var r,o,i,u,c=Bt("Getting GUI events settings",zd,t),a=jn.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],s=pl(c),f=bn(a.concat(["selectstart","input","contextmenu","change","transitionend","drag","dragstart","dragend","dragenter","dragleave","dragover","drop"]),(function(n){return sl(e,n,(function(e){s.fireIfReady(e,n).each((function(n){n&&e.kill()})),c.triggerEvent(n,e)&&e.kill()}))})),l=sl(e,"keydown",(function(n){var e;c.triggerEvent("keydown",n)?n.kill():!0!==c.stopBackspace||8!==(e=n).raw().which||yn(["input","textarea"],fe(e.target()))||n.prevent()})),d=(r=e,o=function(n){c.triggerEvent("focusin",n)&&n.kill()},Hd?fl(r,"focus",o):sl(r,"focusin",o)),m=(i=e,u=function(e){c.triggerEvent("focusout",e)&&e.kill(),n.setTimeout((function(){c.triggerEvent(Ln(),e)}),0)},Hd?fl(i,"blur",u):sl(i,"focusout",u)),g=Fe(e),v=sl(g,"scroll",(function(n){c.broadcastEvent(Kn(),n)&&n.kill()}));return{unbind:function(){wn(f,(function(n){n.unbind()})),l.unbind(),d.unbind(),m.unbind(),v.unbind()}}}(t.element(),{triggerEvent:function(n,e){return lo(n,e.target(),(function(t){return r=u,o=n,c=t,a=(i=e).target(),Gd(r,o,i,a,c);var r,o,i,c,a}))},broadcastEvent:function(n,e){var t=i.filter(n);return Ud(t,e)}}),a=Zs({debugInfo:r("real"),triggerEvent:function(n,e,t){lo(n,e,(function(r){Gd(u,n,t,e,r)}))},triggerFocus:function(n,t){oa(n).fold((function(){Xr(n)}),(function(o){lo(zn(),n,(function(o){var i,c,a,s,f,l;i=u,c=zn(),a={originator:r(t),kill:e,prevent:e,target:r(n)},f=o,l=Ld(a,s=n),$d(i,c,a,s,l,f)}))}))},triggerEscape:function(n,e){a.triggerEvent("keydown",n.element(),e.event())},getByUid:function(n){return p(n)},getByDom:function(n){return h(n)},build:hf,addToGui:function(n){l(n)},removeFromGui:function(n){d(n)},addToWorld:function(n){s(n)},removeFromWorld:function(n){f(n)},broadcast:function(n){g(n)},broadcastOn:function(n,e){v(n,e)},isConnected:r(!0)}),s=function(n){n.connect(a),me(n.element())||(i.register(n),wn(n.components(),s),a.triggerEvent(Yn(),n.element(),{target:r(n.element())}))},f=function(n){me(n.element())||(wn(n.components(),f),i.unregister(n)),n.disconnect()},l=function(n){Pe(t,n)},d=function(n){Ue(n)},m=function(n){var e=i.filter(Pn());wn(e,(function(e){var t=e.descHandler();uf(t)(n)}))},g=function(n){m({universal:r(!0),data:r(n)})},v=function(n,e){m({universal:r(!1),channels:r(n),data:r(e)})},p=function(n){return i.getById(n).fold((function(){return Ye.error(new Error('Could not find component with uid: "'+n+'" in system.'))}),Ye.value)},h=function(n){var e=oa(n).getOr("not found");return p(e)};return s(t),{root:r(t),element:t.element,destroy:function(){c.unbind(),He(t.element())},add:l,remove:d,getByUid:p,getByDom:h,addToWorld:s,removeFromWorld:f,broadcast:g,broadcastOn:v}}(hf(hs.sketch({dom:{classes:[Po.resolve("outer-container")].concat(t.classes)},containerBehaviours:Sr([Ur.config({alpha:Kd(),omega:Xd()})])})))}var Qd,Zd,nm=function(n,e){var t=oe("input");Jo(t,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"}),Ne(n,t),Xr(t),e(t),He(t)},em=function(n){var e=n.getSelection();if(0<e.rangeCount){var t=e.getRangeAt(0),r=n.document.createRange();r.setStart(t.startContainer,t.startOffset),r.setEnd(t.endContainer,t.endOffset),e.removeAllRanges(),e.addRange(r)}},tm=function(n,e){Qr().each((function(n){Me(n,e)||Jr(n)})),n.focus(),Xr(ie(n.document.body)),em(n)},rm={stubborn:function(n,e,t,r){var o=function(){tm(e,r)},i=sl(t,"keydown",(function(n){yn(["input","textarea"],fe(n.target()))||o()}));return{toReading:function(){nm(n,Jr)},toEditing:o,onToolbarTouch:function(){},destroy:function(){i.unbind()}}},timid:function(n,t,r,o){var i=function(){Jr(o)};return{toReading:function(){i()},toEditing:function(){tm(t,o)},onToolbarTouch:function(){i()},destroy:e}}},om={},im={exports:om};Qd=om,Zd=im,function(n){"object"==typeof Qd&&void 0!==Zd?Zd.exports=n():("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EphoxContactWrapper=n()}((function(){return function n(e,t,r){function o(u,c){if(!t[u]){if(!e[u]){if(i)return i(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var s=t[u]={exports:{}};e[u][0].call(s.exports,(function(n){return o(e[u][1][n]||n)}),s,s.exports,n,e,t,r)}return t[u].exports}for(var i=!1,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(n,e,t){var r,o,i=e.exports={};function u(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function a(n){if(r===setTimeout)return setTimeout(n,0);if((r===u||!r)&&setTimeout)return r=setTimeout,setTimeout(n,0);try{return r(n,0)}catch(e){try{return r.call(null,n,0)}catch(e){return r.call(this,n,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:u}catch(n){r=u}try{o="function"==typeof clearTimeout?clearTimeout:c}catch(n){o=c}}();var s,f=[],l=!1,d=-1;function m(){l&&s&&(l=!1,s.length?f=s.concat(f):d=-1,f.length&&g())}function g(){if(!l){var n=a(m);l=!0;for(var e=f.length;e;){for(s=f,f=[];++d<e;)s&&s[d].run();d=-1,e=f.length}s=null,l=!1,function(n){if(o===clearTimeout)return clearTimeout(n);if((o===c||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(n);try{o(n)}catch(e){try{return o.call(null,n)}catch(e){return o.call(this,n)}}}(n)}}function v(n,e){this.fun=n,this.array=e}function p(){}i.nextTick=function(n){var e=new Array(arguments.length-1);if(1<arguments.length)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];f.push(new v(n,e)),1!==f.length||l||a(g)},v.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(n){return[]},i.binding=function(n){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(n){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],2:[function(n,e,t){(function(n){!function(t){var r=setTimeout;function o(){}function i(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(n,this)}function u(n,e){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,i._immediateFn((function(){var t=1===n._state?e.onFulfilled:e.onRejected;if(null!==t){var r;try{r=t(n._value)}catch(n){return void a(e.promise,n)}c(e.promise,r)}else(1===n._state?c:a)(e.promise,n._value)}))):n._deferreds.push(e)}function c(n,e){try{if(e===n)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if(e instanceof i)return n._state=3,n._value=e,void s(n);if("function"==typeof t)return void l((r=t,o=e,function(){r.apply(o,arguments)}),n)}n._state=1,n._value=e,s(n)}catch(e){a(n,e)}var r,o}function a(n,e){n._state=2,n._value=e,s(n)}function s(n){2===n._state&&0===n._deferreds.length&&i._immediateFn((function(){n._handled||i._unhandledRejectionFn(n._value)}));for(var e=0,t=n._deferreds.length;e<t;e++)u(n,n._deferreds[e]);n._deferreds=null}function f(n,e,t){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.promise=t}function l(n,e){var t=!1;try{n((function(n){t||(t=!0,c(e,n))}),(function(n){t||(t=!0,a(e,n))}))}catch(n){if(t)return;t=!0,a(e,n)}}i.prototype.catch=function(n){return this.then(null,n)},i.prototype.then=function(n,e){var t=new this.constructor(o);return u(this,new f(n,e,t)),t},i.all=function(n){var e=Array.prototype.slice.call(n);return new i((function(n,t){if(0===e.length)return n([]);var r=e.length;function o(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var c=u.then;if("function"==typeof c)return void c.call(u,(function(n){o(i,n)}),t)}e[i]=u,0==--r&&n(e)}catch(n){t(n)}}for(var i=0;i<e.length;i++)o(i,e[i])}))},i.resolve=function(n){return n&&"object"==typeof n&&n.constructor===i?n:new i((function(e){e(n)}))},i.reject=function(n){return new i((function(e,t){t(n)}))},i.race=function(n){return new i((function(e,t){for(var r=0,o=n.length;r<o;r++)n[r].then(e,t)}))},i._immediateFn="function"==typeof n?function(e){n(e)}:function(n){r(n,0)},i._unhandledRejectionFn=function(n){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",n)},i._setImmediateFn=function(n){i._immediateFn=n},i._setUnhandledRejectionFn=function(n){i._unhandledRejectionFn=n},void 0!==e&&e.exports?e.exports=i:t.Promise||(t.Promise=i)}(this)}).call(this,n("timers").setImmediate)},{timers:3}],3:[function(n,e,t){(function(e,r){var o=n("process/browser.js").nextTick,i=Function.prototype.apply,u=Array.prototype.slice,c={},a=0;function s(n,e){this._id=n,this._clearFn=e}t.setTimeout=function(){return new s(i.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new s(i.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(n){n.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(n,e){clearTimeout(n._idleTimeoutId),n._idleTimeout=e},t.unenroll=function(n){clearTimeout(n._idleTimeoutId),n._idleTimeout=-1},t._unrefActive=t.active=function(n){clearTimeout(n._idleTimeoutId);var e=n._idleTimeout;0<=e&&(n._idleTimeoutId=setTimeout((function(){n._onTimeout&&n._onTimeout()}),e))},t.setImmediate="function"==typeof e?e:function(n){var e=a++,r=!(arguments.length<2)&&u.call(arguments,1);return c[e]=!0,o((function(){c[e]&&(r?n.apply(null,r):n.call(null),t.clearImmediate(e))})),e},t.clearImmediate="function"==typeof r?r:function(n){delete c[n]}}).call(this,n("timers").setImmediate,n("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(n,e,t){var r=n("promise-polyfill"),o="undefined"!=typeof window?window:Function("return this;")();e.exports={boltExport:o.Promise||r}},{"promise-polyfill":2}]},{},[4])(4)}));var um=im.exports.boltExport,cm=function(e){var t=A.none(),r=[],o=function(n){i()?u(n):r.push(n)},i=function(){return t.isSome()},u=function(e){t.each((function(t){n.setTimeout((function(){e(t)}),0)}))};return e((function(n){t=A.some(n),function(n){wn(n,u)}(r),r=[]})),{get:o,map:function(n){return cm((function(e){o((function(t){e(n(t))}))}))},isReady:i}},am={nu:cm,pure:function(n){return cm((function(e){e(n)}))}},sm=function(e){n.setTimeout((function(){throw e}),0)},fm=function(n){var e=function(e){n().then(e,sm)};return{map:function(e){return fm((function(){return n().then(e)}))},bind:function(e){return fm((function(){return n().then((function(n){return e(n).toPromise()}))}))},anonBind:function(e){return fm((function(){return n().then((function(){return e.toPromise()}))}))},toLazy:function(){return am.nu(e)},toCached:function(){var e=null;return fm((function(){return null===e&&(e=n()),e}))},toPromise:n,get:e}},lm=function(n){return fm((function(){return new um(n)}))},dm=function(n,e){var t=Ae(n).dom().defaultView;return di(n)+di(e)-function(n){var e,t=dl(n).isPortrait(),r=function(n,e){return function(n,e){for(var t=0;t<n.length;t++){var r=e(n[t]);if(r.isSome())return r}return A.none()}([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}],(function(t){return r=n<=t.width&&e<=t.height,o=t.keyboard,r?A.some(o):A.none();var r,o})).getOr({portrait:e/5,landscape:n/4})}((e=n).screen.width,e.screen.height),o=t?r.portrait:r.landscape;return(t?n.screen.height:n.screen.width)-n.innerHeight>o?0:o}(t)},mm=dm,gm=function(n,e,t){var r=dm(e,t),o=di(e)+di(t)-r;Xo(n,"padding-bottom",o+"px")},vm=Ke([{fixed:["element","property","offsetY"]},{scroller:["element","offsetY"]}]),pm="data-"+Po.resolve("position-y-fixed"),hm="data-"+Po.resolve("y-property"),ym="data-"+Po.resolve("scrolling"),bm="data-"+Po.resolve("last-window-height"),wm=function(n){return bl(n,pm)},xm=function(n,e){var t=Ar(n,hm);return vm.fixed(n,t,e)},Tm=function(n,e){return vm.scroller(n,e)},Sm=function(n){var e=wm(n);return("true"===Ar(n,ym)?Tm:xm)(n,e)},Om=function(n,e,t){var r=Ae(n).dom().defaultView.innerHeight;return Dr(n,bm,r+"px"),r-e-t},km=wm,Cm=function(){var n=null;return{animate:function(e,t,r,o,i,u){var c=!1,a=function(n){c=!0,i(n)};clearInterval(n);var s=function(e){clearInterval(n),a(e)};n=setInterval((function(){var i=e();(function(n,e,t){return Math.abs(n-e)<=t?A.none():n<e?A.some(n+t):A.some(n-t)})(i,t,r).fold((function(){clearInterval(n),a(t)}),(function(r){if(o(r,s),!c){var u=e();(u!==r||Math.abs(u-t)>Math.abs(i-t))&&(clearInterval(n),a(t))}}))}),u)}}}(),Em="data-"+Po.resolve("last-scroll-top"),Im=function(n){var e=ni(n,"top").getOr("0");return parseInt(e,10)},Dm=function(n){return parseInt(n.dom().scrollTop,10)},Mm=function(n,e){var t=e+km(n)+"px";Xo(n,"top",t)},Am=function(n,e){return lm((function(t){var r=i(Dm,n);Dr(n,Em,r());var o=Math.abs(e-r()),u=Math.ceil(o/10);Cm.animate(r,e,u,(function(e,t){bl(n,Em)!==n.dom().scrollTop?t(n.dom().scrollTop):(n.dom().scrollTop=e,Dr(n,Em,e))}),(function(){n.dom().scrollTop=e,Dr(n,Em,e),t(e)}),10)}))},Fm=function(n,e){return lm((function(t){var r=i(Im,n),o=function(e){Xo(n,"top",e+"px")},u=Math.abs(e-r()),c=Math.ceil(u/10);Cm.animate(r,e,c,o,(function(){o(e),t(e)}),10)}))},Rm=function(n,e,t,r,o){var u=mm(e,t),c=i(em,n);u<r||u<o?Am(e,e.dom().scrollTop-u+o).get(c):r<0&&Am(e,e.dom().scrollTop+r).get(c)},Bm=function(n,e){var t=function(n){var e=mi(n,"["+pm+"]");return bn(e,Sm)}(n);return function(n,e){return e((function(e){var t=[],r=0;0===n.length?e([]):wn(n,(function(o,i){var u;o.get((u=i,function(o){t[u]=o,++r>=n.length&&e(t)}))}))}))}(bn(t,(function(n){return function(n,e){return n.fold((function(n,t,r){return Xo(n,t,e+(o=r)+"px"),function(n){return fm((function(){return um.resolve(n)}))}(o);var o}),(function(n,t){return u=e+(o=t),c=ni(r=n,"top").getOr(o),a=u-parseInt(c,10),s=r.dom().scrollTop+a,function(n,e,t){return lm((function(r){var o=i(Dm,n);Cm.animate(o,e,15,(function(e){n.dom().scrollTop=e,Xo(n,"top",Im(n)+15+"px")}),(function(){n.dom().scrollTop=e,Xo(n,"top",t+"px"),r(e)}),10)}))}(r,s,u);var r,o,u,c,a,s}))}(n,e)})),lm)},Vm=function(n){var t=n.cWin(),i=n.ceBody(),u=n.socket(),c=n.toolstrip(),a=n.toolbar(),s=n.contentElement(),f=n.keyboardType(),l=n.outerWindow(),m=n.dropup(),g=function(n,e,t,r){var o,i,u,c,a,s,f,l,m=Ae(n).dom().defaultView,g=(l=Ar(f=t,"style"),Jo(f,{position:"absolute",top:"0px"}),Dr(f,pm,"0px"),Dr(f,hm,"top"),{restore:function(){Dr(f,"style",l||""),Rr(f,pm),Rr(f,hm)}}),v=di(t),p=di(r),h=(c=Om(n,u=v,p),s=Ar(a=n,"style"),Kf.register(a),Jo(a,{position:"absolute",height:c+"px",width:"100%",top:u+"px"}),Dr(a,pm,u+"px"),Dr(a,ym,"true"),Dr(a,hm,"top"),{restore:function(){Kf.deregister(a),Dr(a,"style",s||""),Rr(a,pm),Rr(a,ym),Rr(a,hm)}}),y=(i=Ar(o=r,"style"),Jo(o,{position:"absolute",bottom:"0px"}),Dr(o,pm,"0px"),Dr(o,hm,"bottom"),{restore:function(){Dr(o,"style",i||""),Rr(o,pm),Rr(o,hm)}}),b=!0,w=function(){var e=m.innerHeight;return bl(n,bm)<e},x=function(){if(b){var o=di(t),i=di(r),u=Om(n,o,i);Dr(n,pm,o+"px"),Xo(n,"height",u+"px"),gm(e,n,r)}};return gm(e,n,r),{setViewportOffset:function(e){Dr(n,pm,e+"px"),x()},isExpanding:w,isShrinking:d(w),refresh:x,restore:function(){b=!1,g.restore(),h.restore(),y.restore()}}}(u,i,c,m),v=f(n.outerBody(),t,ve(),s,c,a),p=ml(l,{onChange:e,onReady:g.refresh});p.onAdjustment((function(){g.refresh()}));var h=sl(ie(l),"resize",(function(){g.isExpanding()&&g.refresh()})),y=function(n,e,t,i,u,c){var a,s,f=(a=function(t){return function(n,e,t){var r=Ae(n).dom().defaultView;return lm((function(o){Mm(n,t),Mm(e,t),r.scrollTo(0,t),o(t)}))}(n,e,t)},s=Gr(am.pure({})),{start:function(n){var e=am.nu((function(e){return a(n).get(e)}));s.set(e)},idle:function(n){s.get().get((function(){n()}))}}),l=ud((function(){f.idle((function(){Bm(t,i.pageYOffset).get((function(){var n;(n=Hl(c),A.from(n[0]).bind((function(n){var t=n.top()-e.dom().scrollTop;return t>i.innerHeight+5||t<-5?A.some({top:r(t),bottom:r(t+n.height())}):A.none()}))).each((function(n){e.dom().scrollTop=e.dom().scrollTop+n.top()})),f.start(0),u.refresh()}))}))}),1e3),d=sl(ie(i),"scroll",(function(){i.pageYOffset<0||l.throttle()}));return Bm(t,i.pageYOffset).get(o),{unbind:d.unbind}}(c,u,n.outerBody(),l,g,t),b=function(n,e){var t=n.document,r=oe("div");Hr(r,Po.resolve("unfocused-selections")),Ne(ie(t.documentElement),r);var o=sl(r,"touchstart",(function(t){t.prevent(),tm(n,e),u()})),i=function(n){var e=oe("span");return sf(e,[Po.resolve("layer-editor"),Po.resolve("unfocused-selection")]),Jo(e,{left:n.left()+"px",top:n.top()+"px",width:n.width()+"px",height:n.height()+"px"}),e},u=function(){je(r)};return{update:function(){u();var e=Hl(n),t=bn(e,i);_e(r,t)},isActive:function(){return 0<Be(r).length},destroy:function(){o.unbind(),He(r)},clear:u}}(t,s),w=function(){b.clear()};return{toEditing:function(){v.toEditing(),w()},toReading:function(){v.toReading()},onToolbarTouch:function(n){v.onToolbarTouch(n)},refreshSelection:function(){b.isActive()&&b.update()},clearSelection:w,highlightSelection:function(){b.update()},scrollIntoView:function(n,e){Rm(t,u,m,n,e)},updateToolbarPadding:e,setViewportOffset:function(n){g.setViewportOffset(n),Fm(u,n).get(o)},syncHeight:function(){Xo(s,"height",s.dom().contentWindow.document.body.scrollHeight+"px")},refreshStructure:g.refresh,destroy:function(){g.restore(),p.destroy(),y.unbind(),h.unbind(),v.destroy(),b.destroy(),nm(ve(),Jr)}}},Nm=function(t,r){var o=od(),i=Gs(),u=Gs(),c=Us(),a=Us();return{enter:function(){r.hide();var s=ie(n.document);Jl.getActiveApi(t.editor).each((function(r){i.set({socketHeight:ni(t.socket,"height"),iframeHeight:ni(r.frame(),"height"),outerScroll:n.document.body.scrollTop}),u.set({exclusives:hd(s,"."+Kf.scrollable())}),Hr(t.container,Po.resolve("fullscreen-maximized")),td(t.container,r.body()),o.maximize(),Xo(t.socket,"overflow","scroll"),Xo(t.socket,"-webkit-overflow-scrolling","touch"),Xr(r.body());var f=Se(["cWin","ceBody","socket","toolstrip","toolbar","dropup","contentElement","cursor","keyboardType","isScrolling","outerWindow","outerBody"],[]);c.set(Vm(f({cWin:r.win(),ceBody:r.body(),socket:t.socket,toolstrip:t.toolstrip,toolbar:t.toolbar,dropup:t.dropup.element(),contentElement:r.frame(),cursor:e,outerBody:t.body,outerWindow:t.win,keyboardType:rm.stubborn,isScrolling:function(){return u.get().exists((function(n){return n.socket.isScrolling()}))}}))),c.run((function(n){n.syncHeight()})),a.set(function(n,e,t,r,o){var i=function(){e.run((function(n){n.refreshSelection()}))},u=function(n,t){var o=n-r.dom().scrollTop;e.run((function(n){n.scrollIntoView(o,o+t)}))},c=function(){e.run((function(n){n.clearSelection()}))},a=function(){n.getCursorBox().each((function(n){u(n.top(),n.height())})),e.run((function(n){n.syncHeight()}))},s=hl(n),f=ud(a,300),l=[n.onKeyup((function(){c(),f.throttle()})),n.onNodeChanged(i),n.onDomChanged(f.throttle),n.onDomChanged(i),n.onScrollToCursor((function(n){n.preventDefault(),f.throttle()})),n.onScrollToElement((function(n){n.element(),u(e,r)})),n.onToEditing((function(){e.run((function(n){n.toEditing()}))})),n.onToReading((function(){e.run((function(n){n.toReading()}))})),sl(n.doc(),"touchend",(function(e){Me(n.html(),e.target())||Me(n.body(),e.target())})),sl(t,"transitionend",(function(n){var r;"height"===n.raw().propertyName&&(r=di(t),e.run((function(n){n.setViewportOffset(r)})),i(),a())})),fl(t,"touchstart",(function(t){var r;e.run((function(n){n.highlightSelection()})),r=t,e.run((function(n){n.onToolbarTouch(r)})),n.onTouchToolstrip()})),sl(n.body(),"touchstart",(function(e){c(),n.onTouchContent(),s.fireTouchstart(e)})),s.onTouchmove(),s.onTouchend(),sl(n.body(),"click",(function(n){n.kill()})),sl(t,"touchmove",(function(){n.onToolbarScrollStart()}))];return{destroy:function(){wn(l,(function(n){n.unbind()}))}}}(r,c,t.toolstrip,t.socket,t.dropup))}))},refreshStructure:function(){c.run((function(n){n.refreshStructure()}))},exit:function(){o.restore(),a.clear(),c.clear(),r.show(),i.on((function(e){e.socketHeight.each((function(n){Xo(t.socket,"height",n)})),e.iframeHeight.each((function(n){Xo(t.editor.getFrame(),"height",n)})),n.document.body.scrollTop=e.scrollTop})),i.clear(),u.on((function(n){n.exclusives.unbind()})),u.clear(),zr(t.container,Po.resolve("fullscreen-maximized")),rd(),Kf.deregister(t.toolbar),ei(t.socket,"overflow"),ei(t.socket,"-webkit-overflow-scrolling"),Jr(t.editor.getFrame()),Jl.getActiveApi(t.editor).each((function(n){n.clearSelection()}))}}},_m=tinymce.util.Tools.resolve("tinymce.EditorManager"),jm=function(n,e,t){n.system().broadcastOn([ro.formatChanged()],{command:e,state:t})},Hm=(r(["x-small","small","medium","large","x-large"]),function(n){var e=function(){n._skinLoaded=!0,n.fire("SkinLoaded")};return function(){n.initialized?e():n.on("init",e)}}),zm=r("toReading"),Lm=r("toEditing");eo.add("mobile",(function(n){return{getNotificationManagerImpl:function(){return{open:r({progressBar:{value:e},close:e}),close:e,reposition:e,getArgs:o}},renderUI:function(t){var o=function(n){var e=lt(n.settings,"skin_url").fold((function(){return _m.baseURL+"/skins/lightgray"}),(function(n){return n}));return{content:e+"/content.mobile.min.css",ui:e+"/skin.mobile.min.css"}}(n);0==(!1===n.settings.skin)?(n.contentCSS.push(o.content),no.DOM.styleSheetLoader.load(o.ui,Hm(n))):Hm(n)();var i,u,c,a,s,f,l,d,m,g,v,p,h,y,b,w,x,T=function(){n.fire("scrollIntoView")},S=oe("div"),O=jn.detect().os.isAndroid()?(d=T,m=Jd({classes:[Po.resolve("android-container")]}),g=yd(),v=Us(),p=xd(v),h=Td(),y=jd(e,d),m.add(g.wrapper()),m.add(h),m.add(y.component()),{system:r(m),element:m.element,init:function(n){v.set(function(n){var t=Bt("Getting AndroidWebapp schema",ad,n);Xo(t.toolstrip,"width","100%");var r=hf(cd((function(){t.setReadOnly(t.readOnlyOnInit()),i.enter()}),t.translate));t.alloy.add(r);var o={show:function(){t.alloy.add(r)},hide:function(){t.alloy.remove(r)}};Ne(t.container,r.element());var i=id(t,o);return{setReadOnly:t.setReadOnly,refreshStructure:e,enter:i.enter,exit:i.exit,destroy:e}}(n))},exit:function(){v.run((function(n){n.exit(),Vf.remove(h,p)}))},setToolbarGroups:function(n){var e=g.createGroups(n);g.setGroups(e)},setContextToolbar:function(n){var e=g.createGroups(n);g.setContextToolbar(e)},focusToolbar:function(){g.focus()},restoreToolbar:function(){g.restoreToolbar()},updateMode:function(n){Sd(h,p,n,m.root())},socket:r(h),dropup:r(y)}):(i=T,u=Jd({classes:[Po.resolve("ios-container")]}),c=yd(),a=Us(),s=xd(a),f=Td(),l=jd((function(){a.run((function(n){n.refreshStructure()}))}),i),u.add(c.wrapper()),u.add(f),u.add(l.component()),{system:r(u),element:u.element,init:function(n){a.set(function(n){var t=Bt("Getting IosWebapp schema",ad,n);Xo(t.toolstrip,"width","100%"),Xo(t.container,"position","relative");var r=hf(cd((function(){t.setReadOnly(t.readOnlyOnInit()),o.enter()}),t.translate));t.alloy.add(r);var o=Nm(t,{show:function(){t.alloy.add(r)},hide:function(){t.alloy.remove(r)}});return{setReadOnly:t.setReadOnly,refreshStructure:o.refreshStructure,enter:o.enter,exit:o.exit,destroy:e}}(n))},exit:function(){a.run((function(n){Vf.remove(f,s),n.exit()}))},setToolbarGroups:function(n){var e=c.createGroups(n);c.setGroups(e)},setContextToolbar:function(n){var e=c.createGroups(n);c.setContextToolbar(e)},focusToolbar:function(){c.focus()},restoreToolbar:function(){c.restoreToolbar()},updateMode:function(n){Sd(f,s,n,u.root())},socket:r(f),dropup:r(l)}),k=ie(t.targetNode);he("element","offset"),w=S,(x=b=k,A.from(x.dom().nextSibling).map(ie)).fold((function(){Re(b).each((function(n){Ne(n,w)}))}),(function(n){var e,t;t=w,Re(e=n).each((function(n){n.dom().insertBefore(t.dom(),e.dom())}))})),function(n,e){Ne(n,e.element());var t=Be(e.element());wn(t,(function(n){e.getByDom(n).each(Le)}))}(S,O.system());var C=t.targetNode.ownerDocument.defaultView,E=ml(C,{onChange:function(){O.system().broadcastOn([ro.orientationChanged()],{width:gl(C)})},onReady:e}),I=function(e,t,r,o){!1===o&&n.selection.collapse();var i=D(e,t,r);O.setToolbarGroups(!0===o?i.readOnly:i.main),n.setMode(!0===o?"readonly":"design"),n.fire(!0===o?zm():Lm()),O.updateMode(o)},D=function(n,e,t){var r=n.get();return{readOnly:r.backToMask.concat(e.get()),main:r.backToMask.concat(t.get())}},M=function(e,t){return n.on(e,t),{unbind:function(){n.off(e)}}};return n.on("init",(function(){O.init({editor:{getFrame:function(){return ie(n.contentAreaContainer.querySelector("iframe"))},onDomChanged:function(){return{unbind:e}},onToReading:function(n){return M(zm(),n)},onToEditing:function(n){return M(Lm(),n)},onScrollToCursor:function(e){return n.on("scrollIntoView",(function(n){e(n)})),{unbind:function(){n.off("scrollIntoView"),E.destroy()}}},onTouchToolstrip:function(){t()},onTouchContent:function(){var e;(e=ie(n.editorContainer.querySelector("."+Po.resolve("toolbar"))),Zr(e).bind((function(n){return O.system().getByDom(n).toOption()}))).each(ne),O.restoreToolbar(),t()},onTapContent:function(e){var t=e.target();"img"===fe(t)?(n.selection.select(t.dom()),e.kill()):"a"===fe(t)&&O.system().getByDom(ie(n.editorContainer)).each((function(n){Ur.isAlpha(n)&&to(t.dom())}))}},container:ie(n.editorContainer),socket:ie(n.contentAreaContainer),toolstrip:ie(n.editorContainer.querySelector("."+Po.resolve("toolstrip"))),toolbar:ie(n.editorContainer.querySelector("."+Po.resolve("toolbar"))),dropup:O.dropup(),alloy:O.system(),translate:e,setReadOnly:function(n){I(f,s,a,n)},readOnlyOnInit:function(){return!1}});var t=function(){O.dropup().disappear((function(){O.system().broadcastOn([ro.dropupDismissed()],{})}))},r={label:"The first group",scrollable:!1,items:[ba("back",(function(){n.selection.collapse(),O.exit()}),{})]},o={label:"Back to read only",scrollable:!1,items:[ba("readonly-back",(function(){I(f,s,a,!0)}),{})]},i=ol(O,n),u=il(n.settings,i),c={label:"The extra group",scrollable:!1,items:[]},a=Gr([{label:"the action group",scrollable:!0,items:u},c]),s=Gr([{label:"The read only mode group",scrollable:!0,items:[]},c]),f=Gr({backToMask:[r],backToReadOnly:[o]});!function(n,e){var t=F(e.formatter.get());wn(t,(function(t){e.formatter.formatChanged(t,(function(e){jm(n,t,e)}))})),wn(["ul","ol"],(function(t){e.selection.selectorChanged(t,(function(e,r){jm(n,t,e)}))}))}(O,n)})),n.on("remove",(function(){O.exit()})),n.on("detach",(function(){var n,e;n=O.system(),e=Be(n.element()),wn(e,(function(e){n.getByDom(e).each(ze)})),He(n.element()),O.system().destroy(),He(S)})),{iframeContainer:O.socket().element().dom(),editorContainer:O.element().dom()}}}}))}(window);