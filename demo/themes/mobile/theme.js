!function(n){"use strict";var e=function(){},t=function(n,e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return n(e.apply(null,t))}},r=function(n){return function(){return n}},o=function(n){return n};function i(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o=e.concat(t);return n.apply(null,o)}}var u,c=function(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!n.apply(null,e)}},a=function(n){return function(){throw new Error(n)}},s=function(n){return n()},f=r(!1),l=r(!0),d=function(n){return function(e){return function(n){if(null===n)return"null";var e=typeof n;return"object"===e&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"===e&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":e}(e)===n}},m=d("string"),g=d("object"),v=d("array"),p=d("boolean"),h=d("function"),y=d("number"),b=Object.prototype.hasOwnProperty,w=function(n){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];if(0===e.length)throw new Error("Can't merge zero objects");for(var r={},o=0;o<e.length;o++){var i=e[o];for(var u in i)b.call(i,u)&&(r[u]=n(r[u],i[u]))}return r}},x=w((function(n,e){return g(n)&&g(e)?x(n,e):e})),T=w((function(n,e){return e})),S=function(){return O},O=function(){var n=function(n){return n.isNone()},t=function(n){return n()},o=function(n){return n},i={fold:function(n,e){return n()},is:f,isSome:f,isNone:l,getOr:o,getOrThunk:t,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:r(null),getOrUndefined:r(void 0),or:o,orThunk:t,map:S,each:e,bind:S,exists:f,forall:l,filter:S,equals:n,equals_:n,toArray:function(){return[]},toString:r("none()")};return Object.freeze&&Object.freeze(i),i}(),k=function(n){var e=r(n),t=function(){return i},o=function(e){return e(n)},i={fold:function(e,t){return t(n)},is:function(e){return n===e},isSome:l,isNone:f,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:t,orThunk:t,map:function(e){return k(e(n))},each:function(e){e(n)},bind:o,exists:o,forall:o,filter:function(e){return e(n)?i:O},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(e){return e.is(n)},equals_:function(e,t){return e.fold(f,(function(e){return t(n,e)}))}};return i},C={some:k,none:S,from:function(n){return null==n?O:k(n)}},E=Object.keys,I=function(n,e){for(var t=E(n),r=0,o=t.length;r<o;r++){var i=t[r];e(n[i],i)}},D=function(n,e){return M(n,(function(n,t){return{k:t,v:e(n,t)}}))},M=function(n,e){var t={};return I(n,(function(n,r){var o=e(n,r);t[o.k]=o.v})),t},A=function(n,e){var t=[];return I(n,(function(n,r){t.push(e(n,r))})),t},F=r("touchstart"),R=r("touchmove"),B=r("touchend"),V=r("mousedown"),N=r("mousemove"),_=r("mouseup"),j=r("mouseover"),H=r("keydown"),z=r("input"),L=r("change"),P=r("click"),$=r("transitionend"),W=r("selectstart"),U=function(n){var e,t=!1;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return t||(t=!0,e=n.apply(null,r)),e}},G=function(){return q(0,0)},q=function(n,e){return{major:n,minor:e}},Y=function(n,e){var t=String(e).toLowerCase();return 0===n.length?G():function(n,e){var t=function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.test(e))return r}}(n,e);if(!t)return{major:0,minor:0};var r=function(n){return Number(e.replace(t,"$"+n))};return q(r(1),r(2))}(n,t)},K=G,X="Edge",J="Chrome",Q="Opera",Z="Firefox",nn="Safari",en=function(n,e){return function(){return e===n}},tn=function(n){var e=n.current;return{current:e,version:n.version,isEdge:en(X,e),isChrome:en(J,e),isIE:en("IE",e),isOpera:en(Q,e),isFirefox:en(Z,e),isSafari:en(nn,e)}},rn=function(){return tn({current:void 0,version:K()})},on=tn,un=(r(X),r(J),r("IE"),r(Q),r(Z),r(nn),"Windows"),cn="Android",an="Linux",sn="Solaris",fn="FreeBSD",ln=function(n,e){return function(){return e===n}},dn=function(n){var e=n.current;return{current:e,version:n.version,isWindows:ln(un,e),isiOS:ln("iOS",e),isAndroid:ln(cn,e),isOSX:ln("OSX",e),isLinux:ln(an,e),isSolaris:ln(sn,e),isFreeBSD:ln(fn,e)}},mn=function(){return dn({current:void 0,version:K()})},gn=dn,vn=(r(un),r("iOS"),r(cn),r(an),r("OSX"),r(sn),r(fn),Array.prototype.slice),pn=Array.prototype.indexOf,hn=Array.prototype.push,yn=function(n,e){return t=n,r=e,pn.call(t,r)>-1;var t,r},bn=function(n,e){for(var t=n.length,r=new Array(t),o=0;o<t;o++){var i=n[o];r[o]=e(i,o)}return r},wn=function(n,e){for(var t=0,r=n.length;t<r;t++)e(n[t],t)},xn=function(n,e){for(var t=[],r=0,o=n.length;r<o;r++){var i=n[r];e(i,r)&&t.push(i)}return t},Tn=function(n,e,t){return function(n,e){for(var t=n.length-1;t>=0;t--)e(n[t])}(n,(function(n){t=e(t,n)})),t},Sn=function(n,e,t){return wn(n,(function(n){t=e(t,n)})),t},On=function(n,e){for(var t=0,r=n.length;t<r;t++){var o=n[t];if(e(o,t))return C.some(o)}return C.none()},kn=function(n,e){for(var t=0,r=n.length;t<r;t++)if(e(n[t],t))return C.some(t);return C.none()},Cn=function(n){for(var e=[],t=0,r=n.length;t<r;++t){if(!v(n[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+n);hn.apply(e,n[t])}return e},En=function(n,e){var t=bn(n,e);return Cn(t)},In=function(n,e){for(var t=0,r=n.length;t<r;++t)if(!0!==e(n[t],t))return!1;return!0},Dn=function(n){var e=vn.call(n,0);return e.reverse(),e},Mn=function(n){return[n]},An=(h(Array.from)&&Array.from,function(n,e){var t=String(e).toLowerCase();return On(n,(function(n){return n.search(t)}))}),Fn=function(n,e){return-1!==n.indexOf(e)},Rn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Bn=function(n){return function(e){return Fn(e,n)}},Vn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return Fn(n,"edge/")&&Fn(n,"chrome")&&Fn(n,"safari")&&Fn(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Rn],search:function(n){return Fn(n,"chrome")&&!Fn(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return Fn(n,"msie")||Fn(n,"trident")}},{name:"Opera",versionRegexes:[Rn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Bn("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Bn("firefox")},{name:"Safari",versionRegexes:[Rn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(Fn(n,"safari")||Fn(n,"mobile/"))&&Fn(n,"applewebkit")}}],Nn=[{name:"Windows",search:Bn("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return Fn(n,"iphone")||Fn(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Bn("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Bn("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Bn("linux"),versionRegexes:[]},{name:"Solaris",search:Bn("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Bn("freebsd"),versionRegexes:[]}],_n={browsers:r(Vn),oses:r(Nn)},jn=function(n){var e=_n.browsers(),t=_n.oses(),o=function(n,e){return An(n,e).map((function(n){var t=Y(n.versionRegexes,e);return{current:n.name,version:t}}))}(e,n).fold(rn,on),i=function(n,e){return An(n,e).map((function(n){var t=Y(n.versionRegexes,e);return{current:n.name,version:t}}))}(t,n).fold(mn,gn),u=function(n,e,t){var o=n.isiOS()&&!0===/ipad/i.test(t),i=n.isiOS()&&!o,u=n.isAndroid()&&3===n.version.major,c=n.isAndroid()&&4===n.version.major,a=o||u||c&&!0===/mobile/i.test(t),s=n.isiOS()||n.isAndroid(),f=s&&!a,l=e.isSafari()&&n.isiOS()&&!1===/safari/i.test(t);return{isiPad:r(o),isiPhone:r(i),isTablet:r(a),isPhone:r(f),isTouch:r(s),isAndroid:n.isAndroid,isiOS:n.isiOS,isWebView:r(l)}}(i,o,n);return{browser:o,os:i,deviceType:u}},Hn={detect:U((function(){var e=n.navigator.userAgent;return jn(e)}))},zn={tap:r("alloy.tap")},Ln=r("alloy.focus"),Pn=r("alloy.blur.post"),$n=r("alloy.receive"),Wn=r("alloy.execute"),Un=r("alloy.focus.item"),Gn=zn.tap,qn=Hn.detect().deviceType.isTouch()?zn.tap:P,Yn=r("alloy.longpress"),Kn=r("alloy.system.init"),Xn=r("alloy.system.scroll"),Jn=r("alloy.system.attached"),Qn=r("alloy.system.detached"),Zn=function(n,e){re(n,n.element(),e,{})},ne=function(n,e,t){re(n,n.element(),e,t)},ee=function(n){Zn(n,Wn())},te=function(n,e,t){re(n,e,t,{})},re=function(n,e,t,o){var i=x({target:e},o);n.getSystem().triggerEvent(t,e,D(i,r))},oe=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:r(n)}},ie=function(e,t){var r=(t||n.document).createElement("div");if(r.innerHTML=e,!r.hasChildNodes()||r.childNodes.length>1)throw n.console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return oe(r.childNodes[0])},ue=function(e,t){var r=(t||n.document).createElement(e);return oe(r)},ce=function(e,t){var r=(t||n.document).createTextNode(e);return oe(r)},ae=oe,se=(n.Node.ATTRIBUTE_NODE,n.Node.CDATA_SECTION_NODE,n.Node.COMMENT_NODE,n.Node.DOCUMENT_NODE),fe=(n.Node.DOCUMENT_TYPE_NODE,n.Node.DOCUMENT_FRAGMENT_NODE,n.Node.ELEMENT_NODE),le=n.Node.TEXT_NODE,de=(n.Node.PROCESSING_INSTRUCTION_NODE,n.Node.ENTITY_REFERENCE_NODE,n.Node.ENTITY_NODE,n.Node.NOTATION_NODE,void 0!==n.window?n.window:Function("return this;")()),me=function(n,e){var t=function(n,e){return function(n,e){return function(n,e){for(var t=null!=e?e:de,r=0;r<n.length&&null!=t;++r)t=t[n[r]];return t}(n.split("."),e)}(n,e)}(n,e);if(null==t)throw new Error(n+" not available on this browser");return t},ge=function(n){return n.dom().nodeName.toLowerCase()},ve=function(n){return function(e){return function(n){return n.dom().nodeType}(e)===n}},pe=ve(fe),he=ve(le),ye=function(n){var e=he(n)?n.dom().parentNode:n.dom();return null!=e&&e.ownerDocument.body.contains(e)},be=U((function(){return we(ae(n.document))})),we=function(n){var e=n.dom().body;if(null==e)throw new Error("Body is not available yet");return ae(e)},xe=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(n.length!==e.length)throw new Error('Wrong number of arguments to struct. Expected "['+n.length+']", got '+e.length+" arguments");var o={};return wn(n,(function(n,t){o[n]=r(e[t])})),o}},Te=function(n){return n.slice(0).sort()},Se=function(n,e){throw new Error("All required keys ("+Te(n).join(", ")+") were not specified. Specified keys were: "+Te(e).join(", ")+".")},Oe=function(n){throw new Error("Unsupported keys for object: "+Te(n).join(", "))},ke=function(n,e){if(!v(e))throw new Error("The "+n+" fields must be an array. Was: "+e+".");wn(e,(function(e){if(!m(e))throw new Error("The value "+e+" in the "+n+" fields was not a string.")}))},Ce=function(n){var e=Te(n);On(e,(function(n,t){return t<e.length-1&&n===e[t+1]})).each((function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+e.join(", ")+"].")}))},Ee=function(n,e){var t=n.concat(e);if(0===t.length)throw new Error("You must specify at least one required or optional field.");return ke("required",n),ke("optional",e),Ce(t),function(o){var i=E(o);In(n,(function(n){return yn(i,n)}))||Se(n,i);var u=xn(i,(function(n){return!yn(t,n)}));u.length>0&&Oe(u);var c={};return wn(n,(function(n){c[n]=r(o[n])})),wn(e,(function(n){c[n]=r(Object.prototype.hasOwnProperty.call(o,n)?C.some(o[n]):C.none())})),c}},Ie=fe,De=se,Me=function(n,e){var t=n.dom();if(t.nodeType!==Ie)return!1;var r=t;if(void 0!==r.matches)return r.matches(e);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(e);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(e);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")},Ae=function(n){return n.nodeType!==Ie&&n.nodeType!==De||0===n.childElementCount},Fe=function(e,t){var r=void 0===t?n.document:t.dom();return Ae(r)?[]:bn(r.querySelectorAll(e),ae)},Re=function(e,t){var r=void 0===t?n.document:t.dom();return Ae(r)?C.none():C.from(r.querySelector(e)).map(ae)},Be=function(n,e){return n.dom()===e.dom()},Ve=(Hn.detect().browser.isIE(),function(n){return ae(n.dom().ownerDocument)}),Ne=function(n){return ae(n.dom().ownerDocument.defaultView)},_e=function(n){return C.from(n.dom().parentNode).map(ae)},je=function(n){return bn(n.dom().childNodes,ae)},He=(xe("element","offset"),function(n,e){(function(n){return function(n,e){var t=n.dom().childNodes;return C.from(t[0]).map(ae)}(n)})(n).fold((function(){ze(n,e)}),(function(t){n.dom().insertBefore(e.dom(),t.dom())}))}),ze=function(n,e){n.dom().appendChild(e.dom())},Le=function(n,e){wn(e,(function(e){ze(n,e)}))},Pe=function(n){n.dom().textContent="",wn(je(n),(function(n){$e(n)}))},$e=function(n){var e=n.dom();null!==e.parentNode&&e.parentNode.removeChild(e)},We=function(n){Zn(n,Qn());var e=n.components();wn(e,We)},Ue=function(n){var e=n.components();wn(e,Ue),Zn(n,Jn())},Ge=function(n,e){qe(n,e,ze)},qe=function(n,e,t){n.getSystem().addToWorld(e),t(n.element(),e.element()),ye(n.element())&&Ue(e),n.syncComponents()},Ye=function(n){We(n),$e(n.element()),n.getSystem().removeFromWorld(n)},Ke=function(n){var e=_e(n.element()).bind((function(e){return n.getSystem().getByDom(e).fold(C.none,C.some)}));Ye(n),e.each((function(n){n.syncComponents()}))},Xe=function(n){return{is:function(e){return n===e},isValue:l,isError:f,getOr:r(n),getOrThunk:r(n),getOrDie:r(n),or:function(e){return Xe(n)},orThunk:function(e){return Xe(n)},fold:function(e,t){return t(n)},map:function(e){return Xe(e(n))},mapError:function(e){return Xe(n)},each:function(e){e(n)},bind:function(e){return e(n)},exists:function(e){return e(n)},forall:function(e){return e(n)},toOption:function(){return C.some(n)}}},Je=function(n){return{is:f,isValue:f,isError:l,getOr:o,getOrThunk:function(n){return n()},getOrDie:function(){return a(String(n))()},or:function(n){return n},orThunk:function(n){return n()},fold:function(e,t){return e(n)},map:function(e){return Je(n)},mapError:function(e){return Je(e(n))},each:e,bind:function(e){return Je(n)},exists:f,forall:l,toOption:C.none}},Qe={value:Xe,error:Je,fromOption:function(n,e){return n.fold((function(){return Je(e)}),Xe)}},Ze=function(e){if(!v(e))throw new Error("cases must be an array");if(0===e.length)throw new Error("there must be at least one case");var t=[],r={};return wn(e,(function(o,i){var u=E(o);if(1!==u.length)throw new Error("one and only one name per case");var c=u[0],a=o[c];if(void 0!==r[c])throw new Error("duplicate key detected:"+c);if("cata"===c)throw new Error("cannot have a case named cata (sorry)");if(!v(a))throw new Error("case arguments must be an array");t.push(c),r[c]=function(){var r=arguments.length;if(r!==a.length)throw new Error("Wrong number of arguments to case "+c+". Expected "+a.length+" ("+a+"), got "+r);for(var o=new Array(r),u=0;u<o.length;u++)o[u]=arguments[u];var s=function(n){var e=E(n);if(t.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+t.join(",")+"\nActual: "+e.join(","));if(!In(t,(function(n){return yn(e,n)})))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+t.join(", "));return n[c].apply(null,o)};return{fold:function(){if(arguments.length!==e.length)throw new Error("Wrong number of arguments to fold. Expected "+e.length+", got "+arguments.length);var n=arguments[i];return n.apply(null,o)},match:s,log:function(e){n.console.log(e,{constructors:t,constructor:c,params:o})}}}})),r},nt=Ze([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),et=function(n){return nt.defaultedThunk(r(n))},tt=function(n){return nt.mergeWithThunk(r(n))},rt=nt.strict,ot=nt.asOption,it=nt.defaultedThunk,ut=nt.mergeWithThunk,ct=(Ze([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(n){var e=[],t=[];return wn(n,(function(n){n.fold((function(n){e.push(n)}),(function(n){t.push(n)}))})),{errors:e,values:t}}),at=function(n){return t(Qe.error,Cn)(n)},st=function(n,e){var t=ct(n);return t.errors.length>0?at(t.errors):function(n,e){return Qe.value(x.apply(void 0,[e].concat(n)))}(t.values,e)},ft=function(n){return function(e){return e.hasOwnProperty(n)?C.from(e[n]):C.none()}},lt=function(n,e){return ft(e)(n)},dt=function(n,e){var t={};return t[n]=e,t},mt=function(n){return ft(n)},gt=function(n,e){return function(n,e){return function(t){return ft(n)(t).getOr(e)}}(n,e)},vt=function(n,e){return lt(n,e)},pt=function(n,e){return dt(n,e)},ht=function(n){return function(n){var e={};return wn(n,(function(n){e[n.key]=n.value})),e}(n)},yt=function(n,e){return st(n,e)},bt=function(n,e){return function(n,e){return n.hasOwnProperty(e)&&void 0!==n[e]&&null!==n[e]}(n,e)},wt=Ze([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),xt=Ze([{field:["name","presence","type"]},{state:["name"]}]),Tt=function(n,e,t){return me("JSON").stringify(n,e,t)},St=function(n){return g(n)&&E(n).length>100?" removed due to size":Tt(n,null,2)},Ot=function(n,e){return Qe.error([{path:n,getErrorInfo:e}])},kt=Ze([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),Ct=function(n,e,t){var r=lt(n,e).fold((function(){return t(n)}),o);return Qe.value(r)},Et=function(n,e,t,o){return t.fold((function(t,i,u,c){var a=function(e){return c.extract(n.concat([t]),o,e).map((function(n){return dt(i,o(n))}))},s=function(e){return e.fold((function(){var n=dt(i,o(C.none()));return Qe.value(n)}),(function(e){return c.extract(n.concat([t]),o,e).map((function(n){return dt(i,o(C.some(n)))}))}))};return u.fold((function(){return function(n,e,t){return lt(e,t).fold((function(){return function(n,e,t){return Ot(n,(function(){return'Could not find valid *strict* value for "'+e+'" in '+St(t)}))}(n,t,e)}),Qe.value)}(n,e,t).bind(a)}),(function(n){return Ct(e,t,n).bind(a)}),(function(){return function(n,e){return Qe.value(lt(n,e))}(e,t).bind(s)}),(function(n){return function(n,e,t){var r=lt(n,e).map((function(e){return!0===e?t(n):e}));return Qe.value(r)}(e,t,n).bind(s)}),(function(n){var o=n(e);return Ct(e,t,r({})).map((function(n){return x(o,n)})).bind(a)}))}),(function(n,t){var r=t(e);return Qe.value(dt(n,o(r)))}))},It=function(n){return{extract:function(e,t,r){return n(r,t).fold((function(n){return function(n,e){return Ot(n,(function(){return e}))}(e,n)}),Qe.value)},toString:function(){return"val"},toDsl:function(){return wt.itemOf(n)}}},Dt=function(n){var e=E(n);return xn(e,(function(e){return bt(n,e)}))},Mt=function(n){var e=At(n),t=Tn(n,(function(n,e){return e.fold((function(e){return x(n,pt(e,!0))}),r(n))}),{});return{extract:function(n,r,o){var i=p(o)?[]:Dt(o),u=xn(i,(function(n){return!bt(t,n)}));return 0===u.length?e.extract(n,r,o):function(n,e){return Ot(n,(function(){return"There are unsupported fields: ["+e.join(", ")+"] specified"}))}(n,u)},toString:e.toString,toDsl:e.toDsl}},At=function(n){return{extract:function(e,t,r){return function(n,e,t,r){var o=bn(t,(function(t){return Et(n,e,t,r)}));return st(o,{})}(e,r,n,t)},toString:function(){return"obj{\n"+bn(n,(function(n){return n.fold((function(n,e,t,r){return n+" -> "+r.toString()}),(function(n,e){return"state("+n+")"}))})).join("\n")+"}"},toDsl:function(){return wt.objOf(bn(n,(function(n){return n.fold((function(n,e,t,r){return xt.field(n,t,r)}),(function(n,e){return xt.state(n)}))})))}}},Ft=function(n,e){var t=function(e,t){return function(n){return{extract:function(e,t,r){var o,i=bn(r,(function(r,o){return n.extract(e.concat(["["+o+"]"]),t,r)}));return(o=ct(i)).errors.length>0?at(o.errors):Qe.value(o.values)},toString:function(){return"array("+n.toString()+")"},toDsl:function(){return wt.arrOf(n)}}}(It(n)).extract(e,o,t)};return{extract:function(n,r,o){var i=E(o);return t(n,i).bind((function(t){var i=bn(t,(function(n){return kt.field(n,n,rt(),e)}));return At(i).extract(n,r,o)}))},toString:function(){return"setOf("+e.toString()+")"},toDsl:function(){return wt.setOf(n,e)}}},Rt=r(It(Qe.value)),Bt=kt.state,Vt=kt.field,Nt=function(n,e){return{extract:function(t,r,o){return vt(o,n).fold((function(){return function(n,e){return Ot(n,(function(){return'Choice schema did not contain choice key: "'+e+'"'}))}(t,n)}),(function(n){return function(n,e,t,r,o){return vt(r,o).fold((function(){return function(n,e,t){return Ot(n,(function(){return'The chosen schema: "'+t+'" did not exist in branches: '+St(e)}))}(n,r,o)}),(function(r){return At(r).extract(n.concat(["branch: "+o]),e,t)}))}(t,r,o,e,n)}))},toString:function(){return"chooseOn("+n+"). Possible values: "+E(e)},toDsl:function(){return wt.choiceOf(n,e)}}},_t=It(Qe.value),jt=function(n,e,t,r){return e.extract([n],t,r).fold((function(n){return Qe.error({input:r,errors:n})}),Qe.value)},Ht=function(n,e,t){return jt(n,e,r,t)},zt=function(n){return n.fold((function(n){throw new Error($t(n))}),o)},Lt=function(n,e,t){return zt(function(n,e,t){return jt(n,e,o,t)}(n,e,t))},Pt=function(n,e,t){return zt(Ht(n,e,t))},$t=function(n){return"Errors: \n"+(t=(e=n.errors).length>10?e.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):e,bn(t,(function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()}))+"\n\nInput object: ")+St(n.input);var e,t},Wt=function(n,e){return Nt(n,e)},Ut=r(_t),Gt=(u=h,"function",It((function(n){var e=typeof n;return u(n)?Qe.value(n):Qe.error("Expected type: function but got: "+e)}))),qt=function(n){return Vt(n,n,rt(),Rt())},Yt=function(n,e){return Vt(n,n,rt(),e)},Kt=function(n){return Yt(n,Gt)},Xt=function(n,e){return Vt(n,n,rt(),At(e))},Jt=function(n){return Vt(n,n,ot(),Rt())},Qt=function(n,e){return Vt(n,n,ot(),At(e))},Zt=function(n,e){return Vt(n,n,ot(),Mt(e))},nr=function(n,e){return Vt(n,n,et(e),Rt())},er=function(n,e,t){return Vt(n,n,et(e),t)},tr=function(n,e){return Bt(n,e)},rr=function(n){if(!bt(n,"can")&&!bt(n,"abort")&&!bt(n,"run"))throw new Error("EventHandler defined by: "+Tt(n,null,2)+" does not have can, abort, or run!");return Lt("Extracting event.handler",Mt([nr("can",r(!0)),nr("abort",r(!1)),nr("run",e)]),n)},or=function(n){return ht(n)},ir=function(n,e){return{key:n,value:rr({abort:e})}},ur=function(n,e){return{key:n,value:rr({run:e})}},cr=function(n,e,t){return{key:n,value:rr({run:function(n){e.apply(void 0,[n].concat(t))}})}},ar=function(n){return function(e){return{key:n,value:rr({run:function(n,t){(function(n,e){return Be(n.element(),e.event().target())})(n,t)&&e(n,t)}})}}},sr=function(n,e,t){return function(n,e){return ur(n,(function(t,r){t.getSystem().getByUid(e).each((function(e){!function(n,e,t,r){n.getSystem().triggerEvent(t,e,r.event())}(e,e.element(),n,r)}))}))}(n,e.partUids()[t])},fr=function(n,e){return ur(n,(function(n,t){var r=t.event();n.getSystem().getByDom(r.target()).each((function(r){e(n,r,t)}))}))},lr=function(n){return ur(n,(function(n,e){e.cut()}))},dr=function(n){return ur(n,(function(n,e){e.stop()}))},mr=ar(Jn()),gr=ar(Qn()),vr=ar(Kn()),pr=function(n){return function(e){return ur(n,e)}}(Wn()),hr=function(n){return bn(n,(function(n){return function(n,e,t){return""===e||!(n.length<e.length)&&n.substr(t,t+e.length)===e}(e=n,"/*",e.length-"/*".length)?n.substring(0,n.length-"/*".length):n;var e}))},yr=function(n,e){var t=n.toString(),r=t.indexOf(")")+1,o=t.indexOf("("),i=t.substring(o+1,r-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:e,parameters:hr(i)}},n},br=Ee(["tag"],["classes","attributes","styles","value","innerHtml","domChildren","defChildren"]),wr=Ee([],["classes","attributes","styles","value","innerHtml","defChildren","domChildren"]),xr=function(n,e,t){return e.fold((function(){return t.fold((function(){return{}}),(function(e){return pt(n,e)}))}),(function(e){return t.fold((function(){return pt(n,e)}),(function(e){return pt(n,e)}))}))},Tr=function(n,e,t){return vr((function(r,o){t(r,n,e)}))},Sr=function(n){return{key:n,value:void 0}},Or=function(n,e,t,o,u,c,a){var s=function(n){return bt(n,t)?n[t]():C.none()},f=D(u,(function(n,e){return function(n,e,t){return function(n,e,t){var r=t.toString(),o=r.indexOf(")")+1,i=r.indexOf("("),u=r.substring(i+1,o-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:e,parameters:hr(u.slice(0,1).concat(u.slice(3)))}},n}((function(o){for(var i=[],u=1;u<arguments.length;u++)i[u-1]=arguments[u];var c=[o].concat(i);return o.config({name:r(n)}).fold((function(){throw new Error("We could not find any behaviour configuration for: "+n+". Using API: "+t)}),(function(n){var t=Array.prototype.slice.call(c,1);return e.apply(void 0,[o,n.config,n.state].concat(t))}))}),t,e)}(t,n,e)})),l=D(c,(function(n,e){return yr(n,e)})),d=x(l,f,{revoke:i(Sr,t),config:function(e){var r=Pt(t+"-config",n,e);return{key:t,value:{config:r,me:d,configAsRaw:U((function(){return Lt(t+"-config",n,e)})),initialConfig:e,state:a}}},schema:function(){return e},exhibit:function(n,e){return s(n).bind((function(n){return vt(o,"exhibit").map((function(t){return t(e,n.config,n.state)}))})).getOr(wr({}))},name:function(){return t},handlers:function(n){return s(n).bind((function(n){return vt(o,"events").map((function(e){return e(n.config,n.state)}))})).getOr({})}});return d},kr=function(n,e){return Cr(n,e,{validate:h,label:"function"})},Cr=function(n,e,t){if(0===e.length)throw new Error("You must specify at least one required field.");return ke("required",e),Ce(e),function(r){var o=E(r);In(e,(function(n){return yn(o,n)}))||Se(e,o),n(e,o);var i=xn(e,(function(n){return!t.validate(r[n],n)}));return i.length>0&&function(n,e){throw new Error("All values need to be of type: "+e+". Keys ("+Te(n).join(", ")+") were not.")}(i,t.label),r}},Er=function(n,e){var t=xn(e,(function(e){return!yn(n,e)}));t.length>0&&Oe(t)},Ir=e,Dr=function(n){return kr(Er,n)},Mr={init:function(){return Ar({readState:function(){return"No State required"}})}},Ar=function(n){return kr(Ir,["readState"])(n),n},Fr=function(n){return ht(n)},Rr=Mt([qt("fields"),qt("name"),nr("active",{}),nr("apis",{}),nr("state",Mr),nr("extra",{})]),Br=function(n){var e=Lt("Creating behaviour: "+n.name,Rr,n);return function(n,e,t,r,o,i){var u=Mt(n),c=Qt(e,[Zt("config",n)]);return Or(u,c,e,t,r,o,i)}(e.fields,e.name,e.active,e.apis,e.extra,e.state)},Vr=Mt([qt("branchKey"),qt("branches"),qt("name"),nr("active",{}),nr("apis",{}),nr("state",Mr),nr("extra",{})]),Nr=r(void 0),_r=function(e,t,r){if(!(m(r)||p(r)||y(r)))throw n.console.error("Invalid call to Attr.set. Key ",t,":: Value ",r,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,r+"")},jr=function(n,e,t){_r(n.dom(),e,t)},Hr=function(n,e){var t=n.dom();I(e,(function(n,e){_r(t,e,n)}))},zr=function(n,e){var t=n.dom().getAttribute(e);return null===t?void 0:t},Lr=function(n,e){var t=n.dom();return!(!t||!t.hasAttribute)&&t.hasAttribute(e)},Pr=function(n,e){n.dom().removeAttribute(e)},$r=function(n,e){var t=zr(n,e);return void 0===t||""===t?[]:t.split(" ")},Wr=function(n){return void 0!==n.dom().classList},Ur=function(n){return $r(n,"class")},Gr=function(n,e){return function(n,e,t){var r=$r(n,e).concat([t]);return jr(n,e,r.join(" ")),!0}(n,"class",e)},qr=function(n,e){return function(n,e,t){var r=xn($r(n,e),(function(n){return n!==t}));return r.length>0?jr(n,e,r.join(" ")):Pr(n,e),!1}(n,"class",e)},Yr=function(n,e){Wr(n)?n.dom().classList.add(e):Gr(n,e)},Kr=function(n,e){Wr(n)?n.dom().classList.remove(e):qr(n,e),function(n){0===(Wr(n)?n.dom().classList:Ur(n)).length&&Pr(n,"class")}(n)},Xr=function(n,e){return Wr(n)&&n.dom().classList.contains(e)},Jr=function(n,e,t){Kr(n,t),Yr(n,e)},Qr=Object.freeze({toAlpha:function(n,e,t){Jr(n.element(),e.alpha(),e.omega())},toOmega:function(n,e,t){Jr(n.element(),e.omega(),e.alpha())},isAlpha:function(n,e,t){return Xr(n.element(),e.alpha())},isOmega:function(n,e,t){return Xr(n.element(),e.omega())},clear:function(n,e,t){Kr(n.element(),e.alpha()),Kr(n.element(),e.omega())}}),Zr=[qt("alpha"),qt("omega")],no=Br({fields:Zr,name:"swapping",apis:Qr}),eo=function(n){var e=n,t=function(){return e};return{get:t,set:function(n){e=n},clone:function(){return eo(t())}}};function to(n,e,t,r,o){return n(t,r)?C.some(t):h(o)&&o(t)?C.none():e(t,r,o)}var ro=function(n,e,t){for(var o=n.dom(),i=h(t)?t:r(!1);o.parentNode;){o=o.parentNode;var u=ae(o);if(e(u))return C.some(u);if(i(u))break}return C.none()},oo=function(n,e,t){return to((function(n,e){return e(n)}),ro,n,e,t)},io=function(n){n.dom().focus()},uo=function(n){n.dom().blur()},co=function(e){var t=void 0!==e?e.dom():n.document;return C.from(t.activeElement).map(ae)},ao=function(n){return co(Ve(n)).filter((function(e){return n.dom().contains(e.dom())}))},so=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),fo=tinymce.util.Tools.resolve("tinymce.ThemeManager"),lo={formatChanged:r("formatChanged"),orientationChanged:r("orientationChanged"),dropupDismissed:r("dropupDismissed")},mo=function(n){return n.dom().innerHTML},go=function(e,t){var r,o,i=Ve(e).dom(),u=ae(i.createDocumentFragment()),c=(r=t,(o=(i||n.document).createElement("div")).innerHTML=r,je(ae(o)));Le(u,c),Pe(e),ze(e,u)},vo=function(n){return function(n){var e=ue("div"),t=ae(n.dom().cloneNode(!0));return ze(e,t),mo(e)}(function(n){return function(n,e){return ae(n.dom().cloneNode(!1))}(n)}(n))},po=function(n){return vo(n)},ho=Object.freeze({events:function(n){return or([ur($n(),(function(e,t){var r=n.channels(),o=function(n,e){return e.universal()?n:xn(n,(function(n){return yn(e.channels(),n)}))}(E(r),t);wn(o,(function(n){var o=r[n](),i=o.schema(),u=Pt("channel["+n+"] data\nReceiver: "+po(e.element()),i,t.data());o.onReceive()(e,u)}))}))])}}),yo=function(n){for(var e=[],t=function(n){e.push(n)},r=0;r<n.length;r++)n[r].each(t);return e},bo=[],wo=["alloy/data/Fields","alloy/debugging/Debugging"],xo={logEventCut:e,logEventStopped:e,logNoParent:e,logEventNoHandlers:e,logEventResponse:e,write:e},To=function(e,t,r){var o,i="*"===bo||yn(bo,e)?(o=[],{logEventCut:function(n,e,t){o.push({outcome:"cut",target:e,purpose:t})},logEventStopped:function(n,e,t){o.push({outcome:"stopped",target:e,purpose:t})},logNoParent:function(n,e,t){o.push({outcome:"no-parent",target:e,purpose:t})},logEventNoHandlers:function(n,e){o.push({outcome:"no-handlers-left",target:e})},logEventResponse:function(n,e,t){o.push({outcome:"response",purpose:t,target:e})},write:function(){yn(["mousemove","mouseover","mouseout",Kn()],e)||n.console.log(e,{event:e,target:t.dom(),sequence:bn(o,(function(n){return yn(["cut","stopped","response"],n.outcome)?"{"+n.purpose+"} "+n.outcome+" at ("+po(n.target)+")":n.outcome}))})}}):xo,u=r(i);return i.write(),u},So=r([qt("menu"),qt("selectedMenu")]),Oo=r([qt("item"),qt("selectedItem")]),ko=(r(Mt(Oo().concat(So()))),r(Mt(Oo()))),Co=Xt("initSize",[qt("numColumns"),qt("numRows")]),Eo=function(n,e,t){return function(){var n=new Error;if(void 0!==n.stack){var e=n.stack.split("\n");On(e,(function(n){return n.indexOf("alloy")>0&&!function(e,t){for(var r=0,o=e.length;r<o;r++)if(i=e[r],n.indexOf(i)>-1)return!0;var i;return!1}(wo)})).getOr("unknown")}}(),Vt(e,e,t,It((function(n){return e=n,Qe.value((function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return e.apply(void 0,n)}));var e})))},Io=function(n){return Eo(0,n,et(e))},Do=function(n){return Eo(0,n,et(C.none))},Mo=function(n){return Eo(0,n,rt())},Ao=function(n){return Eo(0,n,rt())},Fo=function(n,e){return tr(n,r(e))},Ro=function(n){return tr(n,o)},Bo=r(Co),Vo=[Yt("channels",Ft(Qe.value,Mt([Mo("onReceive"),nr("schema",Ut())])))],No=Br({fields:Vo,name:"receiving",active:ho}),_o=function(n,e){var t=Lo(n,e),r=e.aria();r.update()(n,r,t)},jo=function(n,e,t){(function(n,e){Wr(n)?n.dom().classList.toggle(e):function(n,e){yn(Ur(n),e)?qr(n,e):Gr(n,e)}(n,e)})(n.element(),e.toggleClass()),_o(n,e)},Ho=function(n,e,t){Yr(n.element(),e.toggleClass()),_o(n,e)},zo=function(n,e,t){Kr(n.element(),e.toggleClass()),_o(n,e)},Lo=function(n,e){return Xr(n.element(),e.toggleClass())},Po=function(n,e,t){(e.selected()?Ho:zo)(n,e,t)},$o=Object.freeze({onLoad:Po,toggle:jo,isOn:Lo,on:Ho,off:zo}),Wo=Object.freeze({exhibit:function(n,e,t){return wr({})},events:function(n,e){var t,r,o,i=(t=n,r=e,o=jo,pr((function(n){o(n,t,r)}))),u=Tr(n,e,Po);return or(Cn([n.toggleOnExecute()?[i]:[],[u]]))}}),Uo=function(n,e,t){jr(n.element(),"aria-expanded",t)},Go=[nr("selected",!1),qt("toggleClass"),nr("toggleOnExecute",!0),er("aria",{mode:"none"},Wt("mode",{pressed:[nr("syncWithExpanded",!1),Fo("update",(function(n,e,t){jr(n.element(),"aria-pressed",t),e.syncWithExpanded()&&Uo(n,0,t)}))],checked:[Fo("update",(function(n,e,t){jr(n.element(),"aria-checked",t)}))],expanded:[Fo("update",Uo)],selected:[Fo("update",(function(n,e,t){jr(n.element(),"aria-selected",t)}))],none:[Fo("update",e)]}))],qo=Br({fields:Go,name:"toggling",active:Wo,apis:$o}),Yo=function(n,e){return No.config({channels:pt(lo.formatChanged(),{onReceive:function(t,r){r.command===n&&e(t,r.state)}})})},Ko=function(n){return No.config({channels:pt(lo.orientationChanged(),{onReceive:n})})},Xo=function(n,e){return{key:n,value:{onReceive:e}}},Jo="tinymce-mobile",Qo={resolve:function(n){return Jo+"-"+n},prefix:r(Jo)},Zo=function(n,e){e.ignore()||(io(n.element()),e.onFocus()(n))},ni=Object.freeze({focus:Zo,blur:function(n,e){e.ignore()||uo(n.element())},isFocused:function(n){return function(n){var e=Ve(n).dom();return n.dom()===e.activeElement}(n.element())}}),ei=Object.freeze({exhibit:function(n,e){return e.ignore()?wr({}):wr({attributes:{tabindex:"-1"}})},events:function(n){return or([ur(Ln(),(function(e,t){Zo(e,n),t.stop()}))])}}),ti=[Io("onFocus"),nr("ignore",!1)],ri=Br({fields:ti,name:"focusing",active:ei,apis:ni}),oi=function(n){return void 0!==n.style&&h(n.style.getPropertyValue)},ii=function(e,t,r){if(!m(r))throw n.console.error("Invalid call to CSS.set. Property ",t,":: Value ",r,":: Element ",e),new Error("CSS value must be a string: "+r);oi(e)&&e.style.setProperty(t,r)},ui=function(n,e,t){var r=n.dom();ii(r,e,t)},ci=function(n,e){var t=n.dom();I(e,(function(n,e){ii(t,e,n)}))},ai=function(e,t){var r=e.dom(),o=n.window.getComputedStyle(r).getPropertyValue(t),i=""!==o||ye(e)?o:si(r,t);return null===i?void 0:i},si=function(n,e){return oi(n)?n.style.getPropertyValue(e):""},fi=function(n,e){var t=n.dom(),r=si(t,e);return C.from(r).filter((function(n){return n.length>0}))},li=function(n,e){!function(n,e){oi(n)&&n.style.removeProperty(e)}(n.dom(),e),Lr(n,"style")&&""===zr(n,"style").replace(/^\s+|\s+$/g,"")&&Pr(n,"style")},di=function(n){return n.dom().offsetWidth};function mi(n,e){var t=function(t){var r=e(t);if(r<=0||null===r){var o=ai(t,n);return parseFloat(o)||0}return r},r=function(n,e){return Sn(e,(function(e,t){var r=ai(n,t),o=void 0===r?0:parseInt(r,10);return isNaN(o)?e:e+o}),0)};return{set:function(e,t){if(!y(t)&&!t.match(/^[0-9]+$/))throw new Error(n+".set accepts only positive integer values. Value was "+t);var r=e.dom();oi(r)&&(r.style[n]=t+"px")},get:t,getOuter:t,aggregate:r,max:function(n,e,t){var o=r(n,t);return e>o?e-o:0}}}var gi=mi("height",(function(n){var e=n.dom();return ye(n)?e.getBoundingClientRect().height:e.offsetHeight})),vi=function(n){return gi.get(n)},pi=function(n,e,t){return function(n,e,t){return xn(function(n,e){for(var t=h(e)?e:f,r=n.dom(),o=[];null!==r.parentNode&&void 0!==r.parentNode;){var i=r.parentNode,u=ae(i);if(o.push(u),!0===t(u))break;r=i}return o}(n,t),e)}(n,(function(n){return Me(n,e)}),t)},hi=function(n,e){return Fe(e,n)},yi=function(n){return Re(n)},bi=function(n,e,t){return ro(n,(function(n){return Me(n,e)}),t)},wi=function(n,e){return Re(e,n)},xi=function(n,e,t){return to(Me,bi,n,e,t)},Ti=function(n,e,t){var r=Dn(n.slice(0,e)),o=Dn(n.slice(e+1));return On(r.concat(o),t)},Si=function(n,e,t){var r=Dn(n.slice(0,e));return On(r,t)},Oi=function(n,e,t){var r=n.slice(0,e),o=n.slice(e+1);return On(o.concat(r),t)},ki=function(n,e,t){var r=n.slice(e+1);return On(r,t)},Ci=function(n){return function(e){var t=e.raw();return yn(n,t.which)}},Ei=function(n){return function(e){return In(n,(function(n){return n(e)}))}},Ii=function(n){return!0===n.raw().shiftKey},Di=function(n){return!0===n.raw().ctrlKey},Mi=c(Ii),Ai=function(n,e){return{matches:n,classification:e}},Fi=function(n,e,t,r){var o=n+e;return o>r?t:o<t?r:o},Ri=function(n,e,t){return n<=e?e:n>=t?t:n},Bi=function(n,e,t){var r=hi(n.element(),"."+e.highlightClass());wn(r,(function(t){Kr(t,e.highlightClass()),n.getSystem().getByDom(t).each((function(t){e.onDehighlight()(n,t)}))}))},Vi=function(n,e,t,r){var o=Ni(n,e,t,r);Bi(n,e),Yr(r.element(),e.highlightClass()),o||e.onHighlight()(n,r)},Ni=function(n,e,t,r){return Xr(r.element(),e.highlightClass())},_i=function(n,e,t){return wi(n.element(),"."+e.itemClass()).bind((function(e){return n.getSystem().getByDom(e).toOption()}))},ji=function(n,e,t){var r=hi(n.element(),"."+e.itemClass());return(r.length>0?C.some(r[r.length-1]):C.none()).bind((function(e){return n.getSystem().getByDom(e).toOption()}))},Hi=function(n,e,t,r){var o=hi(n.element(),"."+e.itemClass());return kn(o,(function(n){return Xr(n,e.highlightClass())})).bind((function(e){var t=Fi(e,r,0,o.length-1);return n.getSystem().getByDom(o[t]).toOption()}))},zi=Object.freeze({dehighlightAll:Bi,dehighlight:function(n,e,t,r){var o=Ni(n,e,t,r);Kr(r.element(),e.highlightClass()),o&&e.onDehighlight()(n,r)},highlight:Vi,highlightFirst:function(n,e,t){_i(n,e).each((function(r){Vi(n,e,t,r)}))},highlightLast:function(n,e,t){ji(n,e).each((function(r){Vi(n,e,t,r)}))},highlightAt:function(n,e,t,r){(function(n,e,t,r){var o=hi(n.element(),"."+e.itemClass());return C.from(o[r]).fold((function(){return Qe.error("No element found with index "+r)}),n.getSystem().getByDom)})(n,e,0,r).fold((function(n){throw new Error(n)}),(function(r){Vi(n,e,t,r)}))},highlightBy:function(n,e,t,r){var o=hi(n.element(),"."+e.itemClass()),i=yo(bn(o,(function(e){return n.getSystem().getByDom(e).toOption()})));On(i,r).each((function(r){Vi(n,e,t,r)}))},isHighlighted:Ni,getHighlighted:function(n,e,t){return wi(n.element(),"."+e.highlightClass()).bind((function(e){return n.getSystem().getByDom(e).toOption()}))},getFirst:_i,getLast:ji,getPrevious:function(n,e,t){return Hi(n,e,0,-1)},getNext:function(n,e,t){return Hi(n,e,0,1)}}),Li=[qt("highlightClass"),qt("itemClass"),Io("onHighlight"),Io("onDehighlight")],Pi=Br({fields:Li,name:"highlighting",apis:zi}),$i=function(){return{get:function(n){return ao(n.element())},set:function(n,e){n.getSystem().triggerFocus(e,n.element())}}},Wi=function(n,e,t,r,o,i){var u=function(n,e,r,o){var i,u;return(i=t(n,e,r,o),u=e.event(),On(i,(function(n){return n.matches(u)})).map((function(n){return n.classification}))).bind((function(t){return t(n,e,r,o)}))},c={schema:function(){return n.concat([nr("focusManager",$i()),Fo("handler",c),Fo("state",e)])},processKey:u,toEvents:function(n,e){var t=r(n,e),o=or(i.map((function(t){return ur(Ln(),(function(r,o){t(r,n,e,o),o.stop()}))})).toArray().concat([ur(H(),(function(t,r){u(t,r,n,e).each((function(n){r.stop()}))}))]));return x(t,o)},toApis:o};return c},Ui=function(n){var e=[Jt("onEscape"),Jt("onEnter"),nr("selector",'[data-alloy-tabstop="true"]'),nr("firstTabstop",0),nr("useTabstopAt",r(!0)),Jt("visibilitySelector")].concat([n]),t=function(n,e){var t=n.visibilitySelector().bind((function(n){return xi(e,n)})).getOr(e);return vi(t)>0},o=function(n,e,r,o){var u=hi(n.element(),r.selector());return function(n,e){return e.focusManager().get(n).bind((function(n){return xi(n,e.selector())}))}(n,r).bind((function(e){return kn(u,i(Be,e)).bind((function(e){return function(n,e,r,o,i){return i(e,r,(function(n){return function(n,e){return t(n,e)&&n.useTabstopAt()(e)}(o,n)})).fold((function(){return o.cyclic()?C.some(!0):C.none()}),(function(e){return o.focusManager().set(n,e),C.some(!0)}))}(n,u,e,r,o)}))}))},u=r([Ai(Ei([Ii,Ci([9])]),(function(n,e,t,r){var i=t.cyclic()?Ti:Si;return o(n,0,t,i)})),Ai(Ci([9]),(function(n,e,t,r){var i=t.cyclic()?Oi:ki;return o(n,0,t,i)})),Ai(Ci([27]),(function(n,e,t,r){return t.onEscape().bind((function(t){return t(n,e)}))})),Ai(Ei([Mi,Ci([13])]),(function(n,e,t,r){return t.onEnter().bind((function(t){return t(n,e)}))}))]),c=r({}),a=r({});return Wi(e,Mr.init,u,c,a,C.some((function(n,e){(function(n,e){var r=hi(n.element(),e.selector()),o=xn(r,(function(n){return t(e,n)}));return C.from(o[e.firstTabstop()])})(n,e).each((function(t){e.focusManager().set(n,t)}))})))},Gi=Ui(tr("cyclic",r(!1))),qi=Ui(tr("cyclic",r(!0))),Yi=function(n){return"input"===ge(n)&&"radio"!==zr(n,"type")||"textarea"===ge(n)},Ki=function(n,e,t){return Yi(t)&&Ci([32])(e.event())?C.none():function(n,e,t){return te(n,t,Wn()),C.some(!0)}(n,0,t)},Xi=[nr("execute",Ki),nr("useSpace",!1),nr("useEnter",!0),nr("useControlEnter",!1),nr("useDown",!1)],Ji=function(n,e,t){return t.execute()(n,e,n.element())},Qi=r({}),Zi=r({}),nu=Wi(Xi,Mr.init,(function(n,e,t,r){var o=t.useSpace()&&!Yi(n.element())?[32]:[],i=t.useEnter()?[13]:[],u=t.useDown()?[40]:[],c=o.concat(i).concat(u);return[Ai(Ci(c),Ji)].concat(t.useControlEnter()?[Ai(Ei([Di,Ci([13])]),Ji)]:[])}),Qi,Zi,C.none()),eu=function(n){var e=eo(C.none());return Ar({readState:r({}),setGridSize:function(n,t){e.set(C.some({numRows:r(n),numColumns:r(t)}))},getNumRows:function(){return e.get().map((function(n){return n.numRows()}))},getNumColumns:function(){return e.get().map((function(n){return n.numColumns()}))}})},tu=Object.freeze({flatgrid:eu,init:function(n){return n.state()(n)}}),ru=function(n,e){return function(t){return"rtl"===ou(t)?e:n}},ou=function(n){return"rtl"===ai(n,"direction")?"rtl":"ltr"},iu=function(n){return function(e,t,r,o){var i=n(e.element());return su(i,e,t,r,o)}},uu=function(n,e){var t=ru(n,e);return iu(t)},cu=function(n,e){var t=ru(e,n);return iu(t)},au=function(n){return function(e,t,r,o){return su(n,e,t,r,o)}},su=function(n,e,t,r,o){return r.focusManager().get(e).bind((function(t){return n(e.element(),t,r,o)})).map((function(n){return r.focusManager().set(e,n),!0}))},fu=au,lu=au,du=au,mu=function(n){return!function(n){return n.offsetWidth<=0&&n.offsetHeight<=0}(n.dom())},gu=Ee(["index","candidates"],[]),vu=function(n,e,t){return pu(n,e,t)},pu=function(n,e,t,r){var o=i(Be,e),u=hi(n,t);return function(n,e){return kn(n,e).map((function(e){return gu({index:e,candidates:n})}))}(xn(u,mu),o)},hu=function(n,e){return kn(n,(function(n){return Be(e,n)}))},yu=function(n,e,t,r){return r(Math.floor(e/t),e%t).bind((function(e){var r=e.row()*t+e.column();return r>=0&&r<n.length?C.some(n[r]):C.none()}))},bu=function(n,e,t,o,i){return yu(n,e,o,(function(e,u){var c=e===t-1?n.length-e*o:o,a=Fi(u,i,0,c-1);return C.some({row:r(e),column:r(a)})}))},wu=function(n,e,t,o,i){return yu(n,e,o,(function(e,u){var c=Fi(e,i,0,t-1),a=c===t-1?n.length-c*o:o,s=Ri(u,0,a-1);return C.some({row:r(c),column:r(s)})}))},xu=[qt("selector"),nr("execute",Ki),Do("onEscape"),nr("captureTab",!1),Bo()],Tu=function(n){return function(e,t,r,o){return vu(e,t,r.selector()).bind((function(e){return n(e.candidates(),e.index(),o.getNumRows().getOr(r.initSize().numRows()),o.getNumColumns().getOr(r.initSize().numColumns()))}))}},Su=function(n,e,t,r){return t.captureTab()?C.some(!0):C.none()},Ou=Tu((function(n,e,t,r){return bu(n,e,t,r,-1)})),ku=Tu((function(n,e,t,r){return bu(n,e,t,r,1)})),Cu=Tu((function(n,e,t,r){return wu(n,e,t,r,-1)})),Eu=Tu((function(n,e,t,r){return wu(n,e,t,r,1)})),Iu=r([Ai(Ci([37]),uu(Ou,ku)),Ai(Ci([39]),cu(Ou,ku)),Ai(Ci([38]),fu(Cu)),Ai(Ci([40]),lu(Eu)),Ai(Ei([Ii,Ci([9])]),Su),Ai(Ei([Mi,Ci([9])]),Su),Ai(Ci([27]),(function(n,e,t,r){return t.onEscape()(n,e)})),Ai(Ci([32].concat([13])),(function(n,e,t,r){return function(n,e){return e.focusManager().get(n).bind((function(n){return xi(n,e.selector())}))}(n,t).bind((function(r){return t.execute()(n,e,r)}))}))]),Du=r({}),Mu=Wi(xu,eu,Iu,Du,{},C.some((function(n,e,t){wi(n.element(),e.selector()).each((function(t){e.focusManager().set(n,t)}))}))),Au=function(n,e,t,r){return vu(n,t,e).bind((function(n){var e=n.index(),t=n.candidates(),o=Fi(e,r,0,t.length-1);return C.from(t[o])}))},Fu=[qt("selector"),nr("getInitial",C.none),nr("execute",Ki),nr("executeOnMove",!1),nr("allowVertical",!0)],Ru=function(n,e,t){return function(n,e){return e.focusManager().get(n).bind((function(n){return xi(n,e.selector())}))}(n,t).bind((function(r){return t.execute()(n,e,r)}))},Bu=function(n,e,t){return Au(n,t.selector(),e,-1)},Vu=function(n,e,t){return Au(n,t.selector(),e,1)},Nu=function(n){return function(e,t,r){return n(e,t,r).bind((function(){return r.executeOnMove()?Ru(e,t,r):C.some(!0)}))}},_u=r({}),ju=r({}),Hu=Wi(Fu,Mr.init,(function(n,e,t,r){var o=[37].concat(t.allowVertical()?[38]:[]),i=[39].concat(t.allowVertical()?[40]:[]);return[Ai(Ci(o),Nu(uu(Bu,Vu))),Ai(Ci(i),Nu(cu(Bu,Vu))),Ai(Ci([13]),Ru),Ai(Ci([32]),Ru)]}),_u,ju,C.some((function(n,e){e.getInitial()(n).or(wi(n.element(),e.selector())).each((function(t){e.focusManager().set(n,t)}))}))),zu=Ee(["rowIndex","columnIndex","cell"],[]),Lu=function(n,e,t){return C.from(n[e]).bind((function(n){return C.from(n[t]).map((function(n){return zu({rowIndex:e,columnIndex:t,cell:n})}))}))},Pu=function(n,e,t,r){var o=n[e].length,i=Fi(t,r,0,o-1);return Lu(n,e,i)},$u=function(n,e,t,r){var o=Fi(t,r,0,n.length-1),i=n[o].length,u=Ri(e,0,i-1);return Lu(n,o,u)},Wu=function(n,e,t,r){var o=n[e].length,i=Ri(t+r,0,o-1);return Lu(n,e,i)},Uu=function(n,e,t,r){var o=Ri(t+r,0,n.length-1),i=n[o].length,u=Ri(e,0,i-1);return Lu(n,o,u)},Gu=[Xt("selectors",[qt("row"),qt("cell")]),nr("cycles",!0),nr("previousSelector",C.none),nr("execute",Ki)],qu=function(n,e){return function(t,r,o){var i=o.cycles()?n:e;return xi(r,o.selectors().row()).bind((function(n){var e=hi(n,o.selectors().cell());return hu(e,r).bind((function(e){var r=hi(t,o.selectors().row());return hu(r,n).bind((function(n){var t=function(n,e){return bn(n,(function(n){return hi(n,e.selectors().cell())}))}(r,o);return i(t,n,e).map((function(n){return n.cell()}))}))}))}))}},Yu=qu((function(n,e,t){return Pu(n,e,t,-1)}),(function(n,e,t){return Wu(n,e,t,-1)})),Ku=qu((function(n,e,t){return Pu(n,e,t,1)}),(function(n,e,t){return Wu(n,e,t,1)})),Xu=qu((function(n,e,t){return $u(n,t,e,-1)}),(function(n,e,t){return Uu(n,t,e,-1)})),Ju=qu((function(n,e,t){return $u(n,t,e,1)}),(function(n,e,t){return Uu(n,t,e,1)})),Qu=r([Ai(Ci([37]),uu(Yu,Ku)),Ai(Ci([39]),cu(Yu,Ku)),Ai(Ci([38]),fu(Xu)),Ai(Ci([40]),lu(Ju)),Ai(Ci([32].concat([13])),(function(n,e,t){return ao(n.element()).bind((function(r){return t.execute()(n,e,r)}))}))]),Zu=r({}),nc=r({}),ec=Wi(Gu,Mr.init,Qu,Zu,nc,C.some((function(n,e){e.previousSelector()(n).orThunk((function(){var t=e.selectors();return wi(n.element(),t.cell())})).each((function(t){e.focusManager().set(n,t)}))}))),tc=[qt("selector"),nr("execute",Ki),nr("moveOnTab",!1)],rc=function(n,e,t){return t.focusManager().get(n).bind((function(r){return t.execute()(n,e,r)}))},oc=function(n,e,t){return Au(n,t.selector(),e,-1)},ic=function(n,e,t){return Au(n,t.selector(),e,1)},uc=r([Ai(Ci([38]),du(oc)),Ai(Ci([40]),du(ic)),Ai(Ei([Ii,Ci([9])]),(function(n,e,t){return t.moveOnTab()?du(oc)(n,e,t):C.none()})),Ai(Ei([Mi,Ci([9])]),(function(n,e,t){return t.moveOnTab()?du(ic)(n,e,t):C.none()})),Ai(Ci([13]),rc),Ai(Ci([32]),rc)]),cc=r({}),ac=r({}),sc=Wi(tc,Mr.init,uc,cc,ac,C.some((function(n,e){wi(n.element(),e.selector()).each((function(t){e.focusManager().set(n,t)}))}))),fc=[Do("onSpace"),Do("onEnter"),Do("onShiftEnter"),Do("onLeft"),Do("onRight"),Do("onTab"),Do("onShiftTab"),Do("onUp"),Do("onDown"),Do("onEscape"),Jt("focusIn")],lc=Wi(fc,Mr.init,(function(n,e,t){return[Ai(Ci([32]),t.onSpace()),Ai(Ei([Mi,Ci([13])]),t.onEnter()),Ai(Ei([Ii,Ci([13])]),t.onShiftEnter()),Ai(Ei([Ii,Ci([9])]),t.onShiftTab()),Ai(Ei([Mi,Ci([9])]),t.onTab()),Ai(Ci([38]),t.onUp()),Ai(Ci([40]),t.onDown()),Ai(Ci([37]),t.onLeft()),Ai(Ci([39]),t.onRight()),Ai(Ci([32]),t.onSpace()),Ai(Ci([27]),t.onEscape())]}),(function(){return{}}),(function(){return{}}),C.some((function(n,e){return e.focusIn().bind((function(t){return t(n,e)}))}))),dc=Gi.schema(),mc=qi.schema(),gc=Hu.schema(),vc=Mu.schema(),pc=ec.schema(),hc=nu.schema(),yc=sc.schema(),bc=lc.schema(),wc=function(n){var e=Lt("Creating behaviour: "+n.name,Vr,n);return function(n,e,t,r,o,i){var u,c,a=n,s=Qt(e,[(u="config",c=n,Vt(u,u,ot(),c))]);return Or(a,s,e,t,r,o,i)}(Wt(e.branchKey,e.branches),e.name,e.active,e.apis,e.extra,e.state)}({branchKey:"mode",branches:Object.freeze({acyclic:dc,cyclic:mc,flow:gc,flatgrid:vc,matrix:pc,execution:hc,menu:yc,special:bc}),name:"keying",active:{events:function(n,e){return n.handler().toEvents(n,e)}},apis:{focusIn:function(n){n.getSystem().triggerFocus(n.element(),n.element())},setGridSize:function(e,t,r,o,i){bt(r,"setGridSize")?r.setGridSize(o,i):n.console.error("Layout does not support setGridSize")}},state:tu}),xc=function(n,e){return t=n,r={},i=bn(e,(function(e){return t=e.name(),r="Cannot configure "+e.name()+" for "+n,Vt(t,t,ot(),It((function(n){return Qe.error("The field: "+t+" is forbidden. "+r)})));var t,r})).concat([tr("dump",o)]),Vt(t,t,et(r),At(i));var t,r,i},Tc=function(n){return n.dump()},Sc="placeholder",Oc=Ze([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),kc=function(n,e,t,o){return function(n,e,t,o){return t.uiType===Sc?function(n,e,t,o){return n.exists((function(n){return n!==t.owner}))?Oc.single(!0,r(t)):vt(o,t.name).fold((function(){throw new Error("Unknown placeholder component: "+t.name+"\nKnown: ["+E(o)+"]\nNamespace: "+n.getOr("none")+"\nSpec: "+Tt(t,null,2))}),(function(n){return n.replace()}))}(n,0,t,o):Oc.single(!1,r(t))}(n,0,t,o).fold((function(r,i){var u=i(e,t.config,t.validated),c=vt(u,"components").getOr([]),a=En(c,(function(t){return kc(n,e,t,o)}));return[x(u,{components:a})]}),(function(n,r){return r(e,t.config,t.validated)}))},Cc=Oc.single,Ec=Oc.multiple,Ic=r(Sc),Dc=0,Mc=function(n){var e=(new Date).getTime();return n+"_"+Math.floor(1e9*Math.random())+ ++Dc+String(e)},Ac=Ze([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),Fc=nr("factory",{sketch:o}),Rc=nr("schema",[]),Bc=qt("name"),Vc=Vt("pname","pname",it((function(n){return"<alloy."+Mc(n.name)+">"})),Ut()),Nc=nr("defaults",r({})),_c=nr("overrides",r({})),jc=At([Fc,Rc,Bc,Vc,Nc,_c]),Hc=At([Fc,Rc,Bc,Vc,Nc,_c]),zc=At([Fc,Rc,Bc,qt("unit"),Vc,Nc,_c]),Lc=function(n){var e=function(n){return n.name()};return n.fold(e,e,e,e)},Pc=function(n,e){return function(t){var r=Pt("Converting part type",e,t);return n(r)}},$c=Pc(Ac.required,jc),Wc=Pc(Ac.optional,Hc),Uc=Pc(Ac.group,zc),Gc=r("entirety"),qc=function(n,e,t,r){var o=t;return x(e.defaults()(n,t,r),t,{uid:n.partUids()[e.name()]},e.overrides()(n,t,r),{"debug.sketcher":pt("part-"+e.name(),o)})},Yc=function(n,e){return{uiType:Ic(),owner:n,name:e}},Kc=function(n,e,t){return function(n,e,t){var o={},i={};return wn(t,(function(n){n.fold((function(n){o[n.pname()]=Cc(!0,(function(e,t,r){return n.factory().sketch(qc(e,n,t,r))}))}),(function(n){var t=e.parts()[n.name()]();i[n.name()]=r(qc(e,n,t[Gc()]()))}),(function(n){o[n.pname()]=Cc(!1,(function(e,t,r){return n.factory().sketch(qc(e,n,t,r))}))}),(function(n){o[n.pname()]=Ec(!0,(function(e,t,r){var o=e[n.name()]();return bn(o,(function(t){return n.factory().sketch(x(n.defaults()(e,t),t,n.overrides()(e,t)))}))}))}))})),{internals:r(o),externals:r(i)}}(0,e,t)},Xc=function(n,e,t){return function(n,e,t,o){var i=D(o,(function(n,e){return o=n,i=!1,{name:r(t=e),required:function(){return o.fold((function(n,e){return n}),(function(n,e){return n}))},used:function(){return i},replace:function(){if(!0===i)throw new Error("Trying to use the same placeholder more than once: "+t);return i=!0,o}};var t,o,i})),u=function(n,e,t,r){return En(t,(function(t){return kc(n,e,t,r)}))}(n,e,t,i);return I(i,(function(t){if(!1===t.used()&&t.required())throw new Error("Placeholder: "+t.name()+" was not found in components list\nNamespace: "+n.getOr("none")+"\nComponents: "+Tt(e.components(),null,2))})),u}(C.some(n),e,e.components(),t)},Jc=function(n,e,t){var r=e.partUids()[t];return n.getSystem().getByUid(r).toOption()},Qc=function(n,e,t){return Jc(n,e,t).getOrDie("Could not find part: "+t)},Zc=function(n){return Vt("partUids","partUids",ut((function(e){return function(n,e){var t=function(n){return bn(n,Lc)}(e);return ht(bn(t,(function(e){return{key:e,value:n+"-"+e}})))}(e.uid,n)})),Ut())},na=Mc("alloy-premade"),ea=Mc("api"),ta=function(n){return pt(na,n)},ra=function(n){return function(n,e){var t=e.toString(),r=t.indexOf(")")+1,o=t.indexOf("("),i=t.substring(o+1,r-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:hr(i.slice(1))}},n}((function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=e.config(ea);return n.apply(void 0,[o].concat([e].concat(t)))}),n)},oa=r(ea),ia=r("alloy-id-"),ua=r("data-alloy-id"),ca=ia(),aa=ua(),sa=function(n){var e=pe(n)?zr(n,aa):null;return C.from(e)},fa=function(n){return Mc(n)},la=function(n,e,t,r,o){var i=function(n,e,t,r){return(e.length>0?[Xt("parts",e)]:[]).concat([qt("uid"),nr("dom",{}),nr("components",[]),Ro("originalSpec"),nr("debug.sketcher",{})]).concat(t)}(0,r,o);return Pt(n+" [SpecSchema]",Mt(i.concat(e)),t)},da=function(n,e,t,r,o){var i=ma(o),u=function(n){return En(n,(function(n){return n.fold(C.none,C.some,C.none,C.none).map((function(n){return Xt(n.name(),n.schema().concat([Ro(Gc())]))})).toArray()}))}(t),c=Zc(t),a=la(n,e,i,u,[c]),s=Kc(0,a,t),f=Xc(n,a,s.internals());return x(r(a,f,i,s.externals()),{"debug.sketcher":pt(n,o)})},ma=function(n){return x({uid:fa("uid")},n)},ga=Mt([qt("name"),qt("factory"),qt("configFields"),nr("apis",{}),nr("extraApis",{})]),va=Mt([qt("name"),qt("factory"),qt("configFields"),qt("partFields"),nr("apis",{}),nr("extraApis",{})]),pa=function(n){var e=Lt("Sketcher for "+n.name,ga,n),t=D(e.apis,ra),o=D(e.extraApis,(function(n,e){return yr(n,e)}));return x({name:r(e.name),partFields:r([]),configFields:r(e.configFields),sketch:function(n){return function(n,e,t,r){var o=ma(r),i=la(n,e,o,[],[]);return x(t(i,o),{"debug.sketcher":pt(n,r)})}(e.name,e.configFields,e.factory,n)}},t,o)},ha=function(n){var e=Lt("Sketcher for "+n.name,va,n),t=function(n,e){var t={};return wn(e,(function(e){(function(n){return n.fold(C.some,C.none,C.some,C.some)})(e).each((function(e){var r=Yc(n,e.pname());t[e.name()]=function(t){var o=Lt("Part: "+e.name()+" in "+n,At(e.schema()),t);return x(r,{config:t,validated:o})}}))})),t}(e.name,e.partFields),o=D(e.apis,ra),i=D(e.extraApis,(function(n,e){return yr(n,e)}));return x({name:r(e.name),partFields:r(e.partFields),configFields:r(e.configFields),sketch:function(n){return da(e.name,e.configFields,e.partFields,e.factory,n)},parts:r(t)},o,i)},ya=pa({name:"Button",factory:function(n){var e,t,r,o=(e=n.action(),t=function(n,e){e.stop(),ee(n)},r=Hn.detect().deviceType.isTouch()?[ur(Gn(),t)]:[ur(P(),t),ur(V(),(function(n,e){e.cut()}))],or(Cn([e.map((function(n){return ur(Wn(),(function(e,t){n(e),t.stop()}))})).toArray(),r]))),i=vt(n.dom(),"attributes").bind(mt("type")),u=vt(n.dom(),"tag");return{uid:n.uid(),dom:n.dom(),components:n.components(),events:o,behaviours:x(Fr([ri.config({}),wc.config({mode:"execution",useSpace:!0,useEnter:!0})]),Tc(n.buttonBehaviours())),domModification:{attributes:x(i.fold((function(){return u.is("button")?{type:"button"}:{}}),(function(n){return{}})),{role:n.role().getOr("button")})},eventOrder:n.eventOrder()}},configFields:[nr("uid",void 0),qt("dom"),nr("components",[]),xc("buttonBehaviours",[ri,wc]),Jt("action"),Jt("role"),nr("eventOrder",{})]}),ba=Br({fields:[],name:"unselecting",active:Object.freeze({events:function(n){return or([ir(W(),r(!0))])},exhibit:function(n,e){return wr({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})}})}),wa=function(n){var e,t;return function(n){var e=ie(n),t=je(e),r=function(n){var e=void 0!==n.dom().attributes?n.dom().attributes:[];return Sn(e,(function(n,e){return"class"===e.name?n:x(n,pt(e.name,e.value))}),{})}(e),o=function(n){return Array.prototype.slice.call(n.dom().classList,0)}(e),i=0===t.length?{}:{innerHtml:mo(e)};return x({tag:ge(e),classes:o,attributes:r},i)}((e=n,t={prefix:Qo.prefix()},e.replace(/\$\{([^{}]*)\}/g,(function(n,e){var r,o=t[e];return"string"==(r=typeof o)||"number"===r?o.toString():n}))))},xa=function(n){return{dom:wa(n)}},Ta=function(n){return Fr([qo.config({toggleClass:Qo.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),Yo(n,(function(n,e){(e?qo.on:qo.off)(n)}))])},Sa=function(n,e,t){return ya.sketch({dom:wa('<span class="${prefix}-toolbar-button ${prefix}-icon-'+n+' ${prefix}-icon"></span>'),action:e,buttonBehaviours:x(Fr([ba.config({})]),t)})},Oa=Sa,ka=function(n,e){return Sa(e,(function(){n.execCommand(e)}),{})},Ca=function(n,e,t,r){var o=Ta(t);return Sa(e,r,o)},Ea=function(n,e){var t=Ta(e);return Sa(e,(function(){n.execCommand(e)}),t)},Ia=function(n,e){return{left:r(n),top:r(e),translate:function(t,r){return Ia(n+t,e+r)}}},Da=Ia,Ma=function(n,e,t){return Math.max(e,Math.min(t,n))},Aa="slider.change.value",Fa=Hn.detect().deviceType.isTouch(),Ra=function(n,e){ne(n,Aa,{value:e})},Ba=function(n,e,t,r){return function(n){return function(n){var e=n.event().raw();if(Fa){var t=e;return void 0!==t.touches&&1===t.touches.length?C.some(t.touches[0]).map((function(n){return Da(n.clientX,n.clientY)})):C.none()}var r=e;return void 0!==r.clientX?C.some(r).map((function(n){return Da(n.clientX,n.clientY)})):C.none()}(n).map((function(n){return n.left()}))}(r).map((function(r){return function(n,e,t,r){var o=function(n,e,t,r,o,i,u){var c=t-e;if(r<n.left)return e-1;if(r>n.right)return t+1;var a=Math.min(n.right,Math.max(r,n.left))-n.left,s=Ma(a/n.width*c+e,e-1,t+1),f=Math.round(s);return i&&s>=e&&s<=t?function(n,e,t,r,o,i){return i.fold((function(){var n=e-t,i=Math.round(n/o)*o;return Ma(t+i,t-1,r+1)}),(function(n){var t=(e-n)%o,i=Math.round(t/o),u=Math.floor((e-n)/o),c=Math.floor((r-n)/o),a=n+Math.min(c,u+i)*o;return Math.max(n,a)}))}(0,s,e,t,o,u):f}(e,t.min(),t.max(),r,t.stepSize(),t.snapToGrid(),t.snapStart());Ra(n,o)}(n,t,e,r),r}))},Va=Hn.detect().deviceType.isTouch(),Na=function(n,e){return Wc({name:n+"-edge",overrides:function(n){var t=or([cr(F(),e,[n])]),r=or([cr(V(),e,[n]),cr(N(),(function(n,t){t.mouseIsDown().get()&&e(n,t)}),[n])]);return{events:Va?t:r}}})},_a=[Na("left",(function(n,e){Ra(n,e.min()-1)})),Na("right",(function(n,e){Ra(n,e.max()+1)})),$c({name:"thumb",defaults:r({dom:{styles:{position:"absolute"}}}),overrides:function(n){return{events:or([sr(F(),n,"spectrum"),sr(R(),n,"spectrum"),sr(B(),n,"spectrum")])}}}),$c({schema:[tr("mouseIsDown",(function(){return eo(!1)}))],name:"spectrum",overrides:function(n){var e=function(e,t){var r=e.element().dom().getBoundingClientRect();Ba(e,n,r,t)},t=or([ur(F(),e),ur(R(),e)]),r=or([ur(V(),e),ur(N(),(function(t,r){n.mouseIsDown().get()&&e(t,r)}))]);return{behaviours:Fr(Va?[]:[wc.config({mode:"special",onLeft:function(e){return function(n,e){var t=function(n,e,t,r){return n<e?n:n>t?t:n===e?e-1:Math.max(e,n-r)}(e.value().get(),e.min(),e.max(),e.stepSize());Ra(n,t)}(e,n),C.some(!0)},onRight:function(e){return function(n,e){var t=function(n,e,t,r){return n>t?n:n<e?e:n===t?t+1:Math.min(t,n+r)}(e.value().get(),e.min(),e.max(),e.stepSize());Ra(n,t)}(e,n),C.some(!0)}}),ri.config({})]),events:Va?t:r}}})],ja=function(n,e,t){e.store().manager().onLoad(n,e,t)},Ha=function(n,e,t){e.store().manager().onUnload(n,e,t)},za=Object.freeze({onLoad:ja,onUnload:Ha,setValue:function(n,e,t,r){e.store().manager().setValue(n,e,t,r)},getValue:function(n,e,t){return e.store().manager().getValue(n,e,t)}}),La=Object.freeze({events:function(n,e){var t=n.resetOnDom()?[mr((function(t,r){ja(t,n,e)})),gr((function(t,r){Ha(t,n,e)}))]:[Tr(n,e,ja)];return or(t)}}),Pa=function(){var n=eo(null);return Ar({set:n.set,get:n.get,isNotSet:function(){return null===n.get()},clear:function(){n.set(null)},readState:function(){return{mode:"memory",value:n.get()}}})},$a=function(){var n=eo({});return Ar({readState:function(){return{mode:"dataset",dataset:n.get()}},set:n.set,get:n.get})},Wa=Object.freeze({memory:Pa,dataset:$a,manual:function(){return Ar({readState:function(){}})},init:function(n){return n.store().manager().state(n)}}),Ua=function(n,e,t,r){e.store().getDataKey(),t.set({}),e.store().setData()(n,r),e.onSetValue()(n,r)},Ga=[Jt("initialValue"),qt("getFallbackEntry"),qt("getDataKey"),qt("setData"),Fo("manager",{setValue:Ua,getValue:function(n,e,t){var r=e.store().getDataKey()(n),o=t.get();return vt(o,r).fold((function(){return e.store().getFallbackEntry()(r)}),(function(n){return n}))},onLoad:function(n,e,t){e.store().initialValue().each((function(r){Ua(n,e,t,r)}))},onUnload:function(n,e,t){t.set({})},state:$a})],qa=[qt("getValue"),nr("setValue",e),Jt("initialValue"),Fo("manager",{setValue:function(n,e,t,r){e.store().setValue()(n,r),e.onSetValue()(n,r)},getValue:function(n,e,t){return e.store().getValue()(n)},onLoad:function(n,e,t){e.store().initialValue().each((function(t){e.store().setValue()(n,t)}))},onUnload:e,state:Mr.init})],Ya=[Jt("initialValue"),Fo("manager",{setValue:function(n,e,t,r){t.set(r),e.onSetValue()(n,r)},getValue:function(n,e,t){return t.get()},onLoad:function(n,e,t){e.store().initialValue().each((function(n){t.isNotSet()&&t.set(n)}))},onUnload:function(n,e,t){t.clear()},state:Pa})],Ka=[er("store",{mode:"memory"},Wt("mode",{memory:Ya,manual:qa,dataset:Ga})),Io("onSetValue"),nr("resetOnDom",!1)],Xa=Br({fields:Ka,name:"representing",active:La,apis:za,extra:{setValueFrom:function(n,e){var t=Xa.getValue(e);Xa.setValue(n,t)}},state:Wa}),Ja=Hn.detect().deviceType.isTouch(),Qa=[qt("min"),qt("max"),nr("stepSize",1),nr("onChange",e),nr("onInit",e),nr("onDragStart",e),nr("onDragEnd",e),nr("snapToGrid",!1),Jt("snapStart"),qt("getInitialValue"),xc("sliderBehaviours",[wc,Xa]),tr("value",(function(n){return eo(n.min)}))].concat(Ja?[]:[tr("mouseIsDown",(function(){return eo(!1)}))]),Za=mi("width",(function(n){return n.dom().offsetWidth})),ns=function(n,e){Za.set(n,e)},es=function(n){return Za.get(n)},ts=Hn.detect().deviceType.isTouch(),rs=ha({name:"Slider",configFields:Qa,partFields:_a,factory:function(n,e,t,o){var i=n.max()-n.min(),u=function(n){var e=n.element().dom().getBoundingClientRect();return(e.left+e.right)/2},c=function(e){return Qc(e,n,"thumb")},a=function(e){var t,r,o,a,s=(r=Qc(t=e,n,"spectrum").element().dom().getBoundingClientRect(),o=t.element().dom().getBoundingClientRect(),a=function(n,e,t){var r=t.value().get();return r<t.min()?Jc(n,t,"left-edge").fold((function(){return 0}),(function(n){return u(n)-e.left})):r>t.max()?Jc(n,t,"right-edge").fold((function(){return e.width}),(function(n){return u(n)-e.left})):(t.value().get()-t.min())/i*e.width}(t,r,n),r.left-o.left+a),f=c(e),l=es(f.element())/2;ui(f.element(),"left",s-l+"px")},s=function(e,t){var r=n.value().get(),o=c(e);return r!==t||fi(o.element(),"left").isNone()?(n.value().set(t),a(e),n.onChange()(e,o,t),C.some(!0)):C.none()},f=ts?[ur(F(),(function(e,t){n.onDragStart()(e,c(e))})),ur(B(),(function(e,t){n.onDragEnd()(e,c(e))}))]:[ur(V(),(function(e,t){t.stop(),n.onDragStart()(e,c(e)),n.mouseIsDown().set(!0)})),ur(_(),(function(e,t){n.onDragEnd()(e,c(e)),n.mouseIsDown().set(!1)}))];return{uid:n.uid(),dom:n.dom(),components:e,behaviours:x(Fr(Cn([ts?[]:[wc.config({mode:"special",focusIn:function(e){return Jc(e,n,"spectrum").map(wc.focusIn).map(r(!0))}})],[Xa.config({store:{mode:"manual",getValue:function(e){return n.value().get()}}})]])),Tc(n.sliderBehaviours())),events:or([ur(Aa,(function(n,e){s(n,e.event().value())})),mr((function(e,t){n.value().set(n.getInitialValue()());var r=c(e);a(e),n.onInit()(e,r,n.value().get())}))].concat(f)),apis:{resetToMin:function(e){s(e,n.min())},resetToMax:function(e){s(e,n.max())},refresh:a},domModification:{styles:{position:"relative"}}}},apis:{resetToMin:function(n,e){n.resetToMin(e)},resetToMax:function(n,e){n.resetToMax(e)},refresh:function(n,e){n.refresh(e)}}}),os=function(n,e,t){return Oa(e,(function(){var r=t();n.setContextToolbar([{label:e+" group",items:r}])}),{})},is=function(n){var e=function(n){return n<0?"black":n>360?"white":"hsl("+n+", 100%, 50%)"};return rs.sketch({dom:wa('<div class="${prefix}-slider ${prefix}-hue-slider-container"></div>'),components:[rs.parts()["left-edge"](xa('<div class="${prefix}-hue-slider-black"></div>')),rs.parts().spectrum({dom:wa('<div class="${prefix}-slider-gradient-container"></div>'),components:[xa('<div class="${prefix}-slider-gradient"></div>')],behaviours:Fr([qo.config({toggleClass:Qo.resolve("thumb-active")})])}),rs.parts()["right-edge"](xa('<div class="${prefix}-hue-slider-white"></div>')),rs.parts().thumb({dom:wa('<div class="${prefix}-slider-thumb"></div>'),behaviours:Fr([qo.config({toggleClass:Qo.resolve("thumb-active")})])})],onChange:function(t,r,o){var i=e(o);ui(r.element(),"background-color",i),n.onChange(t,r,i)},onDragStart:function(n,e){qo.on(e)},onDragEnd:function(n,e){qo.off(e)},onInit:function(n,t,r){var o=e(r);ui(t.element(),"background-color",o)},stepSize:10,min:0,max:360,getInitialValue:n.getInitialValue,sliderBehaviours:Fr([Ko(rs.refresh)])})},us=function(n,e){var t={onChange:function(n,t,r){e.undoManager.transact((function(){e.formatter.apply("forecolor",{value:r}),e.nodeChanged()}))},getInitialValue:function(){return-1}};return os(n,"color",(function(){return function(n){return[is(n)]}(t)}))},cs=Mt([qt("getInitialValue"),qt("onChange"),qt("category"),qt("sizes")]),as=function(n){var e=Lt("SizeSlider",cs,n);return rs.sketch({dom:{tag:"div",classes:[Qo.resolve("slider-"+e.category+"-size-container"),Qo.resolve("slider"),Qo.resolve("slider-size-container")]},onChange:function(n,t,r){(function(n){return n>=0&&n<e.sizes.length})(r)&&e.onChange(r)},onDragStart:function(n,e){qo.on(e)},onDragEnd:function(n,e){qo.off(e)},min:0,max:e.sizes.length-1,stepSize:1,getInitialValue:e.getInitialValue,snapToGrid:!0,sliderBehaviours:Fr([Ko(rs.refresh)]),components:[rs.parts().spectrum({dom:wa('<div class="${prefix}-slider-size-container"></div>'),components:[xa('<div class="${prefix}-slider-size-line"></div>')]}),rs.parts().thumb({dom:wa('<div class="${prefix}-slider-thumb"></div>'),behaviours:Fr([qo.config({toggleClass:Qo.resolve("thumb-active")})])})]})},ss=["9px","10px","11px","12px","14px","16px","18px","20px","24px","32px","36px"],fs=function(n){var e,t,r=n.selection.getStart(),o=ae(r),i=ae(n.getBody()),u=(e=function(n){return Be(i,n)},(pe(t=o)?C.some(t):_e(t).filter(pe)).map((function(n){return oo(n,(function(n){return fi(n,"font-size").isSome()}),e).bind((function(n){return fi(n,"font-size")})).getOrThunk((function(){return ai(n,"font-size")}))})).getOr(""));return On(ss,(function(n){return u===n})).getOr("medium")},ls={candidates:r(ss),get:function(n){return(e=fs(n),kn(ss,(function(n){return n===e}))).getOr(2);var e},apply:function(n,e){(function(n){return C.from(ss[n])})(e).each((function(e){!function(n,e){fs(n)!==e&&n.execCommand("fontSize",!1,e)}(n,e)}))}},ds=ls.candidates(),ms=function(n){return as({onChange:n.onChange,sizes:ds,category:"font",getInitialValue:n.getInitialValue})},gs=function(n){return[xa('<span class="${prefix}-toolbar-button ${prefix}-icon-small-font ${prefix}-icon"></span>'),ms(n),xa('<span class="${prefix}-toolbar-button ${prefix}-icon-large-font ${prefix}-icon"></span>')]},vs=function(n){var e=function(n){return void 0!==n.uid}(n)&&bt(n,"uid")?n.uid:fa("memento");return{get:function(n){return n.getSystem().getByUid(e).getOrDie()},getOpt:function(n){return n.getSystem().getByUid(e).fold(C.none,C.some)},asSpec:function(){return x(n,{uid:e})}}},ps=window.Promise?window.Promise:function(){var e=function(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],f(n,r(u,this),r(c,this))},t=e.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(e){n.setTimeout(e,1)};function r(n,e){return function(){return n.apply(e,arguments)}}var o=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)};function i(n){var e=this;null!==this._state?t((function(){var t=e._state?n.onFulfilled:n.onRejected;if(null!==t){var r;try{r=t(e._value)}catch(e){return void n.reject(e)}n.resolve(r)}else(e._state?n.resolve:n.reject)(e._value)})):this._deferreds.push(n)}function u(n){try{if(n===this)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var e=n.then;if("function"==typeof e)return void f(r(e,n),r(u,this),r(c,this))}this._state=!0,this._value=n,a.call(this)}catch(n){c.call(this,n)}}function c(n){this._state=!1,this._value=n,a.call(this)}function a(){for(var n=0,e=this._deferreds;n<e.length;n++){var t=e[n];i.call(this,t)}this._deferreds=[]}function s(n,e,t,r){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.resolve=t,this.reject=r}function f(n,e,t){var r=!1;try{n((function(n){r||(r=!0,e(n))}),(function(n){r||(r=!0,t(n))}))}catch(n){if(r)return;r=!0,t(n)}}return e.prototype.catch=function(n){return this.then(null,n)},e.prototype.then=function(n,t){var r=this;return new e((function(e,o){i.call(r,new s(n,t,e,o))}))},e.all=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var r=Array.prototype.slice.call(1===n.length&&o(n[0])?n[0]:n);return new e((function(n,e){if(0===r.length)return n([]);var t=r.length;function o(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var c=u.then;if("function"==typeof c)return void c.call(u,(function(n){o(i,n)}),e)}r[i]=u,0==--t&&n(r)}catch(n){e(n)}}for(var i=0;i<r.length;i++)o(i,r[i])}))},e.resolve=function(n){return n&&"object"==typeof n&&n.constructor===e?n:new e((function(e){e(n)}))},e.reject=function(n){return new e((function(e,t){t(n)}))},e.race=function(n){return new e((function(e,t){for(var r=0,o=n;r<o.length;r++)o[r].then(e,t)}))},e}();var hs=function(e,t){(function(e){return function(e){return function(e){return new ps((function(t){var r=new n.FileReader;r.onloadend=function(){t(r.result)},r.readAsDataURL(e)}))}(e).then((function(n){return n.split(",")[1]}))}(e)})(t).then((function(n){e.undoManager.transact((function(){var r=e.editorUpload.blobCache,o=r.create(Mc("mceu"),t,n);r.add(o);var i=e.dom.createHTML("img",{src:o.blobUri()});e.insertContent(i)}))}))},ys=function(n){return n.dom().textContent},bs=function(n){return n.length>0},ws=function(n){return null==n?"":n},xs=function(n){var e=ae(n.selection.getStart());return xi(e,"a")},Ts=function(n){return xs(n).fold((function(){return function(n){return{url:"",text:n.selection.getContent({format:"text"}),title:"",target:"",link:C.none()}}(n)}),(function(n){return function(n){var e=ys(n),t=zr(n,"href"),r=zr(n,"title"),o=zr(n,"target");return{url:ws(t),text:e!==t?ws(e):"",title:ws(r),target:ws(o),link:C.some(n)}}(n)}))},Ss=function(n,e){e.url.filter(bs).fold((function(){!function(n,e){e.link.bind(o).each((function(e){n.execCommand("unlink")}))}(n,e)}),(function(t){var r=function(n,e){var t={};return t.href=n,e.title.filter(bs).each((function(n){t.title=n})),e.target.filter(bs).each((function(n){t.target=n})),t}(t,e);e.link.bind(o).fold((function(){var o=e.text.filter(bs).getOr(t);n.insertContent(n.dom.createHTML("a",r,n.dom.encode(o)))}),(function(n){var o=function(n,e,t){return t.text.filter(bs).fold((function(){return function(n){return zr(n,"href")===ys(n)}(n)?C.some(e):C.none()}),C.some)}(n,t,e);Hr(n,r),o.each((function(e){!function(n,e){n.dom().textContent=e}(n,e)}))}))}))},Os=xs,ks=Hn.detect(),Cs=function(n,e){var t=e.selection.getRng();n(),e.selection.setRng(t)},Es=function(n,e){return{key:n,value:{config:{},me:function(n,e){var t=or(e);return Br({fields:[qt("enabled")],name:n,active:{events:r(t)}})}(n,e),configAsRaw:r({}),initialConfig:{},state:Mr}}},Is=Object.freeze({getCurrent:function(n,e,t){return e.find()(n)}}),Ds=[qt("find")],Ms=Br({fields:Ds,name:"composing",apis:Is}),As=pa({name:"Container",factory:function(n){return{uid:n.uid(),dom:x({tag:"div",attributes:{role:"presentation"}},n.dom()),components:n.components(),behaviours:Tc(n.containerBehaviours()),events:n.events(),domModification:n.domModification(),eventOrder:n.eventOrder()}},configFields:[nr("components",[]),xc("containerBehaviours",[]),nr("events",{}),nr("domModification",{}),nr("eventOrder",{})]}),Fs=pa({name:"DataField",factory:function(n){return{uid:n.uid(),dom:n.dom(),behaviours:x(Fr([Xa.config({store:{mode:"memory",initialValue:n.getInitialValue()()}}),Ms.config({find:C.some})]),Tc(n.dataBehaviours())),events:or([mr((function(e,t){Xa.setValue(e,n.getInitialValue()())}))])}},configFields:[qt("uid"),qt("dom"),qt("getInitialValue"),xc("dataBehaviours",[Xa,Ms])]}),Rs=function(n){return n.dom().value},Bs=function(n,e){if(void 0===e)throw new Error("Value.set was undefined");n.dom().value=e},Vs=r([Jt("data"),nr("inputAttributes",{}),nr("inputStyles",{}),nr("type","input"),nr("tag","input"),nr("inputClasses",[]),Io("onSetValue"),nr("styles",{}),Jt("placeholder"),nr("eventOrder",{}),xc("inputBehaviours",[Xa,ri]),nr("selectOnFocus",!0)]),Ns=function(n){return x(Fr([Xa.config({store:{mode:"manual",initialValue:n.data().getOr(void 0),getValue:function(n){return Rs(n.element())},setValue:function(n,e){Rs(n.element())!==e&&Bs(n.element(),e)}},onSetValue:n.onSetValue()})]),function(n){return Fr([ri.config({onFocus:!1===n.selectOnFocus()?e:function(n){var e=n.element(),t=Rs(e);e.dom().setSelectionRange(0,t.length)}})])}(n),Tc(n.inputBehaviours()))},_s=function(n){return{tag:n.tag(),attributes:x(ht([{key:"type",value:n.type()}].concat(n.placeholder().map((function(n){return{key:"placeholder",value:n}})).toArray())),n.inputAttributes()),styles:n.inputStyles(),classes:n.inputClasses()}},js=pa({name:"Input",configFields:Vs(),factory:function(n,e){return{uid:n.uid(),dom:_s(n),components:[],behaviours:Ns(n),eventOrder:n.eventOrder()}}}),Hs=Object.freeze({exhibit:function(n,e){return wr({attributes:ht([{key:e.tabAttr(),value:"true"}])})}}),zs=[nr("tabAttr","data-alloy-tabstop")],Ls=Br({fields:zs,name:"tabstopping",active:Hs}),Ps=function(n,e){var t=vs(js.sketch({placeholder:e,onSetValue:function(n,e){Zn(n,z())},inputBehaviours:Fr([Ms.config({find:C.some}),Ls.config({}),wc.config({mode:"execution"})]),selectOnFocus:!1})),r=vs(ya.sketch({dom:wa('<button class="${prefix}-input-container-x ${prefix}-icon-cancel-circle ${prefix}-icon"></button>'),action:function(n){var e=t.get(n);Xa.setValue(e,"")}}));return{name:n,spec:As.sketch({dom:wa('<div class="${prefix}-input-container"></div>'),components:[t.asSpec(),r.asSpec()],containerBehaviours:Fr([qo.config({toggleClass:Qo.resolve("input-container-empty")}),Ms.config({find:function(n){return C.some(t.get(n))}}),Es("input-clearing",[ur(z(),(function(n){var e=t.get(n);(Xa.getValue(e).length>0?qo.off:qo.on)(n)}))])])})}},$s=function(n){return{name:n,spec:Fs.sketch({dom:{tag:"span",styles:{display:"none"}},getInitialValue:function(){return C.none()}})}},Ws=["input","button","textarea"],Us=function(n,e,t){e.disabled()&&Js(n,e)},Gs=function(n){return yn(Ws,ge(n.element()))},qs=function(n){jr(n.element(),"disabled","disabled")},Ys=function(n){Pr(n.element(),"disabled")},Ks=function(n){jr(n.element(),"aria-disabled","true")},Xs=function(n){jr(n.element(),"aria-disabled","false")},Js=function(n,e,t){e.disableClass().each((function(e){Yr(n.element(),e)})),(Gs(n)?qs:Ks)(n)},Qs=function(n){return Gs(n)?function(n){return Lr(n.element(),"disabled")}(n):function(n){return"true"===zr(n.element(),"aria-disabled")}(n)},Zs=Object.freeze({enable:function(n,e,t){e.disableClass().each((function(e){Kr(n.element(),e)})),(Gs(n)?Ys:Xs)(n)},disable:Js,isDisabled:Qs,onLoad:Us}),nf=Object.freeze({exhibit:function(n,e,t){return wr({classes:e.disabled()?e.disableClass().map(Mn).getOr([]):[]})},events:function(n,e){return or([ir(Wn(),(function(n,e){return Qs(n)})),Tr(n,e,Us)])}}),ef=[nr("disabled",!1),Jt("disableClass")],tf=Br({fields:ef,name:"disabling",active:nf,apis:Zs}),rf="form",of=[xc("formBehaviours",[Xa])],uf=function(n){return"<alloy.field."+n+">"},cf=function(n,e,t){return x({"debug.sketcher":{Form:t},uid:n.uid(),dom:n.dom(),components:e,behaviours:x(Fr([Xa.config({store:{mode:"manual",getValue:function(e){var t=function(n,e){var t=n.getSystem();return D(e.partUids(),(function(n,e){return r(t.getByUid(n))}))}(e,n);return D(t,(function(n,e){return n().bind(Ms.getCurrent).map(Xa.getValue)}))},setValue:function(e,t){I(t,(function(t,r){Jc(e,n,r).each((function(n){Ms.getCurrent(n).each((function(n){Xa.setValue(n,t)}))}))}))}}})]),Tc(n.formBehaviours())),apis:{getField:function(e,t){return Jc(e,n,t).bind(Ms.getCurrent)}}})},af=(ra((function(n,e,t){return n.getField(e,t)})),function(n){var e=function(){var n=[];return{field:function(e,t){return n.push(e),function(n,e,t){return{uiType:Ic(),owner:"form",name:e,config:t,validated:{}}}(0,uf(e),t)},record:function(){return n}}}(),t=n(e),r=e.record(),o=bn(r,(function(n){return $c({name:n,pname:uf(n)})}));return da(rf,of,o,cf,t)}),sf=function(){var n=eo(C.none()),e=function(){n.get().each((function(n){n.destroy()}))};return{clear:function(){e(),n.set(C.none())},isSet:function(){return n.get().isSome()},set:function(t){e(),n.set(C.some(t))},run:function(e){n.get().each(e)}}},ff=function(){var n=eo(C.none());return{clear:function(){n.set(C.none())},set:function(e){n.set(C.some(e))},isSet:function(){return n.get().isSome()},on:function(e){n.get().each(e)}}},lf=U((function(n,e){return[{label:"the link group",items:[(t={fields:[Ps("url","Type or paste URL"),Ps("text","Link text"),Ps("title","Link title"),Ps("target","Link target"),$s("link")],maxFieldIndex:["url","text","title","target"].length-1,getInitialValue:function(){return C.some(Ts(e))},onExecute:function(t){var r=Xa.getValue(t);Ss(e,r),n.restoreToolbar(),e.focus()}},r="navigateEvent",o=At([qt("fields"),nr("maxFieldIndex",t.fields.length-1),qt("onExecute"),qt("getInitialValue"),tr("state",(function(){return{dialogSwipeState:ff(),currentScreen:eo(0)}}))]),i=Lt("SerialisedDialog",o,t),u=function(n,e,t){return ya.sketch({dom:wa('<span class="${prefix}-icon-'+e+' ${prefix}-icon"></span>'),action:function(e){ne(e,r,{direction:n})},buttonBehaviours:Fr([tf.config({disableClass:Qo.resolve("toolbar-navigation-disabled"),disabled:!t})])})},c=function(n,e){var t=hi(n.element(),"."+Qo.resolve("serialised-dialog-screen"));wi(n.element(),"."+Qo.resolve("serialised-dialog-chain")).each((function(n){i.state.currentScreen.get()+e>=0&&i.state.currentScreen.get()+e<t.length&&(fi(n,"left").each((function(r){var o=parseInt(r,10),i=es(t[0]);ui(n,"left",o-e*i+"px")})),i.state.currentScreen.set(i.state.currentScreen.get()+e))}))},a=function(n){var e=hi(n.element(),"input");C.from(e[i.state.currentScreen.get()]).each((function(e){n.getSystem().getByDom(e).each((function(e){var t,r;t=n,r=e.element(),t.getSystem().triggerFocus(r,t.element())}))}));var t=f.get(n);Pi.highlightAt(t,i.state.currentScreen.get())},s=vs(af((function(n){return{dom:wa('<div class="${prefix}-serialised-dialog"></div>'),components:[As.sketch({dom:wa('<div class="${prefix}-serialised-dialog-chain" style="left: 0px; position: absolute;"></div>'),components:bn(i.fields,(function(e,t){return t<=i.maxFieldIndex?As.sketch({dom:wa('<div class="${prefix}-serialised-dialog-screen"></div>'),components:Cn([[u(-1,"previous",t>0)],[n.field(e.name,e.spec)],[u(1,"next",t<i.maxFieldIndex)]])}):n.field(e.name,e.spec)}))})],formBehaviours:Fr([Ko((function(n,e){!function(n,e){wi(n.element(),"."+Qo.resolve("serialised-dialog-chain")).each((function(n){ui(n,"left",-i.state.currentScreen.get()*e.width+"px")}))}(n,e)})),wc.config({mode:"special",focusIn:function(n){a(n)},onTab:function(n){return c(n,1),C.some(!0)},onShiftTab:function(n){return c(n,-1),C.some(!0)}}),Es("form-events",[mr((function(n,e){i.state.currentScreen.set(0),i.state.dialogSwipeState.clear();var t=f.get(n);Pi.highlightFirst(t),i.getInitialValue(n).each((function(e){Xa.setValue(n,e)}))})),pr(i.onExecute),ur($(),(function(n,e){"left"===e.event().raw().propertyName&&a(n)})),ur(r,(function(n,e){var t=e.event().direction();c(n,t)}))])])}}))),f=vs({dom:wa('<div class="${prefix}-dot-container"></div>'),behaviours:Fr([Pi.config({highlightClass:Qo.resolve("dot-active"),itemClass:Qo.resolve("dot-item")})]),components:En(i.fields,(function(n,e){return e<=i.maxFieldIndex?[xa('<div class="${prefix}-dot-item ${prefix}-icon-full-dot ${prefix}-icon"></div>')]:[]}))}),{dom:wa('<div class="${prefix}-serializer-wrapper"></div>'),components:[s.asSpec(),f.asSpec()],behaviours:Fr([wc.config({mode:"special",focusIn:function(n){var e=s.get(n);wc.focusIn(e)}}),Es("serializer-wrapper-events",[ur(F(),(function(n,e){var t=e.event();i.state.dialogSwipeState.set({xValue:t.touches[0].clientX,points:[]})})),ur(R(),(function(n,e){var t=e.event();i.state.dialogSwipeState.on((function(n){e.event().prevent(),i.state.dialogSwipeState.set(function(n,e){if(e===n.xValue)return n;var t=e-n.xValue>0?1:-1,r={direction:t,xValue:e};return{xValue:e,points:(0===n.points.length?[]:n.points[n.points.length-1].direction===t?n.points.slice(0,n.points.length-1):n.points).concat([r])}}(n,t.raw().touches[0].clientX))}))})),ur(B(),(function(n){i.state.dialogSwipeState.on((function(e){var t=s.get(n),r=-1*function(n){if(0===n.points.length)return 0;var e=n.points[0].direction,t=n.points[n.points.length-1].direction;return-1===e&&-1===t?-1:1===e&&1===t?1:0}(e);c(t,r)}))}))])])})]}];var t,r,o,i,u,c,a,s,f})),df=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}],mf=or([function(e,t){return{key:e,value:rr({can:function(e,t){var r=t.event().originator(),o=t.event().target();return!function(n,e,t){return Be(e,n.element())&&!Be(e,t)}(e,r,o)||(n.console.warn(Ln()+" did not get interpreted by the desired target. \nOriginator: "+po(r)+"\nTarget: "+po(o)+"\nCheck the "+Ln()+" event handlers"),!1)}})}}(Ln())]),gf=Object.freeze({events:mf}),vf=o,pf=Dr(["debugInfo","triggerFocus","triggerEvent","triggerEscape","addToWorld","removeFromWorld","addToGui","removeFromGui","build","getByUid","getByDom","broadcast","broadcastOn","isConnected"]),hf=function(n){var e=function(e){return function(){throw new Error("The component must be in a context to send: "+e+"\n"+po(n().element())+" is not in context.")}};return pf({debugInfo:r("fake"),triggerEvent:e("triggerEvent"),triggerFocus:e("triggerFocus"),triggerEscape:e("triggerEscape"),build:e("build"),addToWorld:e("addToWorld"),removeFromWorld:e("removeFromWorld"),addToGui:e("addToGui"),removeFromGui:e("removeFromGui"),getByUid:e("getByUid"),getByDom:e("getByDom"),broadcast:e("broadcast"),broadcastOn:e("broadcastOn"),isConnected:r(!1)})},yf=function(n,e){var t={};return I(n,(function(n,r){I(n,(function(n,o){var i=gt(o,[])(t);t[o]=i.concat([e(r,n)])}))})),t},bf=function(n,e){return n.length>1?Qe.error('Multiple behaviours have tried to change DOM "'+e+'". The guilty behaviours are: '+Tt(bn(n,(function(n){return n.name()})))+". At this stage, this is not supported. Future releases might provide strategies for resolving this."):0===n.length?Qe.value({}):Qe.value(n[0].modification().fold((function(){return{}}),(function(n){return pt(e,n)})))},wf=function(n,e){return Sn(n,(function(t,r){var o=r.modification().getOr({});return t.bind((function(t){var r=A(o,(function(r,o){return void 0!==t[o]?function(n,e,t,r){return Qe.error("Mulitple behaviours have tried to change the _"+e+'_ "'+n+'". The guilty behaviours are: '+Tt(En(r,(function(n){return void 0!==n.modification().getOr({})[e]?[n.name()]:[]})),null,2)+". This is not currently supported.")}(e,o,0,n):Qe.value(pt(o,r))}));return yt(r,t)}))}),Qe.value({})).map((function(n){return pt(e,n)}))},xf={classes:function(n,e){var t=En(n,(function(n){return n.modification().getOr([])}));return Qe.value(pt(e,t))},attributes:wf,styles:wf,domChildren:bf,defChildren:bf,innerHtml:bf,value:bf},Tf=function(n){return n.cHandler},Sf=function(n,e){return{name:r(n),handler:r(e)}},Of=function(n,e,t){var r=e[t];return r?function(n,e,t,r){var o=t.slice(0);try{var i=o.sort((function(e,t){var o=e.name(),i=t.name(),u=r.indexOf(o),c=r.indexOf(i);if(-1===u)throw new Error("The ordering for "+n+" does not have an entry for "+o+".\nOrder specified: "+Tt(r,null,2));if(-1===c)throw new Error("The ordering for "+n+" does not have an entry for "+i+".\nOrder specified: "+Tt(r,null,2));return u<c?-1:c<u?1:0}));return Qe.value(i)}catch(n){return Qe.error([n])}}("Event: "+t,0,n,r).map((function(n){return function(n){var e=function(n,e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Sn(n,(function(n,r){return n&&e(r).apply(void 0,t)}),!0)}}(n,(function(n){return n.can})),t=function(n,e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Sn(n,(function(n,r){return n||e(r).apply(void 0,t)}),!1)}}(n,(function(n){return n.abort}));return rr({can:e,abort:t,run:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];wn(n,(function(n){n.run.apply(void 0,e)}))}})}(bn(n,(function(n){return n.handler()})))})):function(n,e){return Qe.error(["The event ("+n+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+Tt(bn(e,(function(n){return n.name()})),null,2)])}(t,n)},kf=function(n,e){var t=A(n,(function(n,t){return(1===n.length?Qe.value(n[0].handler()):Of(n,e,t)).map((function(o){var i=function(n){var e=function(n){return h(n)?{can:r(!0),abort:r(!1),run:n}:n}(n);return function(n,t){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var i=[n,t].concat(r);e.abort.apply(void 0,i)?t.stop():e.can.apply(void 0,i)&&e.run.apply(void 0,i)}}(o),u=n.length>1?xn(e,(function(e){return yn(n,(function(n){return n.name()===e}))})).join(" > "):n[0].name();return pt(t,function(n,e){return{handler:n,purpose:r(e)}}(i,u))}))}));return yt(t,{})},Cf=function(n){return pt(ua(),n.uid())},Ef=function(n){return n.events()},If=function(n,e){wn(e,(function(e){Yr(n,e)}))},Df=function(n,e){wn(e,(function(e){Kr(n,e)}))},Mf=function(n){if(n.domChildren().isSome()&&n.defChildren().isSome())throw new Error("Cannot specify children and child specs! Must be one or the other.\nDef: "+(t={tag:(e=n).tag(),classes:e.classes().getOr([]),attributes:e.attributes().getOr({}),styles:e.styles().getOr({}),value:e.value().getOr("<none>"),innerHtml:e.innerHtml().getOr("<none>"),defChildren:e.defChildren().fold((function(){return"<none>"}),(function(n){return Tt(n,null,2)})),domChildren:e.domChildren().fold((function(){return"<none>"}),(function(n){return 0===n.length?"0 children, but still specified":String(n.length)}))},Tt(t,null,2)));var e,t;return n.domChildren().fold((function(){var e=n.defChildren().getOr([]);return bn(e,Ff)}),(function(n){return n}))},Af=function(n){var e=ue(n.tag());Hr(e,n.attributes().getOr({})),If(e,n.classes().getOr([])),ci(e,n.styles().getOr({})),go(e,n.innerHtml().getOr(""));var t=Mf(n);return Le(e,t),n.value().each((function(n){Bs(e,n)})),e},Ff=function(n){var e=br(n);return Af(e)},Rf=function(n){return function(n,e){return function(n,e){var t=bn(e,(function(n){return Qt(n.name(),[qt("config"),nr("state",Mr)])})),r=Ht("component.behaviours",At(t),n.behaviours).fold((function(e){throw new Error($t(e)+"\nComplete spec:\n"+Tt(n,null,2))}),(function(n){return n}));return{list:e,data:D(r,(function(n){var e=n().map((function(n){return{config:n.config(),state:n.state().init(n.config())}}));return function(){return e}}))}}(n,e)}(n,function(n){var e=vt(n,"behaviours").getOr({}),t=xn(E(e),(function(n){return void 0!==e[n]}));return bn(t,(function(n){return e[n].me}))}(n))},Bf=Dr(["getSystem","config","hasConfigured","spec","connect","disconnect","element","syncComponents","readState","components","events"]),Vf=function(n,e,t){var r={"alloy.base.behaviour":Ef(n)};return function(n,e,t,r){var o=function(n,e,t){var r=x(t,function(n,e){var t={};return wn(n,(function(n){t[n.name()]=n.handlers(e)})),t}(e,n));return yf(r,Sf)}(n,t,r);return kf(o,e)}(t,n.eventOrder(),e,r).getOrDie()},Nf=function(n){var e=function(){return d},t=eo(hf(e)),o=zt(function(n){return Ht("custom.definition",Mt([Vt("dom","dom",rt(),Mt([qt("tag"),nr("styles",{}),nr("classes",[]),nr("attributes",{}),Jt("value"),Jt("innerHtml")])),qt("components"),qt("uid"),nr("events",{}),nr("apis",r({})),Vt("eventOrder","eventOrder",tt({"alloy.execute":["disabling","alloy.base.behaviour","toggling"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing"]}),Ut()),Jt("domModification"),Ro("originalSpec"),nr("debug.sketcher","unknown")]),n)}(x(n,{behaviours:void 0}))),i=Rf(n),u=function(n){return n.list}(i),c=function(n){return n.data}(i),a=function(n,e,t){var r,o,i,u,c=function(n){var e={tag:n.dom().tag(),classes:n.dom().classes(),attributes:x(Cf(n),n.dom().attributes()),styles:n.dom().styles(),domChildren:bn(n.components(),(function(n){return n.element()}))};return br(x(e,n.dom().innerHtml().map((function(n){return pt("innerHtml",n)})).getOr({}),n.dom().value().map((function(n){return pt("value",n)})).getOr({})))}(n);return i=function(n,e,t,r){var o=x({},e);wn(t,(function(e){o[e.name()]=e.exhibit(n,r)}));var i=yf(o,(function(n,e){return{name:function(){return n},modification:e}})),u=D(i,(function(n,e){return En(n,(function(n){return n.modification().fold((function(){return[]}),(function(e){return[n]}))}))})),c=A(u,(function(n,e){return vt(xf,e).fold((function(){return Qe.error("Unknown field type: "+e)}),(function(t){return t(n,e)}))}));return yt(c,{}).map(wr)}(t,{"alloy.base.modification":(r=n,r.domModification().fold((function(){return wr({})}),wr))},e,c).getOrDie(),u=x({tag:(o=c).tag(),classes:i.classes().getOr([]).concat(o.classes().getOr([])),attributes:T(o.attributes().getOr({}),i.attributes().getOr({})),styles:T(o.styles().getOr({}),i.styles().getOr({}))},i.innerHtml().or(o.innerHtml()).map((function(n){return pt("innerHtml",n)})).getOr({}),xr("domChildren",i.domChildren(),o.domChildren()),xr("defChildren",i.defChildren(),o.defChildren()),i.value().or(o.value()).map((function(n){return pt("value",n)})).getOr({})),br(u)}(o,u,c),s=Af(a),f=Vf(o,u,c),l=eo(o.components()),d=Bf({getSystem:t.get,config:function(e){if(e===oa())return o.apis();if(m(e))throw new Error("Invalid input: only API constant is allowed");var t=c;return(h(t[e.name()])?t[e.name()]:function(){throw new Error("Could not find "+e.name()+" in "+Tt(n,null,2))})()},hasConfigured:function(n){return h(c[n.name()])},spec:r(n),readState:function(n){return c[n]().map((function(n){return n.state.readState()})).getOr("not enabled")},connect:function(n){t.set(n)},disconnect:function(){t.set(hf(e))},element:r(s),syncComponents:function(){var n=je(s),e=En(n,(function(n){return t.get().getByDom(n).fold((function(){return[]}),(function(n){return[n]}))}));l.set(e)},components:l.get,events:r(f)});return d},_f=function(n){var e=ce(n);return jf({element:e})},jf=function(n){var t=Pt("external.component",Mt([qt("element"),Jt("uid")]),n),o=eo(hf());t.uid().each((function(n){!function(n,e){jr(n,aa,e)}(t.element(),n)}));var i=Bf({getSystem:o.get,config:C.none,hasConfigured:r(!1),connect:function(n){o.set(n)},disconnect:function(){o.set(hf((function(){return i})))},element:r(t.element()),spec:r(n),readState:r("No state"),syncComponents:e,components:r([]),events:r({})});return ta(i)},Hf=function(n){return function(n){return vt(n,na)}(n).fold((function(){return function(n){var e=vf(n),t=function(n){var e=gt("components",[])(n);return bn(e,Hf)}(e),r=x(gf,e,pt("components",t));return Qe.value(Nf(r))}(x({uid:fa("")},n)).getOrDie()}),(function(n){return n}))},zf=ta,Lf="alloy.item-hover",Pf="alloy.item-focus",$f=function(n){(ao(n.element()).isNone()||ri.isFocused(n))&&(ri.isFocused(n)||ri.focus(n),ne(n,Lf,{item:n}))},Wf=function(n){ne(n,Pf,{item:n})},Uf=r(Lf),Gf=r(Pf),qf=[qt("data"),qt("components"),qt("dom"),Jt("toggling"),nr("itemBehaviours",{}),nr("ignoreFocus",!1),nr("domModification",{}),Fo("builder",(function(n){return{dom:x(n.dom(),{attributes:{role:n.toggling().isSome()?"menuitemcheckbox":"menuitem"}}),behaviours:x(Fr([n.toggling().fold(qo.revoke,(function(n){return qo.config(x({aria:{mode:"checked"}},n))})),ri.config({ignore:n.ignoreFocus(),onFocus:function(n){Wf(n)}}),wc.config({mode:"execution"}),Xa.config({store:{mode:"memory",initialValue:n.data()}})]),n.itemBehaviours()),events:or([fr(qn(),ee),lr(V()),ur(j(),$f),ur(Un(),ri.focus)]),components:n.components(),domModification:n.domModification(),eventOrder:n.eventOrder()}})),nr("eventOrder",{})],Yf=[qt("dom"),qt("components"),Fo("builder",(function(n){return{dom:n.dom(),components:n.components(),events:or([dr(Un())])}}))],Kf=r([$c({name:"widget",overrides:function(n){return{behaviours:Fr([Xa.config({store:{mode:"manual",getValue:function(e){return n.data()},setValue:function(){}}})])}}})]),Xf=[qt("uid"),qt("data"),qt("components"),qt("dom"),nr("autofocus",!1),nr("domModification",{}),Zc(Kf()),Fo("builder",(function(n){var e=Kc(0,n,Kf()),t=Xc("item-widget",n,e.internals()),r=function(e){return Jc(e,n,"widget").map((function(n){return wc.focusIn(n),n}))},o=function(e,t){return Yi(t.event().target())?C.none():n.autofocus()?(t.setSource(e.element()),C.none()):C.none()};return x({dom:n.dom(),components:t,domModification:n.domModification(),events:or([pr((function(n,e){r(n).each((function(n){e.stop()}))})),ur(j(),$f),ur(Un(),(function(e,t){n.autofocus()?r(e):ri.focus(e)}))]),behaviours:Fr([Xa.config({store:{mode:"memory",initialValue:n.data()}}),ri.config({onFocus:function(n){Wf(n)}}),wc.config({mode:"special",focusIn:n.autofocus()?function(n){r(n)}:Nr(),onLeft:o,onRight:o,onEscape:function(e,t){return ri.isFocused(e)||n.autofocus()?n.autofocus()?(t.setSource(e.element()),C.none()):C.none():(ri.focus(e),C.some(!0))}})])})}))],Jf=Wt("type",{widget:Xf,item:qf,separator:Yf}),Qf=r([Uc({factory:{sketch:function(n){var e=Pt("menu.spec item",Jf,n);return e.builder()(e)}},name:"items",unit:"item",defaults:function(n,e){var t=fa("");return x({uid:t},e)},overrides:function(n,e){return{type:e.type,ignoreFocus:n.fakeFocus(),domModification:{classes:[n.markers().item()]}}}})]),Zf=r([qt("value"),qt("items"),qt("dom"),qt("components"),nr("eventOrder",{}),xc("menuBehaviours",[Pi,Xa,Ms,wc]),er("movement",{mode:"menu",moveOnTab:!0},Wt("mode",{grid:[Bo(),Fo("config",(function(n,e){return{mode:"flatgrid",selector:"."+n.markers().item(),initSize:{numColumns:e.initSize().numColumns(),numRows:e.initSize().numRows()},focusManager:n.focusManager()}}))],menu:[nr("moveOnTab",!0),Fo("config",(function(n,e){return{mode:"menu",selector:"."+n.markers().item(),moveOnTab:e.moveOnTab(),focusManager:n.focusManager()}}))]})),Yt("markers",ko()),nr("fakeFocus",!1),nr("focusManager",$i()),Io("onHighlight")]),nl=r("alloy.menu-focus"),el=ha({name:"Menu",configFields:Zf(),partFields:Qf(),factory:function(n,e,t,r){return x({dom:x(n.dom(),{attributes:{role:"menu"}}),uid:n.uid(),behaviours:x(Fr([Pi.config({highlightClass:n.markers().selectedItem(),itemClass:n.markers().item(),onHighlight:n.onHighlight()}),Xa.config({store:{mode:"memory",initialValue:n.value()}}),Ms.config({find:C.some}),wc.config(n.movement().config()(n,n.movement()))]),Tc(n.menuBehaviours())),events:or([ur(Gf(),(function(n,e){var t=e.event();n.getSystem().getByDom(t.target()).each((function(t){Pi.highlight(n,t),e.stop(),ne(n,nl(),{menu:n,item:t})}))})),ur(Uf(),(function(n,e){var t=e.event().item();Pi.highlight(n,t)}))]),components:e,eventOrder:n.eventOrder()})}}),tl=function(n,e,t,r){var o=n.getSystem().build(r);qe(n,o,t)},rl=function(n,e){return n.components()},ol=Br({fields:[],name:"replacing",apis:Object.freeze({append:function(n,e,t,r){tl(n,0,ze,r)},prepend:function(n,e,t,r){tl(n,0,He,r)},remove:function(n,e,t,r){var o=rl(n);On(o,(function(n){return Be(r.element(),n.element())})).each(Ke)},set:function(n,t,r,o){var i,u,c,a;!function(n){var e=n.components();wn(e,Ye),Pe(n.element()),n.syncComponents()}(n),i=function(){var e=bn(o,n.getSystem().build);wn(e,(function(e){Ge(n,e)}))},u=n.element(),c=Ve(u),a=co(c).bind((function(n){var e,t,r=function(e){return Be(n,e)};return r(u)?C.some(u):(e=r,(t=function(n){for(var r=0;r<n.childNodes.length;r++){var o=ae(n.childNodes[r]);if(e(o))return C.some(o);var i=t(n.childNodes[r]);if(i.isSome())return i}return C.none()})(u.dom()))})),i(u),a.each((function(n){co(c).filter((function(e){return Be(e,n)})).fold((function(){io(n)}),e)}))},contents:rl})}),il=function(n,e,t,r){return vt(t,r).bind((function(r){return vt(n,r).bind((function(r){var o=il(n,e,t,r);return C.some([r].concat(o))}))})).getOr([])},ul=function(){var n=eo({}),e=eo({}),t=eo({}),r=eo(C.none()),o=eo({}),i=function(n){return vt(e.get(),n)};return{setContents:function(i,u,c,a){r.set(C.some(i)),n.set(c),e.set(u),o.set(a);var s=function(n,e){var t={};I(n,(function(n,e){wn(n,(function(n){t[n]=e}))}));var r=e,o=M(e,(function(n,e){return{k:n,v:e}})),i=D(o,(function(n,e){return[e].concat(il(t,r,o,e))}));return D(t,(function(n){return vt(i,n).getOr([n])}))}(a,c);t.set(s)},expand:function(e){return vt(n.get(),e).map((function(n){var r=vt(t.get(),e).getOr([]);return[n].concat(r)}))},refresh:function(n){return vt(t.get(),n)},collapse:function(n){return vt(t.get(),n).bind((function(n){return n.length>1?C.some(n.slice(1)):C.none()}))},lookupMenu:i,otherMenus:function(n){var e,t,r=o.get();return e=E(r),t=n,xn(e,(function(n){return!yn(t,n)}))},getPrimary:function(){return r.get().bind(i)},getMenus:function(){return e.get()},clear:function(){n.set({}),e.set({}),t.set({}),r.set(C.none())},isClear:function(){return r.get().isNone()}}},cl=r("collapse-item"),al=pa({name:"TieredMenu",configFields:[Ao("onExecute"),Ao("onEscape"),Mo("onOpenMenu"),Mo("onOpenSubmenu"),Io("onCollapseMenu"),nr("openImmediately",!0),Xt("data",[qt("primary"),qt("menus"),qt("expansions")]),nr("fakeFocus",!1),Io("onHighlight"),Io("onHover"),Xt("markers",[qt("backgroundMenu")].concat(So()).concat(Oo())),qt("dom"),nr("navigateOnHover",!0),nr("stayInDom",!1),xc("tmenuBehaviours",[wc,Pi,Ms,ol]),nr("eventOrder",{})],apis:{collapseMenu:function(n,e){n.collapseMenu(e)}},factory:function(n,t){var r=ul(),o=function(n){return Xa.getValue(n).value},i=function(e){return D(n.data().menus(),(function(n,e){return En(n.items,(function(n){return"separator"===n.type?[]:[n.data.value]}))}))},u=function(n,e){Pi.highlight(n,e),Pi.getHighlighted(e).orThunk((function(){return Pi.getFirst(e)})).each((function(e){te(n,e.element(),Un())}))},c=function(n,e){return yo(bn(e,n.lookupMenu))},a=function(e,t,r){return C.from(r[0]).bind(t.lookupMenu).map((function(o){var i=c(t,r.slice(1));wn(i,(function(e){Yr(e.element(),n.markers().backgroundMenu())})),ye(o.element())||ol.append(e,zf(o)),Df(o.element(),[n.markers().backgroundMenu()]),u(e,o);var a=c(t,t.otherMenus(r));return wn(a,(function(t){Df(t.element(),[n.markers().backgroundMenu()]),n.stayInDom()||ol.remove(e,t)})),o}))},s=function(e,t){var i=o(t);return r.expand(i).bind((function(o){return C.from(o[0]).bind(r.lookupMenu).each((function(r){ye(r.element())||ol.append(e,zf(r)),n.onOpenSubmenu()(e,t,r),Pi.highlightFirst(r)})),a(e,r,o)}))},f=function(e,t){var i=o(t);return r.collapse(i).bind((function(o){return a(e,r,o).map((function(r){return n.onCollapseMenu()(e,t,r),r}))}))},l=function(e){return function(t,r){return xi(r.getSource(),"."+n.markers().item()).bind((function(n){return t.getSystem().getByDom(n).toOption().bind((function(n){return e(t,n).map((function(){return!0}))}))}))}},d=or([ur(nl(),(function(n,e){var t=e.event().menu();Pi.highlight(n,t)})),pr((function(e,t){var r=t.event().target();e.getSystem().getByDom(r).each((function(t){0===o(t).indexOf("collapse-item")&&f(e,t),s(e,t).fold((function(){n.onExecute()(e,t)}),(function(){}))}))})),mr((function(o,c){(function(o){var u=function(r,o){return D(o,(function(o,i){var u,c,a=el.sketch(x(o,{value:i,items:o.items,markers:(u=t.markers,c=["item","selectedItem"],function(n,e){var t={};return wn(e,(function(e){void 0!==n[e]&&n.hasOwnProperty(e)&&(t[e]=n[e])})),t}(u,c)),fakeFocus:n.fakeFocus(),onHighlight:n.onHighlight(),focusManager:n.fakeFocus()?{get:function(n){return Pi.getHighlighted(n).map((function(n){return n.element()}))},set:function(n,t){n.getSystem().getByDom(t).fold(e,(function(e){Pi.highlight(n,e)}))}}:$i()}));return r.getSystem().build(a)}))}(o,n.data().menus()),c=i();return r.setContents(n.data().primary(),u,n.data().expansions(),c),r.getPrimary()})(o).each((function(e){ol.append(o,zf(e)),n.openImmediately()&&(u(o,e),n.onOpenMenu()(o,e))}))}))].concat(n.navigateOnHover()?[ur(Uf(),(function(e,t){var i=t.event().item();!function(n,e){var t=o(e);r.refresh(t).bind((function(e){return a(n,r,e)}))}(e,i),s(e,i),n.onHover()(e,i)}))]:[]));return{uid:n.uid(),dom:n.dom(),behaviours:x(Fr([wc.config({mode:"special",onRight:l((function(n,e){return Yi(e.element())?C.none():s(n,e)})),onLeft:l((function(n,e){return Yi(e.element())?C.none():f(n,e)})),onEscape:l((function(e,t){return f(e,t).orThunk((function(){return n.onEscape()(e,t).map((function(){return e}))}))})),focusIn:function(n,e){r.getPrimary().each((function(e){te(n,e.element(),Un())}))}}),Pi.config({highlightClass:n.markers().selectedMenu(),itemClass:n.markers().menu()}),Ms.config({find:function(n){return Pi.getHighlighted(n)}}),ol.config({})]),Tc(n.tmenuBehaviours())),eventOrder:n.eventOrder(),apis:{collapseMenu:function(n){Pi.getHighlighted(n).each((function(e){Pi.getHighlighted(e).each((function(e){f(n,e)}))}))}},events:d}},extraApis:{tieredData:function(n,e,t){return{primary:n,menus:e,expansions:t}},singleData:function(n,e){return{primary:n,menus:pt(n,e),expansions:{}}},collapseItem:function(n){return{value:Mc(cl()),text:n}}}}),sl=function(n,e,t,r){return vt(e.routes(),r.start()).map(s).bind((function(n){return vt(n,r.destination()).map(s)}))},fl=function(n,e,t,o){return sl(0,e,0,o).bind((function(n){return n.transition().map((function(e){return{transition:r(e),route:r(n)}}))}))},ll=function(n,e,t){(function(n,e,t){return dl(n,e).bind((function(n){return fl(0,e,0,n)}))})(n,e).each((function(t){var r=t.transition();Kr(n.element(),r.transitionClass()),Pr(n.element(),e.destinationAttr())}))},dl=function(n,e,t){var o=n.element();return Lr(o,e.destinationAttr())?C.some({start:r(zr(n.element(),e.stateAttr())),destination:r(zr(n.element(),e.destinationAttr()))}):C.none()},ml=function(n,e,t,r){ll(n,e),Lr(n.element(),e.stateAttr())&&zr(n.element(),e.stateAttr())!==r&&e.onFinish()(n,r),jr(n.element(),e.stateAttr(),r)},gl=Object.freeze({findRoute:sl,disableTransition:ll,getCurrentRoute:dl,jumpTo:ml,progressTo:function(n,e,t,o){!function(n,e,t,r){Lr(n.element(),e.destinationAttr())&&(jr(n.element(),e.stateAttr(),zr(n.element(),e.destinationAttr())),Pr(n.element(),e.destinationAttr()))}(n,e);var i=function(n,e,t,o){return{start:r(zr(n.element(),e.stateAttr())),destination:r(o)}}(n,e,0,o);fl(0,e,0,i).fold((function(){ml(n,e,0,o)}),(function(t){ll(n,e);var r=t.transition();Yr(n.element(),r.transitionClass()),jr(n.element(),e.destinationAttr(),o)}))},getState:function(n,e,t){var r=n.element();return Lr(r,e.stateAttr())?C.some(zr(r,e.stateAttr())):C.none()}}),vl=Object.freeze({events:function(n,e){return or([ur($(),(function(e,t){var r=t.event().raw();dl(e,n).each((function(t){sl(0,n,0,t).each((function(o){o.transition().each((function(o){r.propertyName===o.property()&&(ml(e,n,0,t.destination()),n.onTransition()(e,t))}))}))}))})),mr((function(e,t){ml(e,n,0,n.initialState())}))])}}),pl=[nr("destinationAttr","data-transitioning-destination"),nr("stateAttr","data-transitioning-state"),qt("initialState"),Io("onTransition"),Io("onFinish"),Yt("routes",Ft(Qe.value,Ft(Qe.value,Mt([Zt("transition",[qt("property"),qt("transitionClass")])]))))],hl=Br({fields:pl,name:"transitioning",active:vl,apis:gl,extra:{createRoutes:function(n){var e={};return I(n,(function(n,t){var r=t.split("<->");e[r[0]]=pt(r[1],n),e[r[1]]=pt(r[0],n)})),e},createBistate:function(n,e,t){return ht([{key:n,value:pt(e,t)},{key:e,value:pt(n,t)}])},createTristate:function(n,e,t,r){return ht([{key:n,value:ht([{key:e,value:r},{key:t,value:r}])},{key:e,value:ht([{key:n,value:r},{key:t,value:r}])},{key:t,value:ht([{key:n,value:r},{key:e,value:r}])}])}}}),yl=Qo.resolve("scrollable"),bl={register:function(n){Yr(n,yl)},deregister:function(n){Kr(n,yl)},scrollable:r(yl)},wl=function(n){return vt(n,"format").getOr(n.title)},xl=function(n,e,t,r,o){return{data:{value:n,text:e},type:"item",dom:{tag:"div",classes:o?[Qo.resolve("styles-item-is-menu")]:[]},toggling:{toggleOnExecute:!1,toggleClass:Qo.resolve("format-matches"),selected:t},itemBehaviours:Fr(o?[]:[Yo(n,(function(n,e){(e?qo.on:qo.off)(n)}))]),components:[{dom:{tag:"div",attributes:{style:r},innerHtml:e}}]}},Tl=function(n,e,t,r){return{value:n,dom:{tag:"div"},components:[ya.sketch({dom:{tag:"div",classes:[Qo.resolve("styles-collapser")]},components:r?[{dom:{tag:"span",classes:[Qo.resolve("styles-collapse-icon")]}},_f(n)]:[_f(n)],action:function(n){if(r){var e=t().get(n);al.collapseMenu(e)}}}),{dom:{tag:"div",classes:[Qo.resolve("styles-menu-items-container")]},components:[el.parts().items({})],behaviours:Fr([Es("adhoc-scrollable-menu",[mr((function(n,e){ui(n.element(),"overflow-y","auto"),ui(n.element(),"-webkit-overflow-scrolling","touch"),bl.register(n.element())})),gr((function(n){li(n.element(),"overflow-y"),li(n.element(),"-webkit-overflow-scrolling"),bl.deregister(n.element())}))])])}],items:e,menuBehaviours:Fr([hl.config({initialState:"after",routes:hl.createTristate("before","current","after",{transition:{property:"transform",transitionClass:"transitioning"}})})])}},Sl=function(n){return bt(n,"items")?function(n){var e=x(function(n,e){var t={};return I(n,(function(n,r){yn(e,r)||(t[r]=n)})),t}(n,["items"]),{menu:!0}),t=Ol(n.items);return{item:e,menus:x(t.menus,pt(n.title,t.items)),expansions:x(t.expansions,pt(n.title,n.title))}}(n):{item:n,menus:{},expansions:{}}},Ol=function(n){return Tn(n,(function(n,e){var t=Sl(e);return{menus:x(n.menus,t.menus),items:[t.item].concat(n.items),expansions:x(n.expansions,t.expansions)}}),{menus:{},expansions:{},items:[]})},kl={expand:Ol},Cl=function(n,e,t){return function(n){var e,t,r,o,i,u=(e=n.formats,t=function(){return c},r=Tl("Styles",[].concat(bn(e.items,(function(n){return xl(wl(n),n.title,n.isSelected(),n.getPreview(),bt(e.expansions,wl(n)))}))),t,!1),o=D(e.menus,(function(n,r){var o=bn(n,(function(n){return xl(wl(n),n.title,void 0!==n.isSelected&&n.isSelected(),void 0!==n.getPreview?n.getPreview():"",bt(e.expansions,wl(n)))}));return Tl(r,o,t,!0)})),i=x(o,pt("styles",r)),{tmenu:al.tieredData("styles",i,e.expansions)}),c=vs(al.sketch({dom:{tag:"div",classes:[Qo.resolve("styles-menu")]},components:[],fakeFocus:!0,stayInDom:!0,onExecute:function(e,t){var r=Xa.getValue(t);return n.handle(t,r.value),C.none()},onEscape:function(){return C.none()},onOpenMenu:function(n,e){var t=es(n.element());ns(e.element(),t),hl.jumpTo(e,"current")},onOpenSubmenu:function(n,e,t){var r=es(n.element()),o=bi(e.element(),'[role="menu"]').getOrDie("hacky"),i=n.getSystem().getByDom(o).getOrDie();ns(t.element(),r),hl.progressTo(i,"before"),hl.jumpTo(t,"after"),hl.progressTo(t,"current")},onCollapseMenu:function(n,e,t){var r=bi(e.element(),'[role="menu"]').getOrDie("hacky"),o=n.getSystem().getByDom(r).getOrDie();hl.progressTo(o,"after"),hl.progressTo(t,"current")},navigateOnHover:!1,openImmediately:!0,data:u.tmenu,markers:{backgroundMenu:Qo.resolve("styles-background-menu"),menu:Qo.resolve("styles-menu"),selectedMenu:Qo.resolve("styles-selected-menu"),item:Qo.resolve("styles-item"),selectedItem:Qo.resolve("styles-selected-item")}}));return c.asSpec()}({formats:function(n,e){var t=function(e){return En(e,(function(e){return void 0!==e.items?t(e.items).length>0?[e]:[]:!bt(e,"format")||n.formatter.canApply(e.format)?[e]:[]}))},r=t(e);return kl.expand(r)}(n,e),handle:function(e,r){n.undoManager.transact((function(){qo.isOn(e)?n.formatter.remove(r):n.formatter.apply(r)})),t()}})},El=["undo","bold","italic","link","image","bullist","styleselect"],Il=function(n){var e=n.replace(/\|/g," ").trim();return e.length>0?e.split(/\s+/):[]},Dl=function(n){return En(n,(function(n){return v(n)?Dl(n):Il(n)}))},Ml=function(n,e){var t=function(n){return function(){return ka(e,n)}},o=function(n){return function(){return Ea(e,n)}},i=function(n,t,r){return function(){return Ca(e,n,t,r)}},u=t("undo"),c=t("redo"),a=o("bold"),f=o("italic"),l=o("underline"),d=t("removeformat"),m=i("unlink","link",(function(){e.execCommand("unlink",null,!1)})),g=i("unordered-list","ul",(function(){e.execCommand("InsertUnorderedList",null,!1)})),v=i("ordered-list","ol",(function(){e.execCommand("InsertOrderedList",null,!1)})),p=function(n,e){var t=function(e){return function(){return n.formatter.match(e)}},o=function(e){return function(){return n.formatter.getCssText(e)}},i=vt(e,"style_formats").getOr(df),u=function(e){return bn(e,(function(e){if(bt(e,"items")){var i=u(e.items);return x(function(n){return x(n,{isSelected:r(!1),getPreview:r("")})}(e),{items:i})}return bt(e,"format")?function(n){return x(n,{isSelected:t(n.format),getPreview:o(n.format)})}(e):function(e){var r=Mc(e.title),i=x(e,{format:r,isSelected:t(r),getPreview:o(r)});return n.formatter.register(r,i),i}(e)}))};return u(i)}(e,e.settings),h=function(){return Cl(e,p,(function(){e.fire("scrollIntoView")}))},y=function(n,t){return{isSupported:function(){return n.forall((function(n){return bt(e.buttons,n)}))},sketch:t}};return{undo:y(C.none(),u),redo:y(C.none(),c),bold:y(C.none(),a),italic:y(C.none(),f),underline:y(C.none(),l),removeformat:y(C.none(),d),link:y(C.none(),(function(){return function(n,e){return Ca(e,"link","link",(function(){var t=lf(n,e);n.setContextToolbar(t),function(n,e){(ks.os.isAndroid()?Cs:s)(e,n)}(e,(function(){n.focusToolbar()})),Os(e).each((function(n){e.selection.select(n.dom())}))}))}(n,e)})),unlink:y(C.none(),m),image:y(C.none(),(function(){return function(n){var e=vs({dom:{tag:"input",attributes:{accept:"image/*",type:"file",title:""},styles:{visibility:"hidden",position:"absolute"}},events:or([lr(P()),ur(L(),(function(e,t){(function(n){var e=n.event(),t=e.raw().target.files||e.raw().dataTransfer.files;return C.from(t[0])})(t).each((function(e){hs(n,e)}))}))])});return ya.sketch({dom:wa('<span class="${prefix}-toolbar-button ${prefix}-icon-image ${prefix}-icon"></span>'),components:[e.asSpec()],action:function(n){e.get(n).element().dom().click()}})}(e)})),bullist:y(C.some("bullist"),g),numlist:y(C.some("numlist"),v),fontsizeselect:y(C.none(),(function(){return function(n,e){var t={onChange:function(n){ls.apply(e,n)},getInitialValue:function(){return ls.get(e)}};return os(n,"font-size",(function(){return gs(t)}))}(n,e)})),forecolor:y(C.none(),(function(){return us(n,e)})),styleselect:y(C.none(),(function(){return Oa("style-formats",(function(t){e.fire("toReading"),n.dropup().appear(h,qo.on,t)}),Fr([qo.config({toggleClass:Qo.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),No.config({channels:ht([Xo(lo.orientationChanged(),qo.off),Xo(lo.dropupDismissed(),qo.off)])})]))}))}},Al=function(n,e){var t=function(n){var e=void 0!==n.toolbar?n.toolbar:El;return v(e)?Dl(e):Il(e)}(n),r={};return En(t,(function(n){var t=!bt(r,n)&&bt(e,n)&&e[n].isSupported()?[e[n].sketch()]:[];return r[n]=!0,t}))},Fl=function(n,e,o,u,c){var a=function(n,e){return function(o){if(n(o)){var i=ae(o.target),u=function(){o.stopPropagation()},c=function(){o.preventDefault()},a=t(c,u),s=function(n,e,t,o,i,u,c){return{target:r(n),x:r(e),y:r(t),stop:o,prevent:i,kill:u,raw:r(c)}}(i,o.clientX,o.clientY,u,c,a,o);e(s)}}}(o,u);return n.dom().addEventListener(e,a,c),{unbind:i(Rl,n,e,a,c)}},Rl=function(n,e,t,r){n.dom().removeEventListener(e,t,r)},Bl=r(!0),Vl=function(n,e,t){return function(n,e,t,r){return Fl(n,e,t,r,!1)}(n,e,Bl,t)},Nl=function(n,e,t){return function(n,e,t,r){return Fl(n,e,t,r,!0)}(n,e,Bl,t)},_l=function(n){var e=n.matchMedia("(orientation: portrait)").matches;return{isPortrait:r(e)}},jl=_l,Hl=function(n,e){var t=ae(n),r=null,o=Vl(t,"orientationchange",(function(){clearInterval(r);var t=_l(n);e.onChange(t),i((function(){e.onReady(t)}))})),i=function(e){clearInterval(r);var t=n.innerHeight,o=0;r=setInterval((function(){t!==n.innerHeight?(clearInterval(r),e(C.some(n.innerHeight))):o>20&&(clearInterval(r),e(C.none())),o++}),50)};return{onAdjustment:i,destroy:function(){o.unbind()}}},zl=function(n){var e=Hn.detect().os.isiOS(),t=_l(n).isPortrait();return e&&!t?n.screen.height:n.screen.width},Ll=function(n){var e=n.raw();return void 0===e.touches||1!==e.touches.length?C.none():C.some(e.touches[0])},Pl=function(e){var t,o,i=eo(C.none()),u=(t=function(n){i.set(C.none()),e.triggerEvent(Yn(),n)},400,o=null,{cancel:function(){null!==o&&(n.clearTimeout(o),o=null)},schedule:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];o=n.setTimeout((function(){t.apply(null,e),o=null}),400)}}),c=ht([{key:F(),value:function(n){return Ll(n).each((function(e){u.cancel();var t={x:r(e.clientX),y:r(e.clientY),target:n.target};u.schedule(n),i.set(C.some(t))})),C.none()}},{key:R(),value:function(n){return u.cancel(),Ll(n).each((function(n){i.get().each((function(e){(function(n,e){var t=Math.abs(n.clientX-e.x()),r=Math.abs(n.clientY-e.y());return t>5||r>5})(n,e)&&i.set(C.none())}))})),C.none()}},{key:B(),value:function(n){return u.cancel(),i.get().filter((function(e){return Be(e.target(),n.target())})).map((function(t){return e.triggerEvent(Gn(),n)}))}}]);return{fireIfReady:function(n,e){return vt(c,e).bind((function(e){return e(n)}))}}},$l=function(n){var e=Pl({triggerEvent:function(e,t){n.onTapContent(t)}});return{fireTouchstart:function(n){e.fireIfReady(n,"touchstart")},onTouchend:function(){return Vl(n.body(),"touchend",(function(n){e.fireIfReady(n,"touchend")}))},onTouchmove:function(){return Vl(n.body(),"touchmove",(function(n){e.fireIfReady(n,"touchmove")}))}}},Wl=Hn.detect().os.version.major>=6,Ul=function(n,e){var t=parseInt(zr(n,e),10);return isNaN(t)?0:t},Gl=function(n,e){var t=function(e){return n(e)?C.from(e.dom().nodeValue):C.none()};return{get:function(e){if(!n(e))throw new Error("Can only get text value of a text node");return t(e).getOr("")},getOption:t,set:function(e,t){if(!n(e))throw new Error("Can only set raw text value of a text node");e.dom().nodeValue=t}}}(he),ql={create:xe("start","soffset","finish","foffset")},Yl=Ze([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Kl={before:Yl.before,on:Yl.on,after:Yl.after,cata:function(n,e,t,r){return n.fold(e,t,r)},getStart:function(n){return n.fold(o,o,o)}},Xl=Ze([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Jl={domRange:Xl.domRange,relative:Xl.relative,exact:Xl.exact,exactFromRange:function(n){return Xl.exact(n.start(),n.soffset(),n.finish(),n.foffset())},getWin:function(n){var e=function(n){return n.match({domRange:function(n){return ae(n.startContainer)},relative:function(n,e){return Kl.getStart(n)},exact:function(n,e,t,r){return n}})}(n);return Ne(e)},range:ql.create},Ql=function(n,e,t){var r,o=n.document.createRange();return r=o,e.fold((function(n){r.setStartBefore(n.dom())}),(function(n,e){r.setStart(n.dom(),e)}),(function(n){r.setStartAfter(n.dom())})),function(n,e){e.fold((function(e){n.setEndBefore(e.dom())}),(function(e,t){n.setEnd(e.dom(),t)}),(function(e){n.setEndAfter(e.dom())}))}(o,t),o},Zl=function(n,e,t,r,o){var i=n.document.createRange();return i.setStart(e.dom(),t),i.setEnd(r.dom(),o),i},nd=function(n){return{left:r(n.left),top:r(n.top),right:r(n.right),bottom:r(n.bottom),width:r(n.width),height:r(n.height)}},ed=Ze([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),td=function(n,e,t){return e(ae(t.startContainer),t.startOffset,ae(t.endContainer),t.endOffset)},rd=function(n,e){return t=function(n,e){return e.match({domRange:function(n){return{ltr:r(n),rtl:C.none}},relative:function(e,t){return{ltr:U((function(){return Ql(n,e,t)})),rtl:U((function(){return C.some(Ql(n,t,e))}))}},exact:function(e,t,r,o){return{ltr:U((function(){return Zl(n,e,t,r,o)})),rtl:U((function(){return C.some(Zl(n,r,o,e,t))}))}}})}(n,e),(o=t.ltr()).collapsed?t.rtl().filter((function(n){return!1===n.collapsed})).map((function(n){return ed.rtl(ae(n.endContainer),n.endOffset,ae(n.startContainer),n.startOffset)})).getOrThunk((function(){return td(0,ed.ltr,o)})):td(0,ed.ltr,o);var t,o},od=function(n,e){var t=ge(n);return"input"===t?Kl.after(n):yn(["br","img"],t)?0===e?Kl.before(n):Kl.after(n):Kl.on(n,e)},id=function(n,e,t,r,o){!function(n,e){C.from(n.getSelection()).each((function(n){n.removeAllRanges(),n.addRange(e)}))}(n,Zl(n,e,t,r,o))},ud=function(n){var e=ae(n.anchorNode),t=ae(n.focusNode);return function(n,e,t,r){var o=function(n,e,t,r){var o=Ve(n).dom().createRange();return o.setStart(n.dom(),e),o.setEnd(t.dom(),r),o}(n,e,t,r),i=Be(n,t)&&e===r;return o.collapsed&&!i}(e,n.anchorOffset,t,n.focusOffset)?C.some(ql.create(e,n.anchorOffset,t,n.focusOffset)):function(n){if(n.rangeCount>0){var e=n.getRangeAt(0),t=n.getRangeAt(n.rangeCount-1);return C.some(ql.create(ae(e.startContainer),e.startOffset,ae(t.endContainer),t.endOffset))}return C.none()}(n)},cd=function(n){return C.from(n.getSelection()).filter((function(n){return n.rangeCount>0})).bind(ud)},ad=function(n,e){return t=function(n,e){return rd(n,e).match({ltr:function(e,t,r,o){var i=n.document.createRange();return i.setStart(e.dom(),t),i.setEnd(r.dom(),o),i},rtl:function(e,t,r,o){var i=n.document.createRange();return i.setStart(r.dom(),o),i.setEnd(e.dom(),t),i}})}(n,e),r=t.getClientRects(),(o=r.length>0?r[0]:t.getBoundingClientRect()).width>0||o.height>0?C.some(o).map(nd):C.none();var t,r,o},sd=function(n){return{left:n.left,top:n.top,right:n.right,bottom:n.bottom,width:r(2),height:n.height}},fd=function(n){return{left:r(n.left),top:r(n.top),right:r(n.right),bottom:r(n.bottom),width:r(n.width),height:r(n.height)}},ld=function(n){var e=n.getSelection();return void 0!==e&&e.rangeCount>0?function(n){if(n.collapsed){var e=ae(n.startContainer);return _e(e).bind((function(t){var r=Jl.exact(e,n.startOffset,t,function(n){return"img"===ge(n)?1:function(n){return Gl.getOption(n)}(n).fold((function(){return je(n).length}),(function(n){return n.length}))}(t));return ad(n.startContainer.ownerDocument.defaultView,r).map(sd).map(Mn)})).getOr([])}return bn(n.getClientRects(),fd)}(e.getRangeAt(0)):[]},dd="data-"+Qo.resolve("last-outer-height"),md=function(n,e){jr(n,dd,e)},gd=function(n){return{top:r(n.top()),bottom:r(n.top()+n.height())}},vd=function(n,e){var t=ae(e.document.body),r=Vl(ae(n),"resize",(function(){(function(n,e){var t=function(n){return Ul(n,dd)}(e),r=n.innerHeight;return t>r?C.some(t-r):C.none()})(n,t).each((function(n){(function(n){var e=ld(n);return e.length>0?C.some(e[0]).map(gd):C.none()})(e).each((function(t){var r=function(n,e,t){return e.top()>n.innerHeight||e.bottom()>n.innerHeight?Math.min(t,e.bottom()-n.innerHeight+50):0}(e,t,n);0!==r&&e.scrollTo(e.pageXOffset,e.pageYOffset+r)}))})),md(t,n.innerHeight)}));return md(t,n.innerHeight),{toEditing:function(){!function(n){n.focus();var e=ae(n.document.body);(co().exists((function(n){return yn(["input","textarea"],ge(n))}))?function(n){setTimeout((function(){n()}),0)}:s)((function(){co().each(uo),io(e)}))}(e)},destroy:function(){r.unbind()}}},pd=function(n){return C.some(ae(n.dom().contentWindow.document.body))},hd=function(n){return C.some(ae(n.dom().contentWindow.document))},yd=function(n){return C.from(n.dom().contentWindow)},bd=function(n){return yd(n).bind(cd)},wd=function(n){return n.getFrame()},xd=function(n,e){return function(t){return t[n].getOrThunk((function(){var n=wd(t);return function(){return e(n)}}))()}},Td=function(n,e,t,r){return n[t].getOrThunk((function(){return function(n){return Vl(e,r,n)}}))},Sd=function(n){return{left:r(n.left),top:r(n.top),right:r(n.right),bottom:r(n.bottom),width:r(n.width),height:r(n.height)}},Od={getBody:xd("getBody",pd),getDoc:xd("getDoc",hd),getWin:xd("getWin",yd),getSelection:xd("getSelection",bd),getFrame:wd,getActiveApi:function(n){var e=wd(n);return pd(e).bind((function(t){return hd(e).bind((function(o){return yd(e).map((function(u){var c=ae(o.dom().documentElement),a=n.getCursorBox.getOrThunk((function(){return function(){return function(n){return cd(n).map((function(n){return Jl.exact(n.start(),n.soffset(),n.finish(),n.foffset())}))}(u).bind((function(n){return ad(u,n).orThunk((function(){return function(n){return cd(n).filter((function(n){return Be(n.start(),n.finish())&&n.soffset()===n.foffset()})).bind((function(n){var e=n.start().dom().getBoundingClientRect();return e.width>0||e.height>0?C.some(e).map(Sd):C.none()}))}(u)}))}))}})),s=n.setSelection.getOrThunk((function(){return function(n,e,t,r){!function(n,e,t,r,o){!function(n,e){rd(n,e).match({ltr:function(e,t,r,o){id(n,e,t,r,o)},rtl:function(e,t,r,o){var i=n.getSelection();if(i.setBaseAndExtent)i.setBaseAndExtent(e.dom(),t,r.dom(),o);else if(i.extend)try{!function(n,e,t,r,o,i){e.collapse(t.dom(),r),e.extend(o.dom(),i)}(0,i,e,t,r,o)}catch(i){id(n,r,o,e,t)}else id(n,r,o,e,t)}})}(n,function(n,e,t,r){var o=od(n,e),i=od(t,r);return Jl.relative(o,i)}(e,t,r,o))}(u,n,e,t,r)}})),f=n.clearSelection.getOrThunk((function(){return function(){!function(n){n.getSelection().removeAllRanges()}(u)}}));return{body:r(t),doc:r(o),win:r(u),html:r(c),getSelection:i(bd,e),setSelection:s,clearSelection:f,frame:r(e),onKeyup:Td(n,o,"onKeyup","keyup"),onNodeChanged:Td(n,o,"onNodeChanged","selectionchange"),onDomChanged:n.onDomChanged,onScrollToCursor:n.onScrollToCursor,onScrollToElement:n.onScrollToElement,onToReading:n.onToReading,onToEditing:n.onToEditing,onToolbarScrollStart:n.onToolbarScrollStart,onTouchContent:n.onTouchContent,onTapContent:n.onTapContent,onTouchToolstrip:n.onTouchToolstrip,getCursorBox:a}}))}))}))}},kd="data-ephox-mobile-fullscreen-style",Cd="position:absolute!important;",Ed="top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;height:100%!important;overflow:visible!important;",Id=Hn.detect().os.isAndroid(),Dd=function(n,e){var t=function(n){return function(e){var t=zr(e,"style"),r=void 0===t?"no-styles":t.trim();r!==n&&(jr(e,kd,r),jr(e,"style",n))}},r=pi(n,"*"),o=En(r,(function(n){var e;return"*",e=function(n){return Me(n,"*")},xn(function(n){return _e(n).map(je).map((function(e){return xn(e,(function(e){return!Be(n,e)}))})).getOr([])}(n),e)})),i=function(n){var e=ai(n,"background-color");return void 0!==e&&""!==e?"background-color:"+e+"!important":"background-color:rgb(255,255,255)!important;"}(e);wn(o,t("display:none!important;")),wn(r,t(Cd+Ed+i)),t((!0===Id?"":Cd)+Ed+i)(n)},Md=function(){var n=Fe("["+kd+"]");wn(n,(function(n){var e=zr(n,kd);"no-styles"!==e?jr(n,"style",e):Pr(n,"style"),Pr(n,kd)}))},Ad=function(){var n=yi("head").getOrDie(),e=yi('meta[name="viewport"]').getOrThunk((function(){var e=ue("meta");return jr(e,"name","viewport"),ze(n,e),e})),t=zr(e,"content");return{maximize:function(){jr(e,"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){null!=t&&t.length>0?jr(e,"content",t):jr(e,"content","user-scalable=yes")}}},Fd=function(n,t){var r=Ad(),o=sf(),i=sf();return{enter:function(){t.hide(),Yr(n.container,Qo.resolve("fullscreen-maximized")),Yr(n.container,Qo.resolve("android-maximized")),r.maximize(),Yr(n.body,Qo.resolve("android-scroll-reload")),o.set(vd(n.win,Od.getWin(n.editor).getOrDie("no"))),Od.getActiveApi(n.editor).each((function(t){Dd(n.container,t.body()),i.set(function(n,t,r){var o=$l(n),i=Ve(t),u=function(n){return!Be(n.start(),n.finish())||n.soffset()!==n.foffset()},c=function(){var e=n.doc().dom().hasFocus()&&n.getSelection().exists(u);r.getByDom(t).each(!0===(e||co(i).filter((function(n){return"input"===ge(n)})).exists((function(n){return n.dom().selectionStart!==n.dom().selectionEnd})))?qo.on:qo.off)},a=[Vl(n.body(),"touchstart",(function(e){n.onTouchContent(),o.fireTouchstart(e)})),o.onTouchmove(),o.onTouchend(),Vl(t,"touchstart",(function(e){n.onTouchToolstrip()})),n.onToReading((function(){uo(n.body())})),n.onToEditing(e),n.onScrollToCursor((function(e){e.preventDefault(),n.getCursorBox().each((function(e){var t=n.win(),r=e.top()>t.innerHeight||e.bottom()>t.innerHeight?e.bottom()-t.innerHeight+50:0;0!==r&&t.scrollTo(t.pageXOffset,t.pageYOffset+r)}))}))].concat(!0===Wl?[]:[Vl(ae(n.win()),"blur",(function(){r.getByDom(t).each(qo.off)})),Vl(i,"select",c),Vl(n.doc(),"selectionchange",c)]);return{destroy:function(){wn(a,(function(n){n.unbind()}))}}}(t,n.toolstrip,n.alloy))}))},exit:function(){r.restore(),t.show(),Kr(n.container,Qo.resolve("fullscreen-maximized")),Kr(n.container,Qo.resolve("android-maximized")),Md(),Kr(n.body,Qo.resolve("android-scroll-reload")),i.clear(),o.clear()}}},Rd=function(e,t){var r=null;return{cancel:function(){null!==r&&(n.clearTimeout(r),r=null)},throttle:function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];null!==r&&n.clearTimeout(r),r=n.setTimeout((function(){e.apply(null,o),r=null}),t)}}},Bd=function(e,t){var r,o,i=vs(As.sketch({dom:wa('<div aria-hidden="true" class="${prefix}-mask-tap-icon"></div>'),containerBehaviours:Fr([qo.config({toggleClass:Qo.resolve("mask-tap-icon-selected"),toggleOnExecute:!1})])})),u=(r=e,200,o=null,{cancel:function(){null!==o&&(n.clearTimeout(o),o=null)},throttle:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];null===o&&(o=n.setTimeout((function(){r.apply(null,e),o=null}),200))}});return As.sketch({dom:wa('<div class="${prefix}-disabled-mask"></div>'),components:[As.sketch({dom:wa('<div class="${prefix}-content-container"></div>'),components:[ya.sketch({dom:wa('<div class="${prefix}-content-tap-section"></div>'),components:[i.asSpec()],action:function(n){u.throttle()},buttonBehaviours:Fr([qo.config({toggleClass:Qo.resolve("mask-tap-icon-selected")})])})]})]})},Vd=At([Xt("editor",[qt("getFrame"),Jt("getBody"),Jt("getDoc"),Jt("getWin"),Jt("getSelection"),Jt("setSelection"),Jt("clearSelection"),Jt("cursorSaver"),Jt("onKeyup"),Jt("onNodeChanged"),Jt("getCursorBox"),qt("onDomChanged"),nr("onTouchContent",e),nr("onTapContent",e),nr("onTouchToolstrip",e),nr("onScrollToCursor",r({unbind:e})),nr("onScrollToElement",r({unbind:e})),nr("onToEditing",r({unbind:e})),nr("onToReading",r({unbind:e})),nr("onToolbarScrollStart",o)]),qt("socket"),qt("toolstrip"),qt("dropup"),qt("toolbar"),qt("container"),qt("alloy"),tr("win",(function(n){return Ve(n.socket).dom().defaultView})),tr("body",(function(n){return ae(n.socket.dom().ownerDocument.body)})),nr("translate",o),nr("setReadOnly",e),nr("readOnlyOnInit",r(!0))]),Nd=r([nr("shell",!0),xc("toolbarBehaviours",[ol])]),_d=r([Wc({name:"groups",overrides:function(n){return{behaviours:Fr([ol.config({})])}}})]),jd=ha({name:"Toolbar",configFields:Nd(),partFields:_d(),factory:function(e,t,r,o){var i=e.shell()?{behaviours:[ol.config({})],components:[]}:{behaviours:[],components:t};return{uid:e.uid(),dom:e.dom(),components:i.components,behaviours:x(Fr(i.behaviours),Tc(e.toolbarBehaviours())),apis:{setGroups:function(t,r){var o;(o=t,e.shell()?C.some(o):Jc(o,e,"groups")).fold((function(){throw n.console.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")}),(function(n){ol.set(n,r)}))}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(n,e,t){n.setGroups(e,t)}}}),Hd=r([qt("items"),Xt("markers",bn(["itemClass"],qt)),xc("tgroupBehaviours",[wc])]),zd=r([Uc({name:"items",unit:"item",overrides:function(n){return{domModification:{classes:[n.markers().itemClass()]}}}})]),Ld=ha({name:"ToolbarGroup",configFields:Hd(),partFields:zd(),factory:function(n,e,t,r){return x({dom:{attributes:{role:"toolbar"}}},{uid:n.uid(),dom:n.dom(),components:e,behaviours:x(Fr([wc.config({mode:"flow",selector:"."+n.markers().itemClass()})]),Tc(n.tgroupBehaviours())),"debug.sketcher":t["debug.sketcher"]})}}),Pd="data-"+Qo.resolve("horizontal-scroll"),$d=function(n){return"true"===zr(n,Pd)?function(n){return n.dom().scrollLeft>0||function(n){n.dom().scrollLeft=1;var e=0!==n.dom().scrollLeft;return n.dom().scrollLeft=0,e}(n)}(n):function(n){return n.dom().scrollTop>0||function(n){n.dom().scrollTop=1;var e=0!==n.dom().scrollTop;return n.dom().scrollTop=0,e}(n)}(n)};function Wd(){var n=function(n){var e=!0===n.scrollable?"${prefix}-toolbar-scrollable-group":"";return{dom:wa('<div aria-label="'+n.label+'" class="${prefix}-toolbar-group '+e+'"></div>'),tgroupBehaviours:Fr([Es("adhoc-scrollable-toolbar",!0===n.scrollable?[vr((function(n,e){var t;ui(n.element(),"overflow-x","auto"),t=n.element(),jr(t,Pd,"true"),bl.register(n.element())}))]:[])]),components:[As.sketch({components:[Ld.parts().items({})]})],markers:{itemClass:Qo.resolve("toolbar-group-item")},items:n.items}},e=Hf(jd.sketch({dom:wa('<div class="${prefix}-toolbar"></div>'),components:[jd.parts().groups({})],toolbarBehaviours:Fr([qo.config({toggleClass:Qo.resolve("context-toolbar"),toggleOnExecute:!1,aria:{mode:"none"}}),wc.config({mode:"cyclic"})]),shell:!0})),o=Hf(As.sketch({dom:{classes:[Qo.resolve("toolstrip")]},components:[zf(e)],containerBehaviours:Fr([qo.config({toggleClass:Qo.resolve("android-selection-context-toolbar"),toggleOnExecute:!1})])})),i=function(){jd.setGroups(e,u.get()),qo.off(e)},u=eo([]);return{wrapper:r(o),toolbar:r(e),createGroups:function(e){return bn(e,t(Ld.sketch,n))},setGroups:function(n){u.set(n),i()},setContextToolbar:function(n){qo.on(e),jd.setGroups(e,n)},restoreToolbar:function(){qo.isOn(e)&&i()},refresh:function(){},focus:function(){wc.focusIn(e)}}}var Ud=function(n,e){ol.append(n,zf(e))},Gd=function(n,e){ol.remove(n,e)},qd=function(n){return Hf(ya.sketch({dom:wa('<div class="${prefix}-mask-edit-icon ${prefix}-icon"></div>'),action:function(){n.run((function(n){n.setReadOnly(!1)}))}}))},Yd=function(){return Hf(As.sketch({dom:wa('<div class="${prefix}-editor-socket"></div>'),components:[],containerBehaviours:Fr([ol.config({})])}))},Kd=function(n,e,t,r){(!0===t?no.toAlpha:no.toOmega)(r),(t?Ud:Gd)(n,e)},Xd=function(n,e){return e.getAnimationRoot().fold((function(){return n.element()}),(function(e){return e(n)}))},Jd=function(n){return n.dimension().property()},Qd=function(n,e){return n.dimension().getDimension()(e)},Zd=function(n,e){var t=Xd(n,e);Df(t,[e.shrinkingClass(),e.growingClass()])},nm=function(n,e){Kr(n.element(),e.openClass()),Yr(n.element(),e.closedClass()),ui(n.element(),Jd(e),"0px"),di(n.element())},em=function(n,e){Kr(n.element(),e.closedClass()),Yr(n.element(),e.openClass()),li(n.element(),Jd(e))},tm=function(n,e,t){t.setCollapsed(),ui(n.element(),Jd(e),Qd(e,n.element())),di(n.element());var r=Xd(n,e);Yr(r,e.shrinkingClass()),nm(n,e),e.onStartShrink()(n)},rm=function(n,e,t){var r=function(n,e){em(n,e);var t=Qd(e,n.element());return nm(n,e),t}(n,e),o=Xd(n,e);Yr(o,e.growingClass()),em(n,e),ui(n.element(),Jd(e),r),t.setExpanded(),e.onStartGrow()(n)},om=function(n,e,t){var r=Xd(n,e);return!0===Xr(r,e.growingClass())},im=function(n,e,t){var r=Xd(n,e);return!0===Xr(r,e.shrinkingClass())},um=Object.freeze({grow:function(n,e,t){t.isExpanded()||rm(n,e,t)},shrink:function(n,e,t){t.isExpanded()&&tm(n,e,t)},immediateShrink:function(n,e,t){t.isExpanded()&&function(n,e,t){t.setCollapsed(),ui(n.element(),Jd(e),Qd(e,n.element())),di(n.element()),Zd(n,e),nm(n,e),e.onStartShrink()(n),e.onShrunk()(n)}(n,e,t)},hasGrown:function(n,e,t){return t.isExpanded()},hasShrunk:function(n,e,t){return t.isCollapsed()},isGrowing:om,isShrinking:im,isTransitioning:function(n,e,t){return!0===om(n,e)||!0===im(n,e)},toggleGrow:function(n,e,t){(t.isExpanded()?tm:rm)(n,e,t)},disableTransitions:Zd}),cm=Object.freeze({exhibit:function(n,e){var t=e.expanded();return wr(t?{classes:[e.openClass()],styles:{}}:{classes:[e.closedClass()],styles:pt(e.dimension().property(),"0px")})},events:function(n,e){return or([ur($(),(function(t,r){r.event().raw().propertyName===n.dimension().property()&&(Zd(t,n),e.isExpanded()&&li(t.element(),n.dimension().property()),(e.isExpanded()?n.onGrown():n.onShrunk())(t))}))])}}),am=[qt("closedClass"),qt("openClass"),qt("shrinkingClass"),qt("growingClass"),Jt("getAnimationRoot"),Io("onShrunk"),Io("onStartShrink"),Io("onGrown"),Io("onStartGrow"),nr("expanded",!1),Yt("dimension",Wt("property",{width:[Fo("property","width"),Fo("getDimension",(function(n){return es(n)+"px"}))],height:[Fo("property","height"),Fo("getDimension",(function(n){return vi(n)+"px"}))]}))],sm=Br({fields:am,name:"sliding",active:cm,apis:um,state:Object.freeze({init:function(n){var e=eo(n.expanded());return Ar({isExpanded:function(){return!0===e.get()},isCollapsed:function(){return!1===e.get()},setCollapsed:i(e.set,!1),setExpanded:i(e.set,!0),readState:function(){return"expanded: "+e.get()}})}})}),fm=function(t,o){var i=Hf(As.sketch({dom:{tag:"div",classes:[Qo.resolve("dropup")]},components:[],containerBehaviours:Fr([ol.config({}),sm.config({closedClass:Qo.resolve("dropup-closed"),openClass:Qo.resolve("dropup-open"),shrinkingClass:Qo.resolve("dropup-shrinking"),growingClass:Qo.resolve("dropup-growing"),dimension:{property:"height"},onShrunk:function(n){t(),o(),ol.set(n,[])},onGrown:function(n){t(),o()}}),Ko((function(n,t){u(e)}))])})),u=function(e){n.window.requestAnimationFrame((function(){e(),sm.shrink(i)}))};return{appear:function(e,t,r){!0===sm.hasShrunk(i)&&!1===sm.isTransitioning(i)&&n.window.requestAnimationFrame((function(){t(r),ol.set(i,[e()]),sm.grow(i)}))},disappear:u,component:r(i),element:i.element}},lm=Hn.detect().browser.isFirefox(),dm=Mt([Kt("triggerEvent"),Kt("broadcastEvent"),nr("stopBackspace",!0)]),mm=function(n,e){var t=vt(n,"target").map((function(n){return n()})).getOr(e);return eo(t)},gm=Ze([{stopped:[]},{resume:["element"]},{complete:[]}]),vm=function(n,e,t,o,i,u){var c=n(e,o),a=function(n,e){var t=eo(!1),o=eo(!1);return{stop:function(){t.set(!0)},cut:function(){o.set(!0)},isStopped:t.get,isCut:o.get,event:r(n),setSource:e.set,getSource:e.get}}(t,i);return c.fold((function(){return u.logEventNoHandlers(e,o),gm.complete()}),(function(n){var t=n.descHandler();return Tf(t)(a),a.isStopped()?(u.logEventStopped(e,n.element(),t.purpose()),gm.stopped()):a.isCut()?(u.logEventCut(e,n.element(),t.purpose()),gm.complete()):_e(n.element()).fold((function(){return u.logNoParent(e,n.element(),t.purpose()),gm.complete()}),(function(r){return u.logEventResponse(e,n.element(),t.purpose()),gm.resume(r)}))}))},pm=function(n,e,t,r,o,i){return vm(n,e,t,r,o,i).fold((function(){return!0}),(function(r){return pm(n,e,t,r,o,i)}),(function(){return!1}))},hm=function(n,e,t,r,o){var i=mm(t,r);return pm(n,e,t,r,i,o)},ym=xe("element","descHandler");function bm(){var n={};return{registerId:function(e,t,o){I(o,(function(o,u){var c=void 0!==n[u]?n[u]:{};c[t]=function(n,e){return t=i.apply(void 0,[n.handler].concat(e)),o=n.purpose(),{cHandler:t,purpose:r(o)};var t,o}(o,e),n[u]=c}))},unregisterId:function(e){I(n,(function(n,t){n.hasOwnProperty(e)&&delete n[e]}))},filterByType:function(e){return vt(n,e).map((function(n){return A(n,(function(n,e){return function(n,e){return{id:r(n),descHandler:r(e)}}(e,n)}))})).getOr([])},find:function(e,t,r){var o=mt(t)(n);return function(n,e,t){return oo(n,(function(n){return e(n).isSome()}),t).bind(e)}(r,(function(n){return function(n,e){return sa(e).fold((function(){return C.none()}),(function(t){var r=mt(t);return n.bind(r).map((function(n){return ym(e,n)}))}))}(o,n)}),e)}}}function wm(){var n=bm(),e={},t=function(t){sa(t.element()).each((function(t){e[t]=void 0,n.unregisterId(t)}))};return{find:function(e,t,r){return n.find(e,t,r)},filter:function(e){return n.filterByType(e)},register:function(r){var o=function(n){var e=n.element();return sa(e).fold((function(){return function(n,e){var t=Mc(ca+"uid-");return jr(e,aa,t),t}(0,n.element())}),(function(n){return n}))}(r);bt(e,o)&&function(n,r){var o=e[r];if(o!==n)throw new Error('The tagId "'+r+'" is already used by: '+po(o.element())+"\nCannot use it for: "+po(n.element())+"\nThe conflicting element is"+(ye(o.element())?" ":" not ")+"already in the DOM");t(n)}(r,o);var i=[r];n.registerId(i,o,r.events()),e[o]=r},unregister:t,getById:function(n){return mt(n)(e)}}}var xm=function(t){var o,i,u,c,s,f,l,d,m,g,v=function(n){return _e(t.element()).fold((function(){return!0}),(function(e){return Be(n,e)}))},p=wm(),h=function(n,e){return p.find(v,n,e)},y=(o=t.element(),i=Lt("Getting GUI events settings",dm,{triggerEvent:function(n,e){return To(n,e.target(),(function(t){return function(n,e,t,r){var o=t.target();return hm(n,e,t,o,r)}(h,n,e,t)}))},broadcastEvent:function(n,t){return function(n,t,o){var i=function(n){var t=eo(!1);return{stop:function(){t.set(!0)},cut:e,isStopped:t.get,isCut:r(!1),event:r(n),setSource:a("Cannot set source of a broadcasted event"),getSource:a("Cannot get source of a broadcasted event")}}(t);return wn(n,(function(n){var e=n.descHandler();Tf(e)(i)})),i.isStopped()}(p.filter(n),t)}}),u=Hn.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],c=Pl(i),s=bn(u.concat(["selectstart","input","contextmenu","change","transitionend","drag","dragstart","dragend","dragenter","dragleave","dragover","drop"]),(function(n){return Vl(o,n,(function(e){c.fireIfReady(e,n).each((function(n){n&&e.kill()})),i.triggerEvent(n,e)&&e.kill()}))})),f=Vl(o,"keydown",(function(n){i.triggerEvent("keydown",n)?n.kill():!0===i.stopBackspace&&function(n){return 8===n.raw().which&&!yn(["input","textarea"],ge(n.target()))}(n)&&n.prevent()})),l=function(n,e){return lm?Nl(n,"focus",e):Vl(n,"focusin",e)}(o,(function(n){i.triggerEvent("focusin",n)&&n.kill()})),d=function(n,e){return lm?Nl(n,"blur",e):Vl(n,"focusout",e)}(o,(function(e){i.triggerEvent("focusout",e)&&e.kill(),n.setTimeout((function(){i.triggerEvent(Pn(),e)}),0)})),m=Ne(o),g=Vl(m,"scroll",(function(n){i.broadcastEvent(Xn(),n)&&n.kill()})),{unbind:function(){wn(s,(function(n){n.unbind()})),f.unbind(),l.unbind(),d.unbind(),g.unbind()}}),b=pf({debugInfo:r("real"),triggerEvent:function(n,e,t){To(n,e,(function(r){hm(h,n,t,e,r)}))},triggerFocus:function(n,t){sa(n).fold((function(){io(n)}),(function(o){To(Ln(),n,(function(o){!function(n,e,t,r,o){var i=mm(t,r);vm(n,e,t,r,i,o)}(h,Ln(),{originator:r(t),kill:e,prevent:e,target:r(n)},n,o)}))}))},triggerEscape:function(n,e){b.triggerEvent("keydown",n.element(),e.event())},getByUid:function(n){return E(n)},getByDom:function(n){return I(n)},build:Hf,addToGui:function(n){T(n)},removeFromGui:function(n){S(n)},addToWorld:function(n){w(n)},removeFromWorld:function(n){x(n)},broadcast:function(n){k(n)},broadcastOn:function(n,e){C(n,e)},isConnected:r(!0)}),w=function(n){n.connect(b),he(n.element())||(p.register(n),wn(n.components(),w),b.triggerEvent(Kn(),n.element(),{target:r(n.element())}))},x=function(n){he(n.element())||(wn(n.components(),x),p.unregister(n)),n.disconnect()},T=function(n){Ge(t,n)},S=function(n){Ke(n)},O=function(n){var e=p.filter($n());wn(e,(function(e){var t=e.descHandler();Tf(t)(n)}))},k=function(n){O({universal:r(!0),data:r(n)})},C=function(n,e){O({universal:r(!1),channels:r(n),data:r(e)})},E=function(n){return p.getById(n).fold((function(){return Qe.error(new Error('Could not find component with uid: "'+n+'" in system.'))}),Qe.value)},I=function(n){var e=sa(n).getOr("not found");return E(e)};return w(t),{root:r(t),element:t.element,destroy:function(){y.unbind(),$e(t.element())},add:T,remove:S,getByUid:E,getByDom:I,addToWorld:w,removeFromWorld:x,broadcast:k,broadcastOn:C}},Tm=r(Qo.resolve("readonly-mode")),Sm=r(Qo.resolve("edit-mode"));function Om(n){var e=Hf(As.sketch({dom:{classes:[Qo.resolve("outer-container")].concat(n.classes)},containerBehaviours:Fr([no.config({alpha:Tm(),omega:Sm()})])}));return xm(e)}var km=function(n,e){var t=ue("input");ci(t,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"}),ze(n,t),io(t),e(t),$e(t)},Cm=function(n){var e=n.getSelection();if(e.rangeCount>0){var t=e.getRangeAt(0),r=n.document.createRange();r.setStart(t.startContainer,t.startOffset),r.setEnd(t.endContainer,t.endOffset),e.removeAllRanges(),e.addRange(r)}},Em=function(n,e){co().each((function(n){Be(n,e)||uo(n)})),n.focus(),io(ae(n.document.body)),Cm(n)},Im={stubborn:function(n,e,t,r){var o=function(){Em(e,r)},i=Vl(t,"keydown",(function(n){yn(["input","textarea"],ge(n.target()))||o()}));return{toReading:function(){km(n,uo)},toEditing:o,onToolbarTouch:function(){},destroy:function(){i.unbind()}}},timid:function(n,t,r,o){var i=function(){uo(o)};return{toReading:function(){i()},toEditing:function(){Em(t,o)},onToolbarTouch:function(){i()},destroy:e}}},Dm={},Mm={exports:Dm};!function(n,e,t,r){!function(n){"object"==typeof e&&void 0!==t?t.exports=n():("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EphoxContactWrapper=n()}((function(){return function n(e,t,r){function o(u,c){if(!t[u]){if(!e[u]){if(i)return i(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var s=t[u]={exports:{}};e[u][0].call(s.exports,(function(n){return o(e[u][1][n]||n)}),s,s.exports,n,e,t,r)}return t[u].exports}for(var i=!1,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(n,e,t){var r,o,i=e.exports={};function u(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function a(n){if(r===setTimeout)return setTimeout(n,0);if((r===u||!r)&&setTimeout)return r=setTimeout,setTimeout(n,0);try{return r(n,0)}catch(e){try{return r.call(null,n,0)}catch(e){return r.call(this,n,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:u}catch(n){r=u}try{o="function"==typeof clearTimeout?clearTimeout:c}catch(n){o=c}}();var s,f=[],l=!1,d=-1;function m(){l&&s&&(l=!1,s.length?f=s.concat(f):d=-1,f.length&&g())}function g(){if(!l){var n=a(m);l=!0;for(var e=f.length;e;){for(s=f,f=[];++d<e;)s&&s[d].run();d=-1,e=f.length}s=null,l=!1,function(n){if(o===clearTimeout)return clearTimeout(n);if((o===c||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(n);try{o(n)}catch(e){try{return o.call(null,n)}catch(e){return o.call(this,n)}}}(n)}}function v(n,e){this.fun=n,this.array=e}function p(){}i.nextTick=function(n){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];f.push(new v(n,e)),1!==f.length||l||a(g)},v.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(n){return[]},i.binding=function(n){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(n){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],2:[function(n,e,t){(function(n){!function(t){var r=setTimeout;function o(){}function i(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(n,this)}function u(n,e){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,i._immediateFn((function(){var t=1===n._state?e.onFulfilled:e.onRejected;if(null!==t){var r;try{r=t(n._value)}catch(n){return void a(e.promise,n)}c(e.promise,r)}else(1===n._state?c:a)(e.promise,n._value)}))):n._deferreds.push(e)}function c(n,e){try{if(e===n)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if(e instanceof i)return n._state=3,n._value=e,void s(n);if("function"==typeof t)return void l((r=t,o=e,function(){r.apply(o,arguments)}),n)}n._state=1,n._value=e,s(n)}catch(e){a(n,e)}var r,o}function a(n,e){n._state=2,n._value=e,s(n)}function s(n){2===n._state&&0===n._deferreds.length&&i._immediateFn((function(){n._handled||i._unhandledRejectionFn(n._value)}));for(var e=0,t=n._deferreds.length;e<t;e++)u(n,n._deferreds[e]);n._deferreds=null}function f(n,e,t){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.promise=t}function l(n,e){var t=!1;try{n((function(n){t||(t=!0,c(e,n))}),(function(n){t||(t=!0,a(e,n))}))}catch(n){if(t)return;t=!0,a(e,n)}}i.prototype.catch=function(n){return this.then(null,n)},i.prototype.then=function(n,e){var t=new this.constructor(o);return u(this,new f(n,e,t)),t},i.all=function(n){var e=Array.prototype.slice.call(n);return new i((function(n,t){if(0===e.length)return n([]);var r=e.length;function o(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var c=u.then;if("function"==typeof c)return void c.call(u,(function(n){o(i,n)}),t)}e[i]=u,0==--r&&n(e)}catch(n){t(n)}}for(var i=0;i<e.length;i++)o(i,e[i])}))},i.resolve=function(n){return n&&"object"==typeof n&&n.constructor===i?n:new i((function(e){e(n)}))},i.reject=function(n){return new i((function(e,t){t(n)}))},i.race=function(n){return new i((function(e,t){for(var r=0,o=n.length;r<o;r++)n[r].then(e,t)}))},i._immediateFn="function"==typeof n?function(e){n(e)}:function(n){r(n,0)},i._unhandledRejectionFn=function(n){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",n)},i._setImmediateFn=function(n){i._immediateFn=n},i._setUnhandledRejectionFn=function(n){i._unhandledRejectionFn=n},void 0!==e&&e.exports?e.exports=i:t.Promise||(t.Promise=i)}(this)}).call(this,n("timers").setImmediate)},{timers:3}],3:[function(n,e,t){(function(e,r){var o=n("process/browser.js").nextTick,i=Function.prototype.apply,u=Array.prototype.slice,c={},a=0;function s(n,e){this._id=n,this._clearFn=e}t.setTimeout=function(){return new s(i.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new s(i.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(n){n.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(n,e){clearTimeout(n._idleTimeoutId),n._idleTimeout=e},t.unenroll=function(n){clearTimeout(n._idleTimeoutId),n._idleTimeout=-1},t._unrefActive=t.active=function(n){clearTimeout(n._idleTimeoutId);var e=n._idleTimeout;e>=0&&(n._idleTimeoutId=setTimeout((function(){n._onTimeout&&n._onTimeout()}),e))},t.setImmediate="function"==typeof e?e:function(n){var e=a++,r=!(arguments.length<2)&&u.call(arguments,1);return c[e]=!0,o((function(){c[e]&&(r?n.apply(null,r):n.call(null),t.clearImmediate(e))})),e},t.clearImmediate="function"==typeof r?r:function(n){delete c[n]}}).call(this,n("timers").setImmediate,n("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(n,e,t){var r=n("promise-polyfill"),o="undefined"!=typeof window?window:Function("return this;")();e.exports={boltExport:o.Promise||r}},{"promise-polyfill":2}]},{},[4])(4)}))}(0,Dm,Mm);var Am,Fm=Mm.exports.boltExport,Rm=function(e){var t=C.none(),r=[],o=function(n){i()?u(n):r.push(n)},i=function(){return t.isSome()},u=function(e){t.each((function(t){n.setTimeout((function(){e(t)}),0)}))};return e((function(n){t=C.some(n),wn(r,u),r=[]})),{get:o,map:function(n){return Rm((function(e){o((function(t){e(n(t))}))}))},isReady:i}},Bm={nu:Rm,pure:function(n){return Rm((function(e){e(n)}))}},Vm=function(e){n.setTimeout((function(){throw e}),0)},Nm=function(n){var e=function(e){n().then(e,Vm)};return{map:function(e){return Nm((function(){return n().then(e)}))},bind:function(e){return Nm((function(){return n().then((function(n){return e(n).toPromise()}))}))},anonBind:function(e){return Nm((function(){return n().then((function(){return e.toPromise()}))}))},toLazy:function(){return Bm.nu(e)},toCached:function(){var e=null;return Nm((function(){return null===e&&(e=n()),e}))},toPromise:n,get:e}},_m=function(n){return Nm((function(){return new Fm(n)}))},jm=function(n){var e=jl(n).isPortrait(),t=function(n){return e=n.screen.width,t=n.screen.height,function(n,r){for(var o=0;o<n.length;o++){var i=(c=void 0,a=void 0,c=e<=(u=n[o]).width&&t<=u.height,a=u.keyboard,c?C.some(a):C.none());if(i.isSome())return i}var u,c,a;return C.none()}([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}]).getOr({portrait:t/5,landscape:e/4});var e,t}(n),r=e?t.portrait:t.landscape;return(e?n.screen.height:n.screen.width)-n.innerHeight>r?0:r},Hm=function(n,e){var t=Ve(n).dom().defaultView;return vi(n)+vi(e)-jm(t)},zm=Hm,Lm=function(n,e,t){var r=Hm(e,t),o=vi(e)+vi(t)-r;ui(n,"padding-bottom",o+"px")},Pm=Ze([{fixed:["element","property","offsetY"]},{scroller:["element","offsetY"]}]),$m="data-"+Qo.resolve("position-y-fixed"),Wm="data-"+Qo.resolve("y-property"),Um="data-"+Qo.resolve("scrolling"),Gm="data-"+Qo.resolve("last-window-height"),qm=function(n){return Ul(n,$m)},Ym=function(n,e){var t=function(n){return zr(n,Wm)}(n);return Pm.fixed(n,t,e)},Km=function(n,e){return Pm.scroller(n,e)},Xm=function(n){var e=qm(n);return("true"===zr(n,Um)?Km:Ym)(n,e)},Jm=function(n,e,t){var r=Ve(n).dom().defaultView.innerHeight;return jr(n,Gm,r+"px"),r-e-t},Qm=qm,Zm=(Am=null,{animate:function(n,e,t,r,o,i){var u=!1,c=function(n){u=!0,o(n)};clearInterval(Am);var a=function(n){clearInterval(Am),c(n)};Am=setInterval((function(){var o=n();(function(n,e,t){return Math.abs(n-e)<=t?C.none():n<e?C.some(n+t):C.some(n-t)})(o,e,t).fold((function(){clearInterval(Am),c(e)}),(function(t){if(r(t,a),!u){var i=n();(i!==t||Math.abs(i-e)>Math.abs(o-e))&&(clearInterval(Am),c(e))}}))}),i)}}),ng="data-"+Qo.resolve("last-scroll-top"),eg=function(n){var e=fi(n,"top").getOr("0");return parseInt(e,10)},tg=function(n){return parseInt(n.dom().scrollTop,10)},rg=function(n,e){var t=e+Qm(n)+"px";ui(n,"top",t)},og=function(n,e){return _m((function(t){var r=i(tg,n);jr(n,ng,r());var o=Math.abs(e-r()),u=Math.ceil(o/10);Zm.animate(r,e,u,(function(e,t){Ul(n,ng)!==n.dom().scrollTop?t(n.dom().scrollTop):(n.dom().scrollTop=e,jr(n,ng,e))}),(function(){n.dom().scrollTop=e,jr(n,ng,e),t(e)}),10)}))},ig=function(n,e){return n.fold((function(n,t,r){return function(n,e,t,r){return ui(n,e,t+r+"px"),o=r,Nm((function(){return Fm.resolve(o)}));var o}(n,t,e,r)}),(function(n,t){return function(n,e,t){var r=e+t,o=fi(n,"top").getOr(t),u=r-parseInt(o,10),c=n.dom().scrollTop+u;return function(n,e,t){return _m((function(r){var o=i(tg,n);Zm.animate(o,e,15,(function(e){n.dom().scrollTop=e,ui(n,"top",eg(n)+15+"px")}),(function(){n.dom().scrollTop=e,ui(n,"top",t+"px"),r(e)}),10)}))}(n,c,r)}(n,e,t)}))},ug=function(n,e){var t=function(n){var e=hi(n,"["+$m+"]");return bn(e,Xm)}(n);return function(n,e){return e((function(e){var t=[],r=0;0===n.length?e([]):wn(n,(function(o,i){o.get(function(o){return function(i){t[o]=i,++r>=n.length&&e(t)}}(i))}))}))}(bn(t,(function(n){return ig(n,e)})),_m)},cg=function(n,e,t,i,u,c){var a,s,f=(a=function(t){return function(n,e,t){var r=Ve(n).dom().defaultView;return _m((function(o){rg(n,t),rg(e,t),r.scrollTo(0,t),o(t)}))}(n,e,t)},s=eo(Bm.pure({})),{start:function(n){var e=Bm.nu((function(e){return a(n).get(e)}));s.set(e)},idle:function(n){s.get().get((function(){n()}))}}),l=Rd((function(){f.idle((function(){ug(t,i.pageYOffset).get((function(){var n;(n=ld(c),C.from(n[0]).bind((function(n){var t=n.top()-e.dom().scrollTop;return t>i.innerHeight+5||t<-5?C.some({top:r(t),bottom:r(t+n.height())}):C.none()}))).each((function(n){e.dom().scrollTop=e.dom().scrollTop+n.top()})),f.start(0),u.refresh()}))}))}),1e3),d=Vl(ae(i),"scroll",(function(){i.pageYOffset<0||l.throttle()}));return ug(t,i.pageYOffset).get(o),{unbind:d.unbind}},ag=function(n){var t=n.cWin(),r=n.ceBody(),u=n.socket(),a=n.toolstrip(),s=n.toolbar(),f=n.contentElement(),l=n.keyboardType(),d=n.outerWindow(),m=n.dropup(),g=function(n,e,t,r){var o=Ve(n).dom().defaultView,i=function(n){var e=zr(n,"style");return ci(n,{position:"absolute",top:"0px"}),jr(n,$m,"0px"),jr(n,Wm,"top"),{restore:function(){jr(n,"style",e||""),Pr(n,$m),Pr(n,Wm)}}}(t),u=vi(t),a=vi(r),s=function(n,e,t){var r=zr(t,"style");return bl.register(t),ci(t,{position:"absolute",height:e+"px",width:"100%",top:n+"px"}),jr(t,$m,n+"px"),jr(t,Um,"true"),jr(t,Wm,"top"),{restore:function(){bl.deregister(t),jr(t,"style",r||""),Pr(t,$m),Pr(t,Um),Pr(t,Wm)}}}(u,Jm(n,u,a),n),f=function(n,e,t){var r=zr(n,"style");return ci(n,{position:"absolute",bottom:"0px"}),jr(n,$m,"0px"),jr(n,Wm,"bottom"),{restore:function(){jr(n,"style",r||""),Pr(n,$m),Pr(n,Wm)}}}(r),l=!0,d=function(){return o.innerHeight>function(n){return Ul(n,Gm)}(n)},m=function(){if(l){var o=vi(t),i=vi(r),u=Jm(n,o,i);jr(n,$m,o+"px"),ui(n,"height",u+"px"),Lm(e,n,r)}};return Lm(e,n,r),{setViewportOffset:function(e){jr(n,$m,e+"px"),m()},isExpanding:d,isShrinking:c(d),refresh:m,restore:function(){l=!1,i.restore(),s.restore(),f.restore()}}}(u,r,a,m),v=l(n.outerBody(),t,be(),f,a,s),p=Hl(d,{onChange:e,onReady:g.refresh});p.onAdjustment((function(){g.refresh()}));var h=Vl(ae(d),"resize",(function(){g.isExpanding()&&g.refresh()})),y=cg(a,u,n.outerBody(),d,g,t),b=function(n,e){var t=n.document,r=ue("div");Yr(r,Qo.resolve("unfocused-selections")),ze(ae(t.documentElement),r);var o=Vl(r,"touchstart",(function(t){t.prevent(),Em(n,e),u()})),i=function(n){var e=ue("span");return If(e,[Qo.resolve("layer-editor"),Qo.resolve("unfocused-selection")]),ci(e,{left:n.left()+"px",top:n.top()+"px",width:n.width()+"px",height:n.height()+"px"}),e},u=function(){Pe(r)};return{update:function(){u();var e=ld(n),t=bn(e,i);Le(r,t)},isActive:function(){return je(r).length>0},destroy:function(){o.unbind(),$e(r)},clear:u}}(t,f),w=function(){b.clear()};return{toEditing:function(){v.toEditing(),w()},toReading:function(){v.toReading()},onToolbarTouch:function(n){v.onToolbarTouch(n)},refreshSelection:function(){b.isActive()&&b.update()},clearSelection:w,highlightSelection:function(){b.update()},scrollIntoView:function(n,e){!function(n,e,t,r,o){var u=zm(e,t),c=i(Cm,n);r>u||o>u?og(e,e.dom().scrollTop-u+o).get(c):r<0&&og(e,e.dom().scrollTop+r).get(c)}(t,u,m,n,e)},updateToolbarPadding:e,setViewportOffset:function(n){g.setViewportOffset(n),function(n,e){return _m((function(t){var r=i(eg,n),o=function(e){ui(n,"top",e+"px")},u=Math.abs(e-r()),c=Math.ceil(u/10);Zm.animate(r,e,c,o,(function(){o(e),t(e)}),10)}))}(u,n).get(o)},syncHeight:function(){ui(f,"height",f.dom().contentWindow.document.body.scrollHeight+"px")},refreshStructure:g.refresh,destroy:function(){g.restore(),p.destroy(),y.unbind(),h.unbind(),v.destroy(),b.destroy(),km(be(),uo)}}},sg=function(t,r){var o=Ad(),i=ff(),u=ff(),c=sf(),a=sf();return{enter:function(){r.hide();var s=ae(n.document);Od.getActiveApi(t.editor).each((function(r){var f,l;i.set({socketHeight:fi(t.socket,"height"),iframeHeight:fi(r.frame(),"height"),outerScroll:n.document.body.scrollTop}),u.set({exclusives:(f=s,l="."+bl.scrollable(),Vl(f,"touchmove",(function(n){xi(n.target(),l).filter($d).fold((function(){n.raw().preventDefault()}),e)})))}),Yr(t.container,Qo.resolve("fullscreen-maximized")),Dd(t.container,r.body()),o.maximize(),ui(t.socket,"overflow","scroll"),ui(t.socket,"-webkit-overflow-scrolling","touch"),io(r.body());var d=Ee(["cWin","ceBody","socket","toolstrip","toolbar","dropup","contentElement","cursor","keyboardType","isScrolling","outerWindow","outerBody"],[]);c.set(ag(d({cWin:r.win(),ceBody:r.body(),socket:t.socket,toolstrip:t.toolstrip,toolbar:t.toolbar,dropup:t.dropup.element(),contentElement:r.frame(),cursor:e,outerBody:t.body,outerWindow:t.win,keyboardType:Im.stubborn,isScrolling:function(){return u.get().exists((function(n){return n.socket.isScrolling()}))}}))),c.run((function(n){n.syncHeight()})),a.set(function(n,e,t,r,o){var i=function(){e.run((function(n){n.refreshSelection()}))},u=function(n,t){var o=n-r.dom().scrollTop;e.run((function(n){n.scrollIntoView(o,o+t)}))},c=function(){e.run((function(n){n.clearSelection()}))},a=function(){n.getCursorBox().each((function(n){u(n.top(),n.height())})),e.run((function(n){n.syncHeight()}))},s=$l(n),f=Rd(a,300),l=[n.onKeyup((function(){c(),f.throttle()})),n.onNodeChanged(i),n.onDomChanged(f.throttle),n.onDomChanged(i),n.onScrollToCursor((function(n){n.preventDefault(),f.throttle()})),n.onScrollToElement((function(n){n.element(),u(e,r)})),n.onToEditing((function(){e.run((function(n){n.toEditing()}))})),n.onToReading((function(){e.run((function(n){n.toReading()}))})),Vl(n.doc(),"touchend",(function(e){Be(n.html(),e.target())||Be(n.body(),e.target())})),Vl(t,"transitionend",(function(n){var r;"height"===n.raw().propertyName&&(r=vi(t),e.run((function(n){n.setViewportOffset(r)})),i(),a())})),Nl(t,"touchstart",(function(t){var r;e.run((function(n){n.highlightSelection()})),r=t,e.run((function(n){n.onToolbarTouch(r)})),n.onTouchToolstrip()})),Vl(n.body(),"touchstart",(function(e){c(),n.onTouchContent(),s.fireTouchstart(e)})),s.onTouchmove(),s.onTouchend(),Vl(n.body(),"click",(function(n){n.kill()})),Vl(t,"touchmove",(function(){n.onToolbarScrollStart()}))];return{destroy:function(){wn(l,(function(n){n.unbind()}))}}}(r,c,t.toolstrip,t.socket,t.dropup))}))},refreshStructure:function(){c.run((function(n){n.refreshStructure()}))},exit:function(){o.restore(),a.clear(),c.clear(),r.show(),i.on((function(e){e.socketHeight.each((function(n){ui(t.socket,"height",n)})),e.iframeHeight.each((function(n){ui(t.editor.getFrame(),"height",n)})),n.document.body.scrollTop=e.scrollTop})),i.clear(),u.on((function(n){n.exclusives.unbind()})),u.clear(),Kr(t.container,Qo.resolve("fullscreen-maximized")),Md(),bl.deregister(t.toolbar),li(t.socket,"overflow"),li(t.socket,"-webkit-overflow-scrolling"),uo(t.editor.getFrame()),Od.getActiveApi(t.editor).each((function(n){n.clearSelection()}))}}},fg=tinymce.util.Tools.resolve("tinymce.EditorManager"),lg=function(n,e,t){n.system().broadcastOn([lo.formatChanged()],{command:e,state:t})},dg=(r(["x-small","small","medium","large","x-large"]),function(n){var e=function(){n._skinLoaded=!0,n.fire("SkinLoaded")};return function(){n.initialized?e():n.on("init",e)}}),mg=r("toReading"),gg=r("toEditing");fo.add("mobile",(function(t){return{getNotificationManagerImpl:function(){return{open:r({progressBar:{value:e},close:e}),close:e,reposition:e,getArgs:o}},renderUI:function(o){var i=function(n){var e=vt(n.settings,"skin_url").fold((function(){return fg.baseURL+"/skins/lightgray"}),(function(n){return n}));return{content:e+"/content.mobile.min.css",ui:e+"/skin.mobile.min.css"}}(t);!1===function(n){return!1===n.settings.skin}(t)?(t.contentCSS.push(i.content),so.DOM.styleSheetLoader.load(i.ui,dg(t))):dg(t)();var u=function(){t.fire("scrollIntoView")},c=ue("div"),a=Hn.detect().os.isAndroid()?function(n){var t=Om({classes:[Qo.resolve("android-container")]}),o=Wd(),i=sf(),u=qd(i),c=Yd(),a=fm(e,n);return t.add(o.wrapper()),t.add(c),t.add(a.component()),{system:r(t),element:t.element,init:function(n){i.set(function(n){var t=Lt("Getting AndroidWebapp schema",Vd,n);ui(t.toolstrip,"width","100%");var r=Hf(Bd((function(){t.setReadOnly(t.readOnlyOnInit()),i.enter()}),t.translate));t.alloy.add(r);var o={show:function(){t.alloy.add(r)},hide:function(){t.alloy.remove(r)}};ze(t.container,r.element());var i=Fd(t,o);return{setReadOnly:t.setReadOnly,refreshStructure:e,enter:i.enter,exit:i.exit,destroy:e}}(n))},exit:function(){i.run((function(n){n.exit(),ol.remove(c,u)}))},setToolbarGroups:function(n){var e=o.createGroups(n);o.setGroups(e)},setContextToolbar:function(n){var e=o.createGroups(n);o.setContextToolbar(e)},focusToolbar:function(){o.focus()},restoreToolbar:function(){o.restoreToolbar()},updateMode:function(n){Kd(c,u,n,t.root())},socket:r(c),dropup:r(a)}}(u):function(n){var t=Om({classes:[Qo.resolve("ios-container")]}),o=Wd(),i=sf(),u=qd(i),c=Yd(),a=fm((function(){i.run((function(n){n.refreshStructure()}))}),n);return t.add(o.wrapper()),t.add(c),t.add(a.component()),{system:r(t),element:t.element,init:function(n){i.set(function(n){var t=Lt("Getting IosWebapp schema",Vd,n);ui(t.toolstrip,"width","100%"),ui(t.container,"position","relative");var r=Hf(Bd((function(){t.setReadOnly(t.readOnlyOnInit()),i.enter()}),t.translate));t.alloy.add(r);var o={show:function(){t.alloy.add(r)},hide:function(){t.alloy.remove(r)}},i=sg(t,o);return{setReadOnly:t.setReadOnly,refreshStructure:i.refreshStructure,enter:i.enter,exit:i.exit,destroy:e}}(n))},exit:function(){i.run((function(n){ol.remove(c,u),n.exit()}))},setToolbarGroups:function(n){var e=o.createGroups(n);o.setGroups(e)},setContextToolbar:function(n){var e=o.createGroups(n);o.setContextToolbar(e)},focusToolbar:function(){o.focus()},restoreToolbar:function(){o.restoreToolbar()},updateMode:function(n){Kd(c,u,n,t.root())},socket:r(c),dropup:r(a)}}(u),s=ae(o.targetNode);(xe("element","offset"),function(n,e){(function(n){return C.from(n.dom().nextSibling).map(ae)})(n).fold((function(){_e(n).each((function(n){ze(n,e)}))}),(function(n){!function(n,e){_e(n).each((function(t){t.dom().insertBefore(e.dom(),n.dom())}))}(n,e)}))})(s,c),function(n,e){ze(n,e.element());var t=je(e.element());wn(t,(function(n){e.getByDom(n).each(Ue)}))}(c,a.system());var f=o.targetNode.ownerDocument.defaultView,l=Hl(f,{onChange:function(){a.system().broadcastOn([lo.orientationChanged()],{width:zl(f)})},onReady:e}),d=function(n,e,r,o){!1===o&&t.selection.collapse();var i=m(n,e,r);a.setToolbarGroups(!0===o?i.readOnly:i.main),t.setMode(!0===o?"readonly":"design"),t.fire(!0===o?mg():gg()),a.updateMode(o)},m=function(n,e,t){var r=n.get();return{readOnly:r.backToMask.concat(e.get()),main:r.backToMask.concat(t.get())}},g=function(n,e){return t.on(n,e),{unbind:function(){t.off(n)}}};return t.on("init",(function(){a.init({editor:{getFrame:function(){return ae(t.contentAreaContainer.querySelector("iframe"))},onDomChanged:function(){return{unbind:e}},onToReading:function(n){return g(mg(),n)},onToEditing:function(n){return g(gg(),n)},onScrollToCursor:function(n){return t.on("scrollIntoView",(function(e){n(e)})),{unbind:function(){t.off("scrollIntoView"),l.destroy()}}},onTouchToolstrip:function(){r()},onTouchContent:function(){var n;(n=ae(t.editorContainer.querySelector("."+Qo.resolve("toolbar"))),ao(n).bind((function(n){return a.system().getByDom(n).toOption()}))).each(ee),a.restoreToolbar(),r()},onTapContent:function(e){var r=e.target();"img"===ge(r)?(t.selection.select(r.dom()),e.kill()):"a"===ge(r)&&a.system().getByDom(ae(t.editorContainer)).each((function(e){no.isAlpha(e)&&function(e){var t=n.document.createElement("a");t.target="_blank",t.href=e.href,t.rel="noreferrer noopener";var r=n.document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,n.window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.document.body.appendChild(t),t.dispatchEvent(r),n.document.body.removeChild(t)}(r.dom())}))}},container:ae(t.editorContainer),socket:ae(t.contentAreaContainer),toolstrip:ae(t.editorContainer.querySelector("."+Qo.resolve("toolstrip"))),toolbar:ae(t.editorContainer.querySelector("."+Qo.resolve("toolbar"))),dropup:a.dropup(),alloy:a.system(),translate:e,setReadOnly:function(n){d(v,m,f,n)},readOnlyOnInit:function(){return!1}});var r=function(){a.dropup().disappear((function(){a.system().broadcastOn([lo.dropupDismissed()],{})}))},o={label:"The first group",scrollable:!1,items:[Oa("back",(function(){t.selection.collapse(),a.exit()}),{})]},i={label:"Back to read only",scrollable:!1,items:[Oa("readonly-back",(function(){d(v,m,f,!0)}),{})]},u=Ml(a,t),c=Al(t.settings,u),s={label:"The extra group",scrollable:!1,items:[]},f=eo([{label:"the action group",scrollable:!0,items:c},s]),m=eo([{label:"The read only mode group",scrollable:!0,items:[]},s]),v=eo({backToMask:[o],backToReadOnly:[i]});!function(n,e){var t=E(e.formatter.get());wn(t,(function(t){e.formatter.formatChanged(t,(function(e){lg(n,t,e)}))})),wn(["ul","ol"],(function(t){e.selection.selectorChanged(t,(function(e,r){lg(n,t,e)}))}))}(a,t)})),t.on("remove",(function(){a.exit()})),t.on("detach",(function(){var n,e;n=a.system(),e=je(n.element()),wn(e,(function(e){n.getByDom(e).each(We)})),$e(n.element()),a.system().destroy(),$e(c)})),{iframeContainer:a.socket().element().dom(),editorContainer:a.element().dom()}}}}))}(window);